import dotenv from 'dotenv';
dotenv.config();
import path from 'path';
import { tmpdir } from 'os';
import pLimit from 'p-limit';
import puppeteer from 'puppeteer';
import u from 'ak-tools';
const { NODE_ENV = "" } = process.env;
let { MIXPANEL_TOKEN = "" } = process.env;
if (!NODE_ENV) throw new Error("NODE_ENV is required");
let TEMP_DIR = NODE_ENV === 'dev' ? './tmp' : tmpdir();
TEMP_DIR = path.resolve(TEMP_DIR);

/**
 * @typedef PARAMS
 * @property {string} url URL to simulate
 * @property {number} users Number of users to simulate
 * @property {number} concurrency Number of users to simulate concurrently
 * @property {boolean} headless Whether to run headless or not
 * @property {boolean} inject Whether to inject external script
 * @property {token} token Mixpanel token
 */

/**
 * Main function to simulate user behavior.
 * @param {PARAMS} PARAMS 
 */
export default async function main(PARAMS = {}) {
	let { url = "https://aktunes.neocities.org/fixpanel/",
		users = 10,
		concurrency = 5,
		headless = true,
		inject = false,
		token = ""
	} = PARAMS;
	const limit = pLimit(concurrency);
	if (users > 25) users = 25;
	if (concurrency > 10) concurrency = 10;
	if (token) MIXPANEL_TOKEN = token;

	const userPromises = Array.from({ length: users }, (_, i) => {

		return limit(() => {
			if (NODE_ENV === "dev") console.log(`start user ${i + 1}...`);
			return simulateUser(url, headless, inject)
				.then((results) => {
					if (NODE_ENV === "dev") console.log(`end user ${i + 1}...`);
					return results;
				});
		});
	});

	const results = await Promise.all(userPromises).catch((error) => {
		if (NODE_ENV === "dev") debugger;
		throw error;
	});

	return results;
}

/**
 * Simulates a single user session with random actions.
 * @param {string} url - The URL to visit.
 * @param {boolean} headless - Whether to run the browser headlessly.
 */
async function simulateUser(url, headless = true, inject = false) {
	const browser = await puppeteer.launch({ headless, args: ['--disable-web-security', '--disable-features=IsolateOrigins,site-per-process'] });
	const page = await browser.newPage();
	await page.setViewport({ width: 1280, height: 720 });
	await page.goto(url);

	if (inject) {
		// Inject external script and function call before any page loads		
		const injectMixpanelString = injectMixpanel.toString();

		await page.evaluate((MIXPANEL_TOKEN, injectMixpanelFn) => {
			const injectedFunction = new Function(`return (${injectMixpanelFn})`)();
			injectedFunction(MIXPANEL_TOKEN);
		}, MIXPANEL_TOKEN, injectMixpanelString);
	}
	await u.sleep(100);


	const persona = selectPersona(); // Generate user persona
	const actions = await simulateUserSession(page, persona);

	await browser.close();
	return actions;
}

/**
 * Simulates a user session on the page, following a persona-based action sequence.
 * @param {import('puppeteer').Page} page - Puppeteer page object.
 * @param {string} persona - User persona to simulate.
 */
async function simulateUserSession(page, persona) {
	await u.sleep(250); // Wait for page to load
	const actionSequence = generatePersonaActionSequence(persona);
	for (const action of actionSequence) {
		switch (action) {
			case "click":
				await clickStuff(page);
				if (coinFlip()) await randomWait();
				if (coinFlip()) await clickStuff(page);
				if (coinFlip()) await randomWait();
				if (coinFlip()) await clickStuff(page);
				break;
			case "scroll":
				await randomScroll(page);
				if (coinFlip()) await randomWait();
				if (coinFlip()) await randomScroll(page);
				if (coinFlip()) await randomWait();
				if (coinFlip()) await randomScroll(page);
				break;
			case "mouseMove":
				await randomMouseMove(page);
				if (coinFlip()) await randomWait();
				if (coinFlip()) await randomMouseMove(page);
				if (coinFlip()) await randomWait();
				if (coinFlip()) await randomMouseMove(page);
				break;
			case "wait":
				await randomWait();
				break;
		}

		await u.sleep(250); // wait for data to flush
	}
	return {
		persona: personas[persona],
		personaLabel: persona,
		actionSequence
	};
}

// User personas with different action weightings
const personas = {
	quickScroller: { scroll: 0.6, mouseMove: 0.2, click: 0.1, wait: 0.1 },
	carefulReader: { scroll: 0.3, mouseMove: 0.3, click: 0.2, wait: 0.2 },
	frequentClicker: { scroll: 0.2, mouseMove: 0.3, click: 0.6, wait: 0.1 },
	noWaiting: { scroll: 0.2, mouseMove: 0.2, click: 0.7, wait: 0.05 }
};

/**
 * Selects a random persona.
 */
function selectPersona() {
	const personaKeys = Object.keys(personas);
	return personaKeys[Math.floor(Math.random() * personaKeys.length)];
}

/**
 * Generates an action sequence based on a persona's weighting.
 * @param {string} persona - The selected persona.
 */
function generatePersonaActionSequence(persona) {
	const personaWeights = personas[persona];
	const actionTypes = Object.keys(personaWeights);
	return generateWeightedRandomActionSequence(actionTypes, personaWeights);
}

/**
 * Generates a weighted random action sequence.
 * @param {Array} actionTypes - List of possible actions.
 * @param {Object} weights - Weighting for each action.
 */
function generateWeightedRandomActionSequence(actionTypes, weights) {
	const sequence = [];
	const length = u.rand(10, 50);
	for (let i = 0; i < length; i++) {
		const action = weightedRandom(actionTypes, weights);
		sequence.push(action);
	}
	return sequence;
}

// Core action functions

async function clickStuff(page) {
	try {
		const elements = await page.$$('a, button, input[type="submit"], [role="button"], [onclick]');
		if (elements.length === 0) throw new Error("No clickable elements found.");

		const element = elements[Math.floor(Math.random() * elements.length)];
		const boundingBox = await element.boundingBox();
		if (!boundingBox) throw new Error("Bounding box not found.");

		const { x, y, width, height } = boundingBox;
		const targetX = x + width / 2 + u.rand(-5, 5);
		const targetY = y + height / 2 + u.rand(-5, 5);

		await moveMouse(page, u.rand(0, page.viewport().width), u.rand(0, page.viewport().height), targetX, targetY);
		await page.mouse.click(targetX, targetY);
		await u.sleep(u.rand(100, 300)); // Simulate response time
		if (NODE_ENV === "dev") console.log('click!');
		return true;
	} catch (error) {
		// console.error("clickStuff Error:", error);
		// if (NODE_ENV === "dev") debugger;
		return false;
	}
}

async function randomScroll(page) {
	try {
		const scrollOptions = [
			() => page.evaluate(() => window.scrollBy(0, Math.random() * window.innerHeight / 2)),
			() => page.evaluate(() => window.scrollTo({ top: document.body.scrollHeight * Math.random(), behavior: 'smooth' })),
			() => page.evaluate(() => window.scrollBy({ top: window.innerHeight * (Math.random() < 0.5 ? 1 : -1), behavior: 'smooth' })),
			() => page.evaluate(() => window.scrollTo({ top: 0, behavior: 'smooth' })),
			() => page.evaluate(() => window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }))
		];
		await scrollOptions[Math.floor(Math.random() * scrollOptions.length)]();
		if (NODE_ENV === "dev") console.log('scroll!');
		return true;
	}
	catch (e) {
		return false;
	}
}

async function randomMouseMove(page) {
	const startX = u.rand(0, page.viewport().width);
	const startY = u.rand(0, page.viewport().height);
	const endX = u.rand(0, page.viewport().width);
	const endY = u.rand(0, page.viewport().height);
	return await moveMouse(page, startX, startY, endX, endY);
}

async function moveMouse(page, startX, startY, endX, endY) {
	try {
		// Increase step distance to reduce total number of steps
		const stepDistance = 15; // Increase from 5 to 15 pixels per step
		const steps = Math.ceil(Math.max(Math.abs(endX - startX), Math.abs(endY - startY)) / stepDistance);
		const deltaX = (endX - startX) / steps;
		const deltaY = (endY - startY) / steps;
		let currentX = startX;
		let currentY = startY;

		for (let i = 0; i < steps; i++) {
			// Reduce sine curve adjustment for smoother movement
			const curveX = currentX + deltaX + Math.sin((i / steps) * Math.PI) * u.rand(-2, 2); // Reduced from -10, 10
			const curveY = currentY + deltaY + Math.sin((i / steps) * Math.PI) * u.rand(-2, 2);

			// Move the mouse to the calculated position
			await page.mouse.move(curveX, curveY);

			// Decrease the sleep frequency and duration to make movement faster
			if (u.rand(0, 100) < 10) await u.sleep(u.rand(10, 30)); // Reduced frequency and duration

			// Update current position
			currentX = curveX;
			currentY = curveY;
		}

		// Final mouse move to the exact end point
		await page.mouse.move(endX, endY);
		await u.sleep(u.rand(50, 100)); // Final hesitation reduced

		if (NODE_ENV === "dev") console.log('mouse!');
		return true;
	} catch (e) {
		return false;
	}
}

// Utility wait functions
async function randomWait() {
	await u.sleep(u.rand(50, 1500));
}

async function longWait() {
	await u.sleep(u.rand(2000, 5000));
}

/**
 * Helper to pick a random item from a list with weights.
 * @param {Array} items - List of items to pick from.
 * @param {Object} weights - Object with item keys and their weights.
 * @returns {any} Selected item based on weights.
 */
function weightedRandom(items, weights) {
	const totalWeight = items.reduce((sum, item) => sum + weights[item], 0);
	const randomValue = Math.random() * totalWeight;
	let cumulativeWeight = 0;

	for (const item of items) {
		cumulativeWeight += weights[item];
		if (randomValue < cumulativeWeight) return item;
	}
}


function coinFlip() {
	return Math.random() < 0.5;
}


function injectMixpanel(token = process.env.MIXPANEL_TOKEN || "") {
	// <script src="https://mpeztrack.com/sites/scripts/session-replay.js"type="text/javascript"></script>
	function reset() {
		console.log('resetting....\n\n');
		if (mixpanel) {
			if (mixpanel.ez) {
				mixpanel.ez.reset();
			}
		}
	}

	function generateName() {
		var adjs = [
			"autumn", "hidden", "bitter", "misty", "silent", "empty", "dry", "dark",
			"summer", "icy", "delicate", "quiet", "white", "cool", "spring", "winter",
			"patient", "twilight", "dawn", "crimson", "wispy", "weathered", "blue",
			"billowing", "broken", "cold", "damp", "falling", "frosty", "green",
			"long", "late", "lingering", "bold", "little", "morning", "muddy", "old",
			"red", "rough", "still", "small", "sparkling", "throbbing", "shy",
			"wandering", "withered", "wild", "black", "young", "holy", "solitary",
			"fragrant", "aged", "snowy", "proud", "floral", "restless", "divine",
			"polished", "ancient", "purple", "lively", "nameless", "gentle", "gleaming", "furious", "luminous", "obscure", "poised", "shimmering", "swirling",
			"sombre", "steamy", "whispering", "jagged", "melodic", "moonlit", "starry", "forgotten",
			"peaceful", "restive", "rustling", "sacred", "ancient", "haunting", "solitary", "mysterious",
			"silver", "dusky", "earthy", "golden", "hallowed", "misty", "roaring", "serene", "vibrant",
			"stalwart", "whimsical", "timid", "tranquil", "vast", "youthful", "zephyr", "raging",
			"sapphire", "turbulent", "whirling", "sleepy", "ethereal", "tender", "unseen", "wistful"
		];

		var nouns = [
			"waterfall", "river", "breeze", "moon", "rain", "wind", "sea", "morning",
			"snow", "lake", "sunset", "pine", "shadow", "leaf", "dawn", "glitter",
			"forest", "hill", "cloud", "meadow", "sun", "glade", "bird", "brook",
			"butterfly", "bush", "dew", "dust", "field", "fire", "flower", "firefly",
			"feather", "grass", "haze", "mountain", "night", "pond", "darkness",
			"snowflake", "silence", "sound", "sky", "shape", "surf", "thunder",
			"violet", "water", "wildflower", "wave", "water", "resonance", "sun",
			"wood", "dream", "cherry", "tree", "fog", "frost", "voice", "paper",
			"frog", "smoke", "star", "glow", "wave", "riverbed", "cliff", "deluge", "prairie", "creek", "ocean",
			"peak", "valley", "starlight", "quartz", "woodland", "marsh", "earth", "canopy",
			"petal", "stone", "orb", "gale", "bay", "canyon", "watercourse", "vista", "raindrop",
			"boulder", "grove", "plateau", "sand", "mist", "tide", "blossom", "leaf", "flame",
			"shade", "coil", "grotto", "pinnacle", "scallop", "serenity", "abyss", "skyline",
			"drift", "echo", "nebula", "horizon", "crest", "wreath", "twilight", "balm", "glimmer"
		];


		var adj = adjs[Math.floor(Math.random() * adjs.length)]; // http://stackoverflow.com/a/17516862/103058
		var noun = nouns[Math.floor(Math.random() * nouns.length)];
		var MIN = 1000;
		var MAX = 9999;
		var num = Math.floor(Math.random() * ((MAX + 1) - MIN)) + MIN;

		return adj + '-' + noun + '-' + num;

	}

	const PARAMS = qsToObj(window.location.search);
	let { user = "", project_token = "", mask = "recordEverything", ...restParams } = PARAMS;
	if (!restParams) restParams = {};
	if (!project_token) project_token = token;
	if (!project_token) throw new Error("Project token is required when injecting mixpanel.");

	// Function to load a script dynamically
	function loadScript(url, callback) {
		var script = document.createElement('script');
		script.type = 'text/javascript';
		script.src = url;

		// Bind the event to the callback function.
		// There are several events for cross browser compatibility.
		script.onreadystatechange = callback;
		script.onload = callback;

		// Append the script to the head or body, doesn't really matter
		document.head.appendChild(script);
	}

	// URL of the external script
	const externalScript = 'https://mpeztrack.com/v2.0.0/eztrack.min.js';

	// Function that contains the code to run after the script is loaded
	function EMBED_EZ_TRACK() {
		window.addEventListener('mpEZTrackLoaded', () => {
			reset();
			mixpanel.ez.register(restParams);
			const name = generateName();
			if (!user) user = name;
			mixpanel.ez.identify(user);
			mixpanel.ez.people.set({ $name: user, $email: user });
			mixpanel.ez.track('App Loaded');
			const welcome = 'mixpanel loaded; your id is\n\n ---------------- \n\n ' + user + '\n\n ---------------- \n';
			console.log(welcome);

		});

		if (mpEZTrack) {
			mpEZTrack.init(project_token, {
				record_sessions_percent: 100,
				record_inline_images: true,
				record_collect_fonts: true,
				record_mask_text_selector: mask,
				ignore_dnt: true,
				batch_flush_interval_ms: 0,
				api_payload_format: 'json',
				api_host: "https://express-proxy-lmozz6xkha-uc.a.run.app",
				//meta
				debug: true,
				extend: true,
				refresh: 0,
				location: true,
				persistence: "localStorage",

				//default on
				deviceProps: true,
				pageView: true,
				pageExit: true,
				links: true,
				buttons: true,
				forms: true,
				profiles: false,
				selectors: true,
				videos: true,
				window: false,
				spa: true,
				//default off
				inputs: true,
				clicks: true,
				youtube: false,

				clipboard: true,
				firstPage: true,
				error: true,
				tabs: true,

				//undocumented, for ez debugging
				logProps: true


			}); // Initialize the script
		}
		// Place your code here
	}

	function qsToObj(queryString) {
		try {
			const parsedQs = new URLSearchParams(queryString);
			const params = Object.fromEntries(parsedQs);
			return params;
		}

		catch (e) {
			return {};
		}
	}
	// Load the external script and run myCode when it's done
	// loadScript(externalScript, EMBED_EZ_TRACK);
	//prettier-ignore
	(() => { var e, t, r = Object.defineProperty, n = Object.defineProperties, i = Object.getOwnPropertyDescriptors, o = Object.getOwnPropertySymbols, s = Object.prototype.hasOwnProperty, a = Object.prototype.propertyIsEnumerable, c = (e, t, n) => t in e ? r(e, t, { enumerable: !0, configurable: !0, writable: !0, value: n }) : e[t] = n, l = (e, t) => { for (var r in t || (t = {})) s.call(t, r) && c(e, r, t[r]); if (o) for (var r of o(t)) a.call(t, r) && c(e, r, t[r]); return e; }; function u(e) { let t = null == e ? void 0 : e.host; return Boolean((null == t ? void 0 : t.shadowRoot) === e); } function p(e) { return "[object ShadowRoot]" === Object.prototype.toString.call(e); } function d(e) { try { let t = e.rules || e.cssRules; return t ? function (e) { return e.includes(" background-clip: text;") && !e.includes(" -webkit-background-clip: text;") && (e = e.replace(" background-clip: text;", " -webkit-background-clip: text; background-clip: text;")), e; }(Array.from(t, h).join("")) : null; } catch (e) { return null; } } function h(e) { let t; if (function (e) { return "styleSheet" in e; }(e)) try { t = d(e.styleSheet) || function (e) { let { cssText: t } = e; if (t.split('"').length < 3) return t; let r = ["@import", `url(${JSON.stringify(e.href)})`]; return "" === e.layerName ? r.push("layer") : e.layerName && r.push(`layer(${e.layerName})`), e.supportsText && r.push(`supports(${e.supportsText})`), e.media.length && r.push(e.media.mediaText), r.join(" ") + ";"; }(e); } catch (e) { } else if (function (e) { return "selectorText" in e; }(e) && e.selectorText.includes(":")) return function (e) { let t = /(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm; return e.replace(t, "$1\\$2"); }(e.cssText); return t || e.cssText; } (t = e || (e = {}))[t.Document = 0] = "Document", t[t.DocumentType = 1] = "DocumentType", t[t.Element = 2] = "Element", t[t.Text = 3] = "Text", t[t.CDATA = 4] = "CDATA", t[t.Comment = 5] = "Comment"; var f = class { constructor() { this.idNodeMap = new Map, this.nodeMetaMap = new WeakMap; } getId(e) { var t; if (!e) return -1; let r = null === (t = this.getMeta(e)) || void 0 === t ? void 0 : t.id; return null != r ? r : -1; } getNode(e) { return this.idNodeMap.get(e) || null; } getIds() { return Array.from(this.idNodeMap.keys()); } getMeta(e) { return this.nodeMetaMap.get(e) || null; } removeNodeFromMap(e) { let t = this.getId(e); this.idNodeMap.delete(t), e.childNodes && e.childNodes.forEach((e => this.removeNodeFromMap(e))); } has(e) { return this.idNodeMap.has(e); } hasNode(e) { return this.nodeMetaMap.has(e); } add(e, t) { let r = t.id; this.idNodeMap.set(r, e), this.nodeMetaMap.set(e, t); } replace(e, t) { let r = this.getNode(e); if (r) { let e = this.nodeMetaMap.get(r); e && this.nodeMetaMap.set(t, e); } this.idNodeMap.set(e, t); } reset() { this.idNodeMap = new Map, this.nodeMetaMap = new WeakMap; } }; function m({ element: e, maskInputOptions: t, tagName: r, type: n, value: i, maskInputFn: o }) { let s = i || "", a = n && g(n); return (t[r.toLowerCase()] || a && t[a]) && (s = o ? o(s, e) : "*".repeat(s.length)), s; } function g(e) { return e.toLowerCase(); } var _ = "__rrweb_original__"; function y(e) { let t = e.type; return e.hasAttribute("data-rr-is-password") ? "password" : t ? g(t) : null; } function v(e, t) { var r; let n; try { n = new URL(e, null != t ? t : window.location.href); } catch (e) { return null; } let i = n.pathname.match(/\.([0-9a-z]+)(?:$)/i); return null !== (r = null == i ? void 0 : i[1]) && void 0 !== r ? r : null; } var b = 1, k = new RegExp("[^a-z0-9-_:]"), S = -2; function w() { return b++; } var E, I, C = /url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm, M = /^(?:[a-z+]+:)?\/\//i, O = /^www\..*/i, x = /^(data:)([^,]*),(.*)/i; function T(e, t) { return (e || "").replace(C, ((e, r, n, i, o, s) => { let a = n || o || s, c = r || i || ""; if (!a) return e; if (M.test(a) || O.test(a)) return `url(${c}${a}${c})`; if (x.test(a)) return `url(${c}${a}${c})`; if ("/" === a[0]) return `url(${c}${function (e) { let t = ""; return t = e.indexOf("//") > -1 ? e.split("/").slice(0, 3).join("/") : e.split("/")[0], t = t.split("?")[0], t; }(t) + a}${c})`; let l = t.split("/"), u = a.split("/"); l.pop(); for (let e of u) "." !== e && (".." === e ? l.pop() : l.push(e)); return `url(${c}${l.join("/")}${c})`; })); } var N = /^[^ \t\n\r\u000c]+/, D = /^[, \t\n\r\u000c]+/; function R(e, t) { if (!t || "" === t.trim()) return t; let r = e.createElement("a"); return r.href = t, r.href; } function L(e) { return Boolean("svg" === e.tagName || e.ownerSVGElement); } function A() { let e = document.createElement("a"); return e.href = "", e.href; } function P(e, t, r, n) { return n && ("src" === r || "href" === r && ("use" !== t || "#" !== n[0]) || "xlink:href" === r && "#" !== n[0] || "background" === r && ("table" === t || "td" === t || "th" === t) ? R(e, n) : "srcset" === r ? function (e, t) { if ("" === t.trim()) return t; let r = 0; function n(e) { let n, i = e.exec(t.substring(r)); return i ? (n = i[0], r += n.length, n) : ""; } let i = []; for (; n(D), !(r >= t.length);) { let o = n(N); if ("," === o.slice(-1)) o = R(e, o.substring(0, o.length - 1)), i.push(o); else { let n = ""; o = R(e, o); let s = !1; for (; ;) { let e = t.charAt(r); if ("" === e) { i.push((o + n).trim()); break; } if (s) ")" === e && (s = !1); else { if ("," === e) { r += 1, i.push((o + n).trim()); break; } "(" === e && (s = !0); } n += e, r += 1; } } } return i.join(", "); }(e, n) : "style" === r ? T(n, A()) : "object" === t && "data" === r ? R(e, n) : n); } function q(e, t, r) { return ("video" === e || "audio" === e) && "autoplay" === t; } function F(e, t, r) { if (!e) return !1; if (e.nodeType !== e.ELEMENT_NODE) return !!r && F(e.parentNode, t, r); for (let r = e.classList.length; r--;) { let n = e.classList[r]; if (t.test(n)) return !0; } return !!r && F(e.parentNode, t, r); } function $(e, t, r, n) { try { let i = e.nodeType === e.ELEMENT_NODE ? e : e.parentElement; if (null === i) return !1; if ("string" == typeof t) { if (n) { if (i.closest(`.${t}`)) return !0; } else if (i.classList.contains(t)) return !0; } else if (F(i, t, n)) return !0; if (r) if (n) { if (i.closest(r)) return !0; } else if (i.matches(r)) return !0; } catch (e) { } return !1; } function U(t, r) { let { doc: n, mirror: i, blockClass: o, blockSelector: s, needsMask: a, inlineStylesheet: c, maskInputOptions: l = {}, maskTextFn: u, maskInputFn: p, dataURLOptions: h = {}, inlineImages: f, recordCanvas: v, keepIframeSrcFn: b, newlyAddedElement: S = !1 } = r, w = function (e, t) { if (!t.hasNode(e)) return; let r = t.getId(e); return 1 === r ? void 0 : r; }(n, i); switch (t.nodeType) { case t.DOCUMENT_NODE: return "CSS1Compat" !== t.compatMode ? { type: e.Document, childNodes: [], compatMode: t.compatMode } : { type: e.Document, childNodes: [] }; case t.DOCUMENT_TYPE_NODE: return { type: e.DocumentType, name: t.name, publicId: t.publicId, systemId: t.systemId, rootId: w }; case t.ELEMENT_NODE: return function (t, r) { let n, { doc: i, blockClass: o, blockSelector: s, inlineStylesheet: a, maskInputOptions: c = {}, maskInputFn: l, dataURLOptions: u = {}, inlineImages: p, recordCanvas: h, keepIframeSrcFn: f, newlyAddedElement: v = !1, rootId: b } = r, S = function (e, t, r) { try { if ("string" == typeof t) { if (e.classList.contains(t)) return !0; } else for (let r = e.classList.length; r--;) { let n = e.classList[r]; if (t.test(n)) return !0; } if (r) return e.matches(r); } catch (e) { } return !1; }(t, o, s), w = function (e) { if (e instanceof HTMLFormElement) return "form"; let t = g(e.tagName); return k.test(t) ? "div" : t; }(t), C = {}, M = t.attributes.length; for (let e = 0; e < M; e++) { let r = t.attributes[e]; q(w, r.name, r.value) || (C[r.name] = P(i, w, g(r.name), r.value)); } if ("link" === w && a) { let e = Array.from(i.styleSheets).find((e => e.href === t.href)), r = null; e && (r = d(e)), r && (delete C.rel, delete C.href, C._cssText = T(r, e.href)); } if ("style" === w && t.sheet && !(t.innerText || t.textContent || "").trim().length) { let e = d(t.sheet); e && (C._cssText = T(e, A())); } if ("input" === w || "textarea" === w || "select" === w) { let e = t.value, r = t.checked; "radio" !== C.type && "checkbox" !== C.type && "submit" !== C.type && "button" !== C.type && e ? C.value = m({ element: t, type: y(t), tagName: w, value: e, maskInputOptions: c, maskInputFn: l }) : r && (C.checked = r); } if ("option" === w && (t.selected && !c.select ? C.selected = !0 : delete C.selected), "canvas" === w && h) if ("2d" === t.__context) (function (e) { let t = e.getContext("2d"); if (!t) return !0; for (let r = 0; r < e.width; r += 50)for (let n = 0; n < e.height; n += 50) { let i = t.getImageData, o = _ in i ? i[_] : i; if (new Uint32Array(o.call(t, r, n, Math.min(50, e.width - r), Math.min(50, e.height - n)).data.buffer).some((e => 0 !== e))) return !1; } return !0; })(t) || (C.rr_dataURL = t.toDataURL(u.type, u.quality)); else if (!("__context" in t)) { let e = t.toDataURL(u.type, u.quality), r = document.createElement("canvas"); r.width = t.width, r.height = t.height, e !== r.toDataURL(u.type, u.quality) && (C.rr_dataURL = e); } if ("img" === w && p) { E || (E = i.createElement("canvas"), I = E.getContext("2d")); let e = t, r = e.crossOrigin; e.crossOrigin = "anonymous"; let n = () => { e.removeEventListener("load", n); try { E.width = e.naturalWidth, E.height = e.naturalHeight, I.drawImage(e, 0, 0), C.rr_dataURL = E.toDataURL(u.type, u.quality); } catch (t) { console.warn(`Cannot inline img src=${e.currentSrc}! Error: ${t}`); } r ? C.crossOrigin = r : e.removeAttribute("crossorigin"); }; e.complete && 0 !== e.naturalWidth ? n() : e.addEventListener("load", n); } if ("audio" === w || "video" === w) { let e = C; e.rr_mediaState = t.paused ? "paused" : "played", e.rr_mediaCurrentTime = t.currentTime, e.rr_mediaPlaybackRate = t.playbackRate, e.rr_mediaMuted = t.muted, e.rr_mediaLoop = t.loop, e.rr_mediaVolume = t.volume; } if (v || (t.scrollLeft && (C.rr_scrollLeft = t.scrollLeft), t.scrollTop && (C.rr_scrollTop = t.scrollTop)), S) { let { width: e, height: r } = t.getBoundingClientRect(); C = { class: C.class, rr_width: `${e}px`, rr_height: `${r}px` }; } "iframe" === w && !f(C.src) && (t.contentDocument || (C.rr_src = C.src), delete C.src); try { customElements.get(w) && (n = !0); } catch (e) { } return { type: e.Element, tagName: w, attributes: C, childNodes: [], isSVG: L(t) || void 0, needBlock: S, rootId: b, isCustom: n }; }(t, { doc: n, blockClass: o, blockSelector: s, inlineStylesheet: c, maskInputOptions: l, maskInputFn: p, dataURLOptions: h, inlineImages: f, recordCanvas: v, keepIframeSrcFn: b, newlyAddedElement: S, rootId: w }); case t.TEXT_NODE: return function (t, r) { var n; let { needsMask: i, maskTextFn: o, rootId: s } = r, a = t.parentNode && t.parentNode.tagName, c = t.textContent, l = "STYLE" === a || void 0, u = "SCRIPT" === a || void 0; if (l && c) { try { t.nextSibling || t.previousSibling || null !== (n = t.parentNode.sheet) && void 0 !== n && n.cssRules && (c = d(t.parentNode.sheet)); } catch (e) { console.warn(`Cannot get CSS styles from text's parentNode. Error: ${e}`, t); } c = T(c, A()); } return u && (c = "SCRIPT_PLACEHOLDER"), !l && !u && c && i && (c = o ? o(c, t.parentElement) : c.replace(/[\S]/g, "*")), { type: e.Text, textContent: c || "", isStyle: l, rootId: s }; }(t, { needsMask: a, maskTextFn: u, rootId: w }); case t.CDATA_SECTION_NODE: return { type: e.CDATA, textContent: "", rootId: w }; case t.COMMENT_NODE: return { type: e.Comment, textContent: t.textContent || "", rootId: w }; default: return !1; } } function j(e) { return null == e ? "" : e.toLowerCase(); } function B(t, r) { let { doc: n, mirror: i, blockClass: o, blockSelector: s, maskTextClass: a, maskTextSelector: c, skipChild: l = !1, inlineStylesheet: d = !0, maskInputOptions: h = {}, maskTextFn: f, maskInputFn: m, slimDOMOptions: g, dataURLOptions: _ = {}, inlineImages: y = !1, recordCanvas: b = !1, onSerialize: k, onIframeLoad: E, iframeLoadTimeout: I = 5e3, onStylesheetLoad: C, stylesheetLoadTimeout: M = 5e3, keepIframeSrcFn: O = (() => !1), newlyAddedElement: x = !1 } = r, { needsMask: T } = r, { preserveWhiteSpace: N = !0 } = r; !T && t.childNodes && (T = $(t, a, c, void 0 === T)); let D, R = U(t, { doc: n, mirror: i, blockClass: o, blockSelector: s, needsMask: T, inlineStylesheet: d, maskInputOptions: h, maskTextFn: f, maskInputFn: m, dataURLOptions: _, inlineImages: y, recordCanvas: b, keepIframeSrcFn: O, newlyAddedElement: x }); if (!R) return console.warn(t, "not serialized"), null; D = i.hasNode(t) ? i.getId(t) : function (t, r) { if (r.comment && t.type === e.Comment) return !0; if (t.type === e.Element) { if (r.script && ("script" === t.tagName || "link" === t.tagName && ("preload" === t.attributes.rel || "modulepreload" === t.attributes.rel) && "script" === t.attributes.as || "link" === t.tagName && "prefetch" === t.attributes.rel && "string" == typeof t.attributes.href && "js" === v(t.attributes.href))) return !0; if (r.headFavicon && ("link" === t.tagName && "shortcut icon" === t.attributes.rel || "meta" === t.tagName && (j(t.attributes.name).match(/^msapplication-tile(image|color)$/) || "application-name" === j(t.attributes.name) || "icon" === j(t.attributes.rel) || "apple-touch-icon" === j(t.attributes.rel) || "shortcut icon" === j(t.attributes.rel)))) return !0; if ("meta" === t.tagName) { if (r.headMetaDescKeywords && j(t.attributes.name).match(/^description|keywords$/)) return !0; if (r.headMetaSocial && (j(t.attributes.property).match(/^(og|twitter|fb):/) || j(t.attributes.name).match(/^(og|twitter):/) || "pinterest" === j(t.attributes.name))) return !0; if (r.headMetaRobots && ("robots" === j(t.attributes.name) || "googlebot" === j(t.attributes.name) || "bingbot" === j(t.attributes.name))) return !0; if (r.headMetaHttpEquiv && void 0 !== t.attributes["http-equiv"]) return !0; if (r.headMetaAuthorship && ("author" === j(t.attributes.name) || "generator" === j(t.attributes.name) || "framework" === j(t.attributes.name) || "publisher" === j(t.attributes.name) || "progid" === j(t.attributes.name) || j(t.attributes.property).match(/^article:/) || j(t.attributes.property).match(/^product:/))) return !0; if (r.headMetaVerification && ("google-site-verification" === j(t.attributes.name) || "yandex-verification" === j(t.attributes.name) || "csrf-token" === j(t.attributes.name) || "p:domain_verify" === j(t.attributes.name) || "verify-v1" === j(t.attributes.name) || "verification" === j(t.attributes.name) || "shopify-checkout-api-token" === j(t.attributes.name))) return !0; } } return !1; }(R, g) || !N && R.type === e.Text && !R.isStyle && !R.textContent.replace(/^\s+|\s+$/gm, "").length ? S : w(); let L = Object.assign(R, { id: D }); if (i.add(t, L), D === S) return null; k && k(t); let A = !l; if (L.type === e.Element) { A = A && !L.needBlock, delete L.needBlock; let e = t.shadowRoot; e && p(e) && (L.isShadowHost = !0); } if ((L.type === e.Document || L.type === e.Element) && A) { g.headWhitespace && L.type === e.Element && "head" === L.tagName && (N = !1); let r = { doc: n, mirror: i, blockClass: o, blockSelector: s, needsMask: T, maskTextClass: a, maskTextSelector: c, skipChild: l, inlineStylesheet: d, maskInputOptions: h, maskTextFn: f, maskInputFn: m, slimDOMOptions: g, dataURLOptions: _, inlineImages: y, recordCanvas: b, preserveWhiteSpace: N, onSerialize: k, onIframeLoad: E, iframeLoadTimeout: I, onStylesheetLoad: C, stylesheetLoadTimeout: M, keepIframeSrcFn: O }; if (L.type !== e.Element || "textarea" !== L.tagName || void 0 === L.attributes.value) for (let e of Array.from(t.childNodes)) { let t = B(e, r); t && L.childNodes.push(t); } if (function (e) { return e.nodeType === e.ELEMENT_NODE; }(t) && t.shadowRoot) for (let e of Array.from(t.shadowRoot.childNodes)) { let n = B(e, r); n && (p(t.shadowRoot) && (n.isShadow = !0), L.childNodes.push(n)); } } return t.parentNode && u(t.parentNode) && p(t.parentNode) && (L.isShadow = !0), L.type === e.Element && "iframe" === L.tagName && function (e, t, r) { let n = e.contentWindow; if (!n) return; let i, o = !1; try { i = n.document.readyState; } catch (e) { return; } if ("complete" !== i) { let n = setTimeout((() => { o || (t(), o = !0); }), r); return void e.addEventListener("load", (() => { clearTimeout(n), o = !0, t(); })); } let s = "about:blank"; if (n.location.href !== s || e.src === s || "" === e.src) return setTimeout(t, 0), e.addEventListener("load", t); e.addEventListener("load", t); }(t, (() => { let e = t.contentDocument; if (e && E) { let r = B(e, { doc: e, mirror: i, blockClass: o, blockSelector: s, needsMask: T, maskTextClass: a, maskTextSelector: c, skipChild: !1, inlineStylesheet: d, maskInputOptions: h, maskTextFn: f, maskInputFn: m, slimDOMOptions: g, dataURLOptions: _, inlineImages: y, recordCanvas: b, preserveWhiteSpace: N, onSerialize: k, onIframeLoad: E, iframeLoadTimeout: I, onStylesheetLoad: C, stylesheetLoadTimeout: M, keepIframeSrcFn: O }); r && E(t, r); } }), I), L.type === e.Element && "link" === L.tagName && "string" == typeof L.attributes.rel && ("stylesheet" === L.attributes.rel || "preload" === L.attributes.rel && "string" == typeof L.attributes.href && "css" === v(L.attributes.href)) && function (e, t, r) { let n, i = !1; try { n = e.sheet; } catch (e) { return; } if (n) return; let o = setTimeout((() => { i || (t(), i = !0); }), r); e.addEventListener("load", (() => { clearTimeout(o), i = !0, t(); })); }(t, (() => { if (C) { let e = B(t, { doc: n, mirror: i, blockClass: o, blockSelector: s, needsMask: T, maskTextClass: a, maskTextSelector: c, skipChild: !1, inlineStylesheet: d, maskInputOptions: h, maskTextFn: f, maskInputFn: m, slimDOMOptions: g, dataURLOptions: _, inlineImages: y, recordCanvas: b, preserveWhiteSpace: N, onSerialize: k, onIframeLoad: E, iframeLoadTimeout: I, onStylesheetLoad: C, stylesheetLoadTimeout: M, keepIframeSrcFn: O }); e && C(t, e); } }), M), L; } function V(e, t, r = document) { let n = { capture: !0, passive: !0 }; return r.addEventListener(e, t, n), () => r.removeEventListener(e, t, n); } var z = "Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.", W = { map: {}, getId: () => (console.error(z), -1), getNode: () => (console.error(z), null), removeNodeFromMap() { console.error(z); }, has: () => (console.error(z), !1), reset() { console.error(z); } }; function G(e, t, r = {}) { let n = null, i = 0; return function (...o) { let s = Date.now(); !i && !1 === r.leading && (i = s); let a = t - (s - i), c = this; a <= 0 || a > t ? (n && (clearTimeout(n), n = null), i = s, e.apply(c, o)) : !n && !1 !== r.trailing && (n = setTimeout((() => { i = !1 === r.leading ? 0 : Date.now(), n = null, e.apply(c, o); }), a)); }; } function H(e, t, r, n, i = window) { let o = i.Object.getOwnPropertyDescriptor(e, t); return i.Object.defineProperty(e, t, n ? r : { set(e) { setTimeout((() => { r.set.call(this, e); }), 0), o && o.set && o.set.call(this, e); } }), () => H(e, t, o || {}, !0); } function J(e, t, r) { try { if (!(t in e)) return () => { }; let n = e[t], i = r(n); return "function" == typeof i && (i.prototype = i.prototype || {}, Object.defineProperties(i, { __rrweb_original__: { enumerable: !1, value: n } })), e[t] = i, () => { e[t] = n; }; } catch (e) { return () => { }; } } "undefined" != typeof window && window.Proxy && window.Reflect && (W = new Proxy(W, { get: (e, t, r) => ("map" === t && console.error(z), Reflect.get(e, t, r)) })); var K = Date.now; function Q(e) { var t, r, n, i, o, s; let a = e.document; return { left: a.scrollingElement ? a.scrollingElement.scrollLeft : void 0 !== e.pageXOffset ? e.pageXOffset : (null == a ? void 0 : a.documentElement.scrollLeft) || (null === (r = null === (t = null == a ? void 0 : a.body) || void 0 === t ? void 0 : t.parentElement) || void 0 === r ? void 0 : r.scrollLeft) || (null === (n = null == a ? void 0 : a.body) || void 0 === n ? void 0 : n.scrollLeft) || 0, top: a.scrollingElement ? a.scrollingElement.scrollTop : void 0 !== e.pageYOffset ? e.pageYOffset : (null == a ? void 0 : a.documentElement.scrollTop) || (null === (o = null === (i = null == a ? void 0 : a.body) || void 0 === i ? void 0 : i.parentElement) || void 0 === o ? void 0 : o.scrollTop) || (null === (s = null == a ? void 0 : a.body) || void 0 === s ? void 0 : s.scrollTop) || 0 }; } function X() { return window.innerHeight || document.documentElement && document.documentElement.clientHeight || document.body && document.body.clientHeight; } function Y() { return window.innerWidth || document.documentElement && document.documentElement.clientWidth || document.body && document.body.clientWidth; } function Z(e) { return e ? e.nodeType === e.ELEMENT_NODE ? e : e.parentElement : null; } function ee(e, t, r, n) { if (!e) return !1; let i = Z(e); if (!i) return !1; try { if ("string" == typeof t) { if (i.classList.contains(t) || n && null !== i.closest("." + t)) return !0; } else if (F(i, t, n)) return !0; } catch (e) { } return !(!r || !(i.matches(r) || n && null !== i.closest(r))); } function te(e, t) { return t.getId(e) === S; } function re(e, t) { if (u(e)) return !1; let r = t.getId(e); return !t.has(r) || (!e.parentNode || e.parentNode.nodeType !== e.DOCUMENT_NODE) && (!e.parentNode || re(e.parentNode, t)); } function ne(e) { return Boolean(e.changedTouches); } function ie(e, t) { return Boolean("IFRAME" === e.nodeName && t.getMeta(e)); } function oe(e, t) { return Boolean("LINK" === e.nodeName && e.nodeType === e.ELEMENT_NODE && e.getAttribute && "stylesheet" === e.getAttribute("rel") && t.getMeta(e)); } function se(e) { return Boolean(null == e ? void 0 : e.shadowRoot); } /[1-9][0-9]{12}/.test(Date.now().toString()) || (K = () => (new Date).getTime()); var ae = class { constructor() { this.id = 1, this.styleIDMap = new WeakMap, this.idStyleMap = new Map; } getId(e) { var t; return null !== (t = this.styleIDMap.get(e)) && void 0 !== t ? t : -1; } has(e) { return this.styleIDMap.has(e); } add(e, t) { if (this.has(e)) return this.getId(e); let r; return r = void 0 === t ? this.id++ : t, this.styleIDMap.set(e, r), this.idStyleMap.set(r, e), r; } getStyle(e) { return this.idStyleMap.get(e) || null; } reset() { this.styleIDMap = new WeakMap, this.idStyleMap = new Map, this.id = 1; } generateId() { return this.id++; } }; function ce(e) { var t, r; let n = null; return (null === (r = null === (t = e.getRootNode) || void 0 === t ? void 0 : t.call(e)) || void 0 === r ? void 0 : r.nodeType) === Node.DOCUMENT_FRAGMENT_NODE && e.getRootNode().host && (n = e.getRootNode().host), n; } function le(e) { let t = e.ownerDocument; if (!t) return !1; let r = function (e) { let t, r = e; for (; t = ce(r);)r = t; return r; }(e); return t.contains(r); } function ue(e) { let t = e.ownerDocument; return !!t && (t.contains(e) || le(e)); } var pe = (e => (e[e.DomContentLoaded = 0] = "DomContentLoaded", e[e.Load = 1] = "Load", e[e.FullSnapshot = 2] = "FullSnapshot", e[e.IncrementalSnapshot = 3] = "IncrementalSnapshot", e[e.Meta = 4] = "Meta", e[e.Custom = 5] = "Custom", e[e.Plugin = 6] = "Plugin", e))(pe || {}), de = (e => (e[e.Mutation = 0] = "Mutation", e[e.MouseMove = 1] = "MouseMove", e[e.MouseInteraction = 2] = "MouseInteraction", e[e.Scroll = 3] = "Scroll", e[e.ViewportResize = 4] = "ViewportResize", e[e.Input = 5] = "Input", e[e.TouchMove = 6] = "TouchMove", e[e.MediaInteraction = 7] = "MediaInteraction", e[e.StyleSheetRule = 8] = "StyleSheetRule", e[e.CanvasMutation = 9] = "CanvasMutation", e[e.Font = 10] = "Font", e[e.Log = 11] = "Log", e[e.Drag = 12] = "Drag", e[e.StyleDeclaration = 13] = "StyleDeclaration", e[e.Selection = 14] = "Selection", e[e.AdoptedStyleSheet = 15] = "AdoptedStyleSheet", e[e.CustomElement = 16] = "CustomElement", e))(de || {}), he = (e => (e[e.MouseUp = 0] = "MouseUp", e[e.MouseDown = 1] = "MouseDown", e[e.Click = 2] = "Click", e[e.ContextMenu = 3] = "ContextMenu", e[e.DblClick = 4] = "DblClick", e[e.Focus = 5] = "Focus", e[e.Blur = 6] = "Blur", e[e.TouchStart = 7] = "TouchStart", e[e.TouchMove_Departed = 8] = "TouchMove_Departed", e[e.TouchEnd = 9] = "TouchEnd", e[e.TouchCancel = 10] = "TouchCancel", e))(he || {}), fe = (e => (e[e.Mouse = 0] = "Mouse", e[e.Pen = 1] = "Pen", e[e.Touch = 2] = "Touch", e))(fe || {}), me = (e => (e[e["2D"] = 0] = "2D", e[e.WebGL = 1] = "WebGL", e[e.WebGL2 = 2] = "WebGL2", e))(me || {}); function ge(e) { return "__ln" in e; } var _e, ye = class { constructor() { this.length = 0, this.head = null, this.tail = null; } get(e) { if (e >= this.length) throw new Error("Position outside of list range"); let t = this.head; for (let r = 0; r < e; r++)t = (null == t ? void 0 : t.next) || null; return t; } addNode(e) { let t = { value: e, previous: null, next: null }; if (e.__ln = t, e.previousSibling && ge(e.previousSibling)) { let r = e.previousSibling.__ln.next; t.next = r, t.previous = e.previousSibling.__ln, e.previousSibling.__ln.next = t, r && (r.previous = t); } else if (e.nextSibling && ge(e.nextSibling) && e.nextSibling.__ln.previous) { let r = e.nextSibling.__ln.previous; t.previous = r, t.next = e.nextSibling.__ln, e.nextSibling.__ln.previous = t, r && (r.next = t); } else this.head && (this.head.previous = t), t.next = this.head, this.head = t; null === t.next && (this.tail = t), this.length++; } removeNode(e) { let t = e.__ln; !this.head || (t.previous ? (t.previous.next = t.next, t.next ? t.next.previous = t.previous : this.tail = t.previous) : (this.head = t.next, this.head ? this.head.previous = null : this.tail = null), e.__ln && delete e.__ln, this.length--); } }, ve = (e, t) => `${e}@${t}`, be = class { constructor() { this.frozen = !1, this.locked = !1, this.texts = [], this.attributes = [], this.attributeMap = new WeakMap, this.removes = [], this.mapRemoves = [], this.movedMap = {}, this.addedSet = new Set, this.movedSet = new Set, this.droppedSet = new Set, this.processMutations = e => { e.forEach(this.processMutation), this.emit(); }, this.emit = () => { if (this.frozen || this.locked) return; let e = [], t = new Set, r = new ye, n = e => { let t = e, r = S; for (; r === S;)t = t && t.nextSibling, r = t && this.mirror.getId(t); return r; }, i = i => { if (!i.parentNode || !ue(i) || "TEXTAREA" === i.parentNode.tagName) return; let o = u(i.parentNode) ? this.mirror.getId(ce(i)) : this.mirror.getId(i.parentNode), s = n(i); if (-1 === o || -1 === s) return r.addNode(i); let a = B(i, { doc: this.doc, mirror: this.mirror, blockClass: this.blockClass, blockSelector: this.blockSelector, maskTextClass: this.maskTextClass, maskTextSelector: this.maskTextSelector, skipChild: !0, newlyAddedElement: !0, inlineStylesheet: this.inlineStylesheet, maskInputOptions: this.maskInputOptions, maskTextFn: this.maskTextFn, maskInputFn: this.maskInputFn, slimDOMOptions: this.slimDOMOptions, dataURLOptions: this.dataURLOptions, recordCanvas: this.recordCanvas, inlineImages: this.inlineImages, onSerialize: e => { ie(e, this.mirror) && this.iframeManager.addIframe(e), oe(e, this.mirror) && this.stylesheetManager.trackLinkElement(e), se(i) && this.shadowDomManager.addShadowRoot(i.shadowRoot, this.doc); }, onIframeLoad: (e, t) => { this.iframeManager.attachIframe(e, t), this.shadowDomManager.observeAttachShadow(e); }, onStylesheetLoad: (e, t) => { this.stylesheetManager.attachLinkElement(e, t); } }); a && (e.push({ parentId: o, nextId: s, node: a }), t.add(a.id)); }; for (; this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift()); for (let e of this.movedSet) Se(this.removes, e, this.mirror) && !this.movedSet.has(e.parentNode) || i(e); for (let e of this.addedSet) !Ee(this.droppedSet, e) && !Se(this.removes, e, this.mirror) || Ee(this.movedSet, e) ? i(e) : this.droppedSet.add(e); let o = null; for (; r.length;) { let e = null; if (o) { let t = this.mirror.getId(o.value.parentNode), r = n(o.value); -1 !== t && -1 !== r && (e = o); } if (!e) { let t = r.tail; for (; t;) { let r = t; if (t = t.previous, r) { let t = this.mirror.getId(r.value.parentNode); if (-1 === n(r.value)) continue; if (-1 !== t) { e = r; break; } { let t = r.value; if (t.parentNode && t.parentNode.nodeType === Node.DOCUMENT_FRAGMENT_NODE) { let n = t.parentNode.host; if (-1 !== this.mirror.getId(n)) { e = r; break; } } } } } } if (!e) { for (; r.head;)r.removeNode(r.head.value); break; } o = e.previous, r.removeNode(e.value), i(e.value); } let s = { texts: this.texts.map((e => { let t = e.node; return t.parentNode && "TEXTAREA" === t.parentNode.tagName && this.genTextAreaValueMutation(t.parentNode), { id: this.mirror.getId(t), value: e.value }; })).filter((e => !t.has(e.id))).filter((e => this.mirror.has(e.id))), attributes: this.attributes.map((e => { let { attributes: t } = e; if ("string" == typeof t.style) { let r = JSON.stringify(e.styleDiff), n = JSON.stringify(e._unchangedStyles); r.length < t.style.length && (r + n).split("var(").length === t.style.split("var(").length && (t.style = e.styleDiff); } return { id: this.mirror.getId(e.node), attributes: t }; })).filter((e => !t.has(e.id))).filter((e => this.mirror.has(e.id))), removes: this.removes, adds: e }; !s.texts.length && !s.attributes.length && !s.removes.length && !s.adds.length || (this.texts = [], this.attributes = [], this.attributeMap = new WeakMap, this.removes = [], this.addedSet = new Set, this.movedSet = new Set, this.droppedSet = new Set, this.movedMap = {}, this.mutationCb(s)); }, this.genTextAreaValueMutation = e => { let t = this.attributeMap.get(e); t || (t = { node: e, attributes: {}, styleDiff: {}, _unchangedStyles: {} }, this.attributes.push(t), this.attributeMap.set(e, t)), t.attributes.value = Array.from(e.childNodes, (e => e.textContent || "")).join(""); }, this.processMutation = e => { if (!te(e.target, this.mirror)) switch (e.type) { case "characterData": { let t = e.target.textContent; !ee(e.target, this.blockClass, this.blockSelector, !1) && t !== e.oldValue && this.texts.push({ value: $(e.target, this.maskTextClass, this.maskTextSelector, !0) && t ? this.maskTextFn ? this.maskTextFn(t, Z(e.target)) : t.replace(/[\S]/g, "*") : t, node: e.target }); break; } case "attributes": { let t = e.target, r = e.attributeName, n = e.target.getAttribute(r); if ("value" === r) { let e = y(t); n = m({ element: t, maskInputOptions: this.maskInputOptions, tagName: t.tagName, type: e, value: n, maskInputFn: this.maskInputFn }); } if (ee(e.target, this.blockClass, this.blockSelector, !1) || n === e.oldValue) return; let i = this.attributeMap.get(e.target); if ("IFRAME" === t.tagName && "src" === r && !this.keepIframeSrcFn(n)) { if (t.contentDocument) return; r = "rr_src"; } if (i || (i = { node: e.target, attributes: {}, styleDiff: {}, _unchangedStyles: {} }, this.attributes.push(i), this.attributeMap.set(e.target, i)), "type" === r && "INPUT" === t.tagName && "password" === (e.oldValue || "").toLowerCase() && t.setAttribute("data-rr-is-password", "true"), !q(t.tagName, r) && (i.attributes[r] = P(this.doc, g(t.tagName), g(r), n), "style" === r)) { if (!this.unattachedDoc) try { this.unattachedDoc = document.implementation.createHTMLDocument(); } catch (e) { this.unattachedDoc = this.doc; } let r = this.unattachedDoc.createElement("span"); e.oldValue && r.setAttribute("style", e.oldValue); for (let e of Array.from(t.style)) { let n = t.style.getPropertyValue(e), o = t.style.getPropertyPriority(e); n !== r.style.getPropertyValue(e) || o !== r.style.getPropertyPriority(e) ? i.styleDiff[e] = "" === o ? n : [n, o] : i._unchangedStyles[e] = [n, o]; } for (let e of Array.from(r.style)) "" === t.style.getPropertyValue(e) && (i.styleDiff[e] = !1); } break; } case "childList": if (ee(e.target, this.blockClass, this.blockSelector, !0)) return; if ("TEXTAREA" === e.target.tagName) return void this.genTextAreaValueMutation(e.target); e.addedNodes.forEach((t => this.genAdds(t, e.target))), e.removedNodes.forEach((t => { let r = this.mirror.getId(t), n = u(e.target) ? this.mirror.getId(e.target.host) : this.mirror.getId(e.target); ee(e.target, this.blockClass, this.blockSelector, !1) || te(t, this.mirror) || !function (e, t) { return -1 !== t.getId(e); }(t, this.mirror) || (this.addedSet.has(t) ? (ke(this.addedSet, t), this.droppedSet.add(t)) : this.addedSet.has(e.target) && -1 === r || re(e.target, this.mirror) || (this.movedSet.has(t) && this.movedMap[ve(r, n)] ? ke(this.movedSet, t) : this.removes.push({ parentId: n, id: r, isShadow: !(!u(e.target) || !p(e.target)) || void 0 })), this.mapRemoves.push(t)); })); } }, this.genAdds = (e, t) => { if (!this.processedNodeManager.inOtherBuffer(e, this) && !this.addedSet.has(e) && !this.movedSet.has(e)) { if (this.mirror.hasNode(e)) { if (te(e, this.mirror)) return; this.movedSet.add(e); let r = null; t && this.mirror.hasNode(t) && (r = this.mirror.getId(t)), r && -1 !== r && (this.movedMap[ve(this.mirror.getId(e), r)] = !0); } else this.addedSet.add(e), this.droppedSet.delete(e); ee(e, this.blockClass, this.blockSelector, !1) || (e.childNodes.forEach((e => this.genAdds(e))), se(e) && e.shadowRoot.childNodes.forEach((t => { this.processedNodeManager.add(t, this), this.genAdds(t, e); }))); } }; } init(e) { ["mutationCb", "blockClass", "blockSelector", "maskTextClass", "maskTextSelector", "inlineStylesheet", "maskInputOptions", "maskTextFn", "maskInputFn", "keepIframeSrcFn", "recordCanvas", "inlineImages", "slimDOMOptions", "dataURLOptions", "doc", "mirror", "iframeManager", "stylesheetManager", "shadowDomManager", "canvasManager", "processedNodeManager"].forEach((t => { this[t] = e[t]; })); } freeze() { this.frozen = !0, this.canvasManager.freeze(); } unfreeze() { this.frozen = !1, this.canvasManager.unfreeze(), this.emit(); } isFrozen() { return this.frozen; } lock() { this.locked = !0, this.canvasManager.lock(); } unlock() { this.locked = !1, this.canvasManager.unlock(), this.emit(); } reset() { this.shadowDomManager.reset(), this.canvasManager.reset(); } }; function ke(e, t) { e.delete(t), t.childNodes.forEach((t => ke(e, t))); } function Se(e, t, r) { return 0 !== e.length && we(e, t, r); } function we(e, t, r) { let { parentNode: n } = t; if (!n) return !1; let i = r.getId(n); return !!e.some((e => e.id === i)) || we(e, n, r); } function Ee(e, t) { return 0 !== e.size && Ie(e, t); } function Ie(e, t) { let { parentNode: r } = t; return !!r && (!!e.has(r) || Ie(e, r)); } var Ce = e => _e ? (...t) => { try { return e(...t); } catch (e) { if (_e && !0 === _e(e)) return; throw e; } } : e, Me = []; function Oe(e) { try { if ("composedPath" in e) { let t = e.composedPath(); if (t.length) return t[0]; } else if ("path" in e && e.path.length) return e.path[0]; } catch (e) { } return e && e.target; } function xe(e, t) { var r, n; let i = new be; Me.push(i), i.init(e); let o = window.MutationObserver || window.__rrMutationObserver, s = null === (n = null === (r = null == window ? void 0 : window.Zone) || void 0 === r ? void 0 : r.__symbol__) || void 0 === n ? void 0 : n.call(r, "MutationObserver"); s && window[s] && (o = window[s]); let a = new o(Ce(i.processMutations.bind(i))); return a.observe(t, { attributes: !0, attributeOldValue: !0, characterData: !0, characterDataOldValue: !0, childList: !0, subtree: !0 }), a; } function Te({ mouseInteractionCb: e, doc: t, mirror: r, blockClass: n, blockSelector: i, sampling: o }) { if (!1 === o.mouseInteraction) return () => { }; let s = !0 === o.mouseInteraction || void 0 === o.mouseInteraction ? {} : o.mouseInteraction, a = [], c = null; return Object.keys(he).filter((e => Number.isNaN(Number(e)) && !e.endsWith("_Departed") && !1 !== s[e])).forEach((o => { let s = g(o), l = (t => o => { let s = Oe(o); if (ee(s, n, i, !0)) return; let a = null, l = t; if ("pointerType" in o) { switch (o.pointerType) { case "mouse": a = fe.Mouse; break; case "touch": a = fe.Touch; break; case "pen": a = fe.Pen; }a === fe.Touch ? he[t] === he.MouseDown ? l = "TouchStart" : he[t] === he.MouseUp && (l = "TouchEnd") : fe.Pen; } else ne(o) && (a = fe.Touch); null !== a ? (c = a, (l.startsWith("Touch") && a === fe.Touch || l.startsWith("Mouse") && a === fe.Mouse) && (a = null)) : he[t] === he.Click && (a = c, c = null); let u = ne(o) ? o.changedTouches[0] : o; if (!u) return; let p = r.getId(s), { clientX: d, clientY: h } = u; Ce(e)(Object.assign({ type: he[l], id: p, x: d, y: h }, null !== a && { pointerType: a })); })(o); if (window.PointerEvent) switch (he[o]) { case he.MouseDown: case he.MouseUp: s = s.replace("mouse", "pointer"); break; case he.TouchStart: case he.TouchEnd: return; }a.push(V(s, l, t)); })), Ce((() => { a.forEach((e => e())); })); } function Ne({ scrollCb: e, doc: t, mirror: r, blockClass: n, blockSelector: i, sampling: o }) { return V("scroll", Ce(G(Ce((o => { let s = Oe(o); if (!s || ee(s, n, i, !0)) return; let a = r.getId(s); if (s === t && t.defaultView) { let r = Q(t.defaultView); e({ id: a, x: r.left, y: r.top }); } else e({ id: a, x: s.scrollLeft, y: s.scrollTop }); })), o.scroll || 100)), t); } var De = ["INPUT", "TEXTAREA", "SELECT"], Re = new WeakMap; function Le(e) { return function (e, t) { if (Fe("CSSGroupingRule") && e.parentRule instanceof CSSGroupingRule || Fe("CSSMediaRule") && e.parentRule instanceof CSSMediaRule || Fe("CSSSupportsRule") && e.parentRule instanceof CSSSupportsRule || Fe("CSSConditionRule") && e.parentRule instanceof CSSConditionRule) { let r = Array.from(e.parentRule.cssRules).indexOf(e); t.unshift(r); } else if (e.parentStyleSheet) { let r = Array.from(e.parentStyleSheet.cssRules).indexOf(e); t.unshift(r); } return t; }(e, []); } function Ae(e, t, r) { let n, i; return e ? (e.ownerNode ? n = t.getId(e.ownerNode) : i = r.getId(e), { styleId: i, id: n }) : {}; } function Pe({ mirror: e, stylesheetManager: t }, r) { var n, i, o; let s = null; s = "#document" === r.nodeName ? e.getId(r) : e.getId(r.host); let a = "#document" === r.nodeName ? null === (n = r.defaultView) || void 0 === n ? void 0 : n.Document : null === (o = null === (i = r.ownerDocument) || void 0 === i ? void 0 : i.defaultView) || void 0 === o ? void 0 : o.ShadowRoot, c = null != a && a.prototype ? Object.getOwnPropertyDescriptor(null == a ? void 0 : a.prototype, "adoptedStyleSheets") : void 0; return null !== s && -1 !== s && a && c ? (Object.defineProperty(r, "adoptedStyleSheets", { configurable: c.configurable, enumerable: c.enumerable, get() { var e; return null === (e = c.get) || void 0 === e ? void 0 : e.call(this); }, set(e) { var r; let n = null === (r = c.set) || void 0 === r ? void 0 : r.call(this, e); if (null !== s && -1 !== s) try { t.adoptStyleSheets(e, s); } catch (e) { } return n; } }), Ce((() => { Object.defineProperty(r, "adoptedStyleSheets", { configurable: c.configurable, enumerable: c.enumerable, get: c.get, set: c.set }); }))) : () => { }; } function qe(e, t = {}) { let r, n = e.doc.defaultView; if (!n) return () => { }; !function (e, t) { let { mutationCb: r, mousemoveCb: n, mouseInteractionCb: i, scrollCb: o, viewportResizeCb: s, inputCb: a, mediaInteractionCb: c, styleSheetRuleCb: l, styleDeclarationCb: u, canvasMutationCb: p, fontCb: d, selectionCb: h, customElementCb: f } = e; e.mutationCb = (...e) => { t.mutation && t.mutation(...e), r(...e); }, e.mousemoveCb = (...e) => { t.mousemove && t.mousemove(...e), n(...e); }, e.mouseInteractionCb = (...e) => { t.mouseInteraction && t.mouseInteraction(...e), i(...e); }, e.scrollCb = (...e) => { t.scroll && t.scroll(...e), o(...e); }, e.viewportResizeCb = (...e) => { t.viewportResize && t.viewportResize(...e), s(...e); }, e.inputCb = (...e) => { t.input && t.input(...e), a(...e); }, e.mediaInteractionCb = (...e) => { t.mediaInteaction && t.mediaInteaction(...e), c(...e); }, e.styleSheetRuleCb = (...e) => { t.styleSheetRule && t.styleSheetRule(...e), l(...e); }, e.styleDeclarationCb = (...e) => { t.styleDeclaration && t.styleDeclaration(...e), u(...e); }, e.canvasMutationCb = (...e) => { t.canvasMutation && t.canvasMutation(...e), p(...e); }, e.fontCb = (...e) => { t.font && t.font(...e), d(...e); }, e.selectionCb = (...e) => { t.selection && t.selection(...e), h(...e); }, e.customElementCb = (...e) => { t.customElement && t.customElement(...e), f(...e); }; }(e, t), e.recordDOM && (r = xe(e, e.doc)); let i = function ({ mousemoveCb: e, sampling: t, doc: r, mirror: n }) { if (!1 === t.mousemove) return () => { }; let i, o = "number" == typeof t.mousemove ? t.mousemove : 50, s = "number" == typeof t.mousemoveCallback ? t.mousemoveCallback : 500, a = [], c = G(Ce((t => { let r = Date.now() - i; e(a.map((e => (e.timeOffset -= r, e))), t), a = [], i = null; })), s), l = Ce(G(Ce((e => { let t = Oe(e), { clientX: r, clientY: o } = ne(e) ? e.changedTouches[0] : e; i || (i = K()), a.push({ x: r, y: o, id: n.getId(t), timeOffset: K() - i }), c("undefined" != typeof DragEvent && e instanceof DragEvent ? de.Drag : e instanceof MouseEvent ? de.MouseMove : de.TouchMove); })), o, { trailing: !1 })), u = [V("mousemove", l, r), V("touchmove", l, r), V("drag", l, r)]; return Ce((() => { u.forEach((e => e())); })); }(e), o = Te(e), s = Ne(e), a = function ({ viewportResizeCb: e }, { win: t }) { let r = -1, n = -1; return V("resize", Ce(G(Ce((() => { let t = X(), i = Y(); (r !== t || n !== i) && (e({ width: Number(i), height: Number(t) }), r = t, n = i); })), 200)), t); }(e, { win: n }), c = function ({ inputCb: e, doc: t, mirror: r, blockClass: n, blockSelector: i, ignoreClass: o, ignoreSelector: s, maskInputOptions: a, maskInputFn: c, sampling: l, userTriggeredOnInput: u }) { function p(e) { let r = Oe(e), l = e.isTrusted, p = r && r.tagName; if (r && "OPTION" === p && (r = r.parentElement), !r || !p || De.indexOf(p) < 0 || ee(r, n, i, !0) || r.classList.contains(o) || s && r.matches(s)) return; let h = r.value, f = !1, g = y(r) || ""; "radio" === g || "checkbox" === g ? f = r.checked : (a[p.toLowerCase()] || a[g]) && (h = m({ element: r, maskInputOptions: a, tagName: p, type: g, value: h, maskInputFn: c })), d(r, u ? { text: h, isChecked: f, userTriggered: l } : { text: h, isChecked: f }); let _ = r.name; "radio" === g && _ && f && t.querySelectorAll(`input[type="radio"][name="${_}"]`).forEach((e => { if (e !== r) { let t = e.value; d(e, u ? { text: t, isChecked: !f, userTriggered: !1 } : { text: t, isChecked: !f }); } })); } function d(t, n) { let i = Re.get(t); if (!i || i.text !== n.text || i.isChecked !== n.isChecked) { Re.set(t, n); let i = r.getId(t); Ce(e)(Object.assign(Object.assign({}, n), { id: i })); } } let h = ("last" === l.input ? ["change"] : ["input", "change"]).map((e => V(e, Ce(p), t))), f = t.defaultView; if (!f) return () => { h.forEach((e => e())); }; let g = f.Object.getOwnPropertyDescriptor(f.HTMLInputElement.prototype, "value"), _ = [[f.HTMLInputElement.prototype, "value"], [f.HTMLInputElement.prototype, "checked"], [f.HTMLSelectElement.prototype, "value"], [f.HTMLTextAreaElement.prototype, "value"], [f.HTMLSelectElement.prototype, "selectedIndex"], [f.HTMLOptionElement.prototype, "selected"]]; return g && g.set && h.push(..._.map((e => H(e[0], e[1], { set() { Ce(p)({ target: this, isTrusted: !1 }); } }, !1, f)))), Ce((() => { h.forEach((e => e())); })); }(e), l = function ({ mediaInteractionCb: e, blockClass: t, blockSelector: r, mirror: n, sampling: i, doc: o }) { let s = Ce((o => G(Ce((i => { let s = Oe(i); if (!s || ee(s, t, r, !0)) return; let { currentTime: a, volume: c, muted: l, playbackRate: u, loop: p } = s; e({ type: o, id: n.getId(s), currentTime: a, volume: c, muted: l, playbackRate: u, loop: p }); })), i.media || 500))), a = [V("play", s(0), o), V("pause", s(1), o), V("seeked", s(2), o), V("volumechange", s(3), o), V("ratechange", s(4), o)]; return Ce((() => { a.forEach((e => e())); })); }(e), u = () => { }, p = () => { }, d = () => { }, h = () => { }; e.recordDOM && (u = function ({ styleSheetRuleCb: e, mirror: t, stylesheetManager: r }, { win: n }) { if (!n.CSSStyleSheet || !n.CSSStyleSheet.prototype) return () => { }; let i = n.CSSStyleSheet.prototype.insertRule; n.CSSStyleSheet.prototype.insertRule = new Proxy(i, { apply: Ce(((n, i, o) => { let [s, a] = o, { id: c, styleId: l } = Ae(i, t, r.styleMirror); return (c && -1 !== c || l && -1 !== l) && e({ id: c, styleId: l, adds: [{ rule: s, index: a }] }), n.apply(i, o); })) }); let o, s, a = n.CSSStyleSheet.prototype.deleteRule; n.CSSStyleSheet.prototype.deleteRule = new Proxy(a, { apply: Ce(((n, i, o) => { let [s] = o, { id: a, styleId: c } = Ae(i, t, r.styleMirror); return (a && -1 !== a || c && -1 !== c) && e({ id: a, styleId: c, removes: [{ index: s }] }), n.apply(i, o); })) }), n.CSSStyleSheet.prototype.replace && (o = n.CSSStyleSheet.prototype.replace, n.CSSStyleSheet.prototype.replace = new Proxy(o, { apply: Ce(((n, i, o) => { let [s] = o, { id: a, styleId: c } = Ae(i, t, r.styleMirror); return (a && -1 !== a || c && -1 !== c) && e({ id: a, styleId: c, replace: s }), n.apply(i, o); })) })), n.CSSStyleSheet.prototype.replaceSync && (s = n.CSSStyleSheet.prototype.replaceSync, n.CSSStyleSheet.prototype.replaceSync = new Proxy(s, { apply: Ce(((n, i, o) => { let [s] = o, { id: a, styleId: c } = Ae(i, t, r.styleMirror); return (a && -1 !== a || c && -1 !== c) && e({ id: a, styleId: c, replaceSync: s }), n.apply(i, o); })) })); let c = {}; $e("CSSGroupingRule") ? c.CSSGroupingRule = n.CSSGroupingRule : ($e("CSSMediaRule") && (c.CSSMediaRule = n.CSSMediaRule), $e("CSSConditionRule") && (c.CSSConditionRule = n.CSSConditionRule), $e("CSSSupportsRule") && (c.CSSSupportsRule = n.CSSSupportsRule)); let l = {}; return Object.entries(c).forEach((([n, i]) => { l[n] = { insertRule: i.prototype.insertRule, deleteRule: i.prototype.deleteRule }, i.prototype.insertRule = new Proxy(l[n].insertRule, { apply: Ce(((n, i, o) => { let [s, a] = o, { id: c, styleId: l } = Ae(i.parentStyleSheet, t, r.styleMirror); return (c && -1 !== c || l && -1 !== l) && e({ id: c, styleId: l, adds: [{ rule: s, index: [...Le(i), a || 0] }] }), n.apply(i, o); })) }), i.prototype.deleteRule = new Proxy(l[n].deleteRule, { apply: Ce(((n, i, o) => { let [s] = o, { id: a, styleId: c } = Ae(i.parentStyleSheet, t, r.styleMirror); return (a && -1 !== a || c && -1 !== c) && e({ id: a, styleId: c, removes: [{ index: [...Le(i), s] }] }), n.apply(i, o); })) }); })), Ce((() => { n.CSSStyleSheet.prototype.insertRule = i, n.CSSStyleSheet.prototype.deleteRule = a, o && (n.CSSStyleSheet.prototype.replace = o), s && (n.CSSStyleSheet.prototype.replaceSync = s), Object.entries(c).forEach((([e, t]) => { t.prototype.insertRule = l[e].insertRule, t.prototype.deleteRule = l[e].deleteRule; })); })); }(e, { win: n }), p = Pe(e, e.doc), d = function ({ styleDeclarationCb: e, mirror: t, ignoreCSSAttributes: r, stylesheetManager: n }, { win: i }) { let o = i.CSSStyleDeclaration.prototype.setProperty; i.CSSStyleDeclaration.prototype.setProperty = new Proxy(o, { apply: Ce(((i, s, a) => { var c; let [l, u, p] = a; if (r.has(l)) return o.apply(s, [l, u, p]); let { id: d, styleId: h } = Ae(null === (c = s.parentRule) || void 0 === c ? void 0 : c.parentStyleSheet, t, n.styleMirror); return (d && -1 !== d || h && -1 !== h) && e({ id: d, styleId: h, set: { property: l, value: u, priority: p }, index: Le(s.parentRule) }), i.apply(s, a); })) }); let s = i.CSSStyleDeclaration.prototype.removeProperty; return i.CSSStyleDeclaration.prototype.removeProperty = new Proxy(s, { apply: Ce(((i, o, a) => { var c; let [l] = a; if (r.has(l)) return s.apply(o, [l]); let { id: u, styleId: p } = Ae(null === (c = o.parentRule) || void 0 === c ? void 0 : c.parentStyleSheet, t, n.styleMirror); return (u && -1 !== u || p && -1 !== p) && e({ id: u, styleId: p, remove: { property: l }, index: Le(o.parentRule) }), i.apply(o, a); })) }), Ce((() => { i.CSSStyleDeclaration.prototype.setProperty = o, i.CSSStyleDeclaration.prototype.removeProperty = s; })); }(e, { win: n }), e.collectFonts && (h = function ({ fontCb: e, doc: t }) { let r = t.defaultView; if (!r) return () => { }; let n = [], i = new WeakMap, o = r.FontFace; r.FontFace = function (e, t, r) { let n = new o(e, t, r); return i.set(n, { family: e, buffer: "string" != typeof t, descriptors: r, fontSource: "string" == typeof t ? t : JSON.stringify(Array.from(new Uint8Array(t))) }), n; }; let s = J(t.fonts, "add", (function (t) { return function (r) { return setTimeout(Ce((() => { let t = i.get(r); t && (e(t), i.delete(r)); })), 0), t.apply(this, [r]); }; })); return n.push((() => { r.FontFace = o; })), n.push(s), Ce((() => { n.forEach((e => e())); })); }(e))); let f = function (e) { let { doc: t, mirror: r, blockClass: n, blockSelector: i, selectionCb: o } = e, s = !0, a = Ce((() => { let e = t.getSelection(); if (!e || s && (null == e ? void 0 : e.isCollapsed)) return; s = e.isCollapsed || !1; let a = [], c = e.rangeCount || 0; for (let t = 0; t < c; t++) { let o = e.getRangeAt(t), { startContainer: s, startOffset: c, endContainer: l, endOffset: u } = o; ee(s, n, i, !0) || ee(l, n, i, !0) || a.push({ start: r.getId(s), startOffset: c, end: r.getId(l), endOffset: u }); } o({ ranges: a }); })); return a(), V("selectionchange", a); }(e), g = function ({ doc: e, customElementCb: t }) { let r = e.defaultView; return r && r.customElements ? J(r.customElements, "define", (function (e) { return function (r, n, i) { try { t({ define: { name: r } }); } catch (e) { console.warn(`Custom element callback failed for ${r}`); } return e.apply(this, [r, n, i]); }; })) : () => { }; }(e), _ = []; for (let t of e.plugins) _.push(t.observer(t.callback, n, t.options)); return Ce((() => { Me.forEach((e => e.reset())), null == r || r.disconnect(), i(), o(), s(), a(), c(), l(), u(), p(), d(), h(), f(), g(), _.forEach((e => e())); })); } function Fe(e) { return void 0 !== window[e]; } function $e(e) { return Boolean(void 0 !== window[e] && window[e].prototype && "insertRule" in window[e].prototype && "deleteRule" in window[e].prototype); } var Ue = class { constructor(e) { this.generateIdFn = e, this.iframeIdToRemoteIdMap = new WeakMap, this.iframeRemoteIdToIdMap = new WeakMap; } getId(e, t, r, n) { let i = r || this.getIdToRemoteIdMap(e), o = n || this.getRemoteIdToIdMap(e), s = i.get(t); return s || (s = this.generateIdFn(), i.set(t, s), o.set(s, t)), s; } getIds(e, t) { let r = this.getIdToRemoteIdMap(e), n = this.getRemoteIdToIdMap(e); return t.map((t => this.getId(e, t, r, n))); } getRemoteId(e, t, r) { let n = r || this.getRemoteIdToIdMap(e); return "number" != typeof t ? t : n.get(t) || -1; } getRemoteIds(e, t) { let r = this.getRemoteIdToIdMap(e); return t.map((t => this.getRemoteId(e, t, r))); } reset(e) { if (!e) return this.iframeIdToRemoteIdMap = new WeakMap, void (this.iframeRemoteIdToIdMap = new WeakMap); this.iframeIdToRemoteIdMap.delete(e), this.iframeRemoteIdToIdMap.delete(e); } getIdToRemoteIdMap(e) { let t = this.iframeIdToRemoteIdMap.get(e); return t || (t = new Map, this.iframeIdToRemoteIdMap.set(e, t)), t; } getRemoteIdToIdMap(e) { let t = this.iframeRemoteIdToIdMap.get(e); return t || (t = new Map, this.iframeRemoteIdToIdMap.set(e, t)), t; } }, je = class { constructor(e) { this.iframes = new WeakMap, this.crossOriginIframeMap = new WeakMap, this.crossOriginIframeMirror = new Ue(w), this.crossOriginIframeRootIdMap = new WeakMap, this.mutationCb = e.mutationCb, this.wrappedEmit = e.wrappedEmit, this.stylesheetManager = e.stylesheetManager, this.recordCrossOriginIframes = e.recordCrossOriginIframes, this.crossOriginIframeStyleMirror = new Ue(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)), this.mirror = e.mirror, this.recordCrossOriginIframes && window.addEventListener("message", this.handleMessage.bind(this)); } addIframe(e) { this.iframes.set(e, !0), e.contentWindow && this.crossOriginIframeMap.set(e.contentWindow, e); } addLoadListener(e) { this.loadListener = e; } attachIframe(e, t) { var r; this.mutationCb({ adds: [{ parentId: this.mirror.getId(e), nextId: null, node: t }], removes: [], texts: [], attributes: [], isAttachIframe: !0 }), null === (r = this.loadListener) || void 0 === r || r.call(this, e), e.contentDocument && e.contentDocument.adoptedStyleSheets && e.contentDocument.adoptedStyleSheets.length > 0 && this.stylesheetManager.adoptStyleSheets(e.contentDocument.adoptedStyleSheets, this.mirror.getId(e.contentDocument)); } handleMessage(e) { let t = e; if ("rrweb" !== t.data.type || t.origin !== t.data.origin || !e.source) return; let r = this.crossOriginIframeMap.get(e.source); if (!r) return; let n = this.transformCrossOriginEvent(r, t.data.event); n && this.wrappedEmit(n, t.data.isCheckout); } transformCrossOriginEvent(e, t) { var r; switch (t.type) { case pe.FullSnapshot: { this.crossOriginIframeMirror.reset(e), this.crossOriginIframeStyleMirror.reset(e), this.replaceIdOnNode(t.data.node, e); let r = t.data.node.id; return this.crossOriginIframeRootIdMap.set(e, r), this.patchRootIdOnNode(t.data.node, r), { timestamp: t.timestamp, type: pe.IncrementalSnapshot, data: { source: de.Mutation, adds: [{ parentId: this.mirror.getId(e), nextId: null, node: t.data.node }], removes: [], texts: [], attributes: [], isAttachIframe: !0 } }; } case pe.Meta: case pe.Load: case pe.DomContentLoaded: return !1; case pe.Plugin: return t; case pe.Custom: return this.replaceIds(t.data.payload, e, ["id", "parentId", "previousId", "nextId"]), t; case pe.IncrementalSnapshot: switch (t.data.source) { case de.Mutation: return t.data.adds.forEach((t => { this.replaceIds(t, e, ["parentId", "nextId", "previousId"]), this.replaceIdOnNode(t.node, e); let r = this.crossOriginIframeRootIdMap.get(e); r && this.patchRootIdOnNode(t.node, r); })), t.data.removes.forEach((t => { this.replaceIds(t, e, ["parentId", "id"]); })), t.data.attributes.forEach((t => { this.replaceIds(t, e, ["id"]); })), t.data.texts.forEach((t => { this.replaceIds(t, e, ["id"]); })), t; case de.Drag: case de.TouchMove: case de.MouseMove: return t.data.positions.forEach((t => { this.replaceIds(t, e, ["id"]); })), t; case de.ViewportResize: return !1; case de.MediaInteraction: case de.MouseInteraction: case de.Scroll: case de.CanvasMutation: case de.Input: return this.replaceIds(t.data, e, ["id"]), t; case de.StyleSheetRule: case de.StyleDeclaration: return this.replaceIds(t.data, e, ["id"]), this.replaceStyleIds(t.data, e, ["styleId"]), t; case de.Font: return t; case de.Selection: return t.data.ranges.forEach((t => { this.replaceIds(t, e, ["start", "end"]); })), t; case de.AdoptedStyleSheet: return this.replaceIds(t.data, e, ["id"]), this.replaceStyleIds(t.data, e, ["styleIds"]), null === (r = t.data.styles) || void 0 === r || r.forEach((t => { this.replaceStyleIds(t, e, ["styleId"]); })), t; } }return !1; } replace(e, t, r, n) { for (let i of n) !Array.isArray(t[i]) && "number" != typeof t[i] || (Array.isArray(t[i]) ? t[i] = e.getIds(r, t[i]) : t[i] = e.getId(r, t[i])); return t; } replaceIds(e, t, r) { return this.replace(this.crossOriginIframeMirror, e, t, r); } replaceStyleIds(e, t, r) { return this.replace(this.crossOriginIframeStyleMirror, e, t, r); } replaceIdOnNode(e, t) { this.replaceIds(e, t, ["id", "rootId"]), "childNodes" in e && e.childNodes.forEach((e => { this.replaceIdOnNode(e, t); })); } patchRootIdOnNode(t, r) { t.type !== e.Document && !t.rootId && (t.rootId = r), "childNodes" in t && t.childNodes.forEach((e => { this.patchRootIdOnNode(e, r); })); } }, Be = class { constructor(e) { this.shadowDoms = new WeakSet, this.restoreHandlers = [], this.mutationCb = e.mutationCb, this.scrollCb = e.scrollCb, this.bypassOptions = e.bypassOptions, this.mirror = e.mirror, this.init(); } init() { this.reset(), this.patchAttachShadow(Element, document); } addShadowRoot(e, t) { if (!p(e) || this.shadowDoms.has(e)) return; this.shadowDoms.add(e); let r = xe(Object.assign(Object.assign({}, this.bypassOptions), { doc: t, mutationCb: this.mutationCb, mirror: this.mirror, shadowDomManager: this }), e); this.restoreHandlers.push((() => r.disconnect())), this.restoreHandlers.push(Ne(Object.assign(Object.assign({}, this.bypassOptions), { scrollCb: this.scrollCb, doc: e, mirror: this.mirror }))), setTimeout((() => { e.adoptedStyleSheets && e.adoptedStyleSheets.length > 0 && this.bypassOptions.stylesheetManager.adoptStyleSheets(e.adoptedStyleSheets, this.mirror.getId(e.host)), this.restoreHandlers.push(Pe({ mirror: this.mirror, stylesheetManager: this.bypassOptions.stylesheetManager }, e)); }), 0); } observeAttachShadow(e) { !e.contentWindow || !e.contentDocument || this.patchAttachShadow(e.contentWindow.Element, e.contentDocument); } patchAttachShadow(e, t) { let r = this; this.restoreHandlers.push(J(e.prototype, "attachShadow", (function (e) { return function (n) { let i = e.call(this, n); return this.shadowRoot && ue(this) && r.addShadowRoot(this.shadowRoot, t), i; }; }))); } reset() { this.restoreHandlers.forEach((e => { try { e(); } catch (e) { } })), this.restoreHandlers = [], this.shadowDoms = new WeakSet; } }; function Ve(e, t, r, n) { return new (r || (r = Promise))((function (i, o) { function s(e) { try { c(n.next(e)); } catch (e) { o(e); } } function a(e) { try { c(n.throw(e)); } catch (e) { o(e); } } function c(e) { e.done ? i(e.value) : function (e) { return e instanceof r ? e : new r((function (t) { t(e); })); }(e.value).then(s, a); } c((n = n.apply(e, t || [])).next()); })); } var ze = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", We = "undefined" == typeof Uint8Array ? [] : new Uint8Array(256); for (Ge = 0; Ge < 64; Ge++)We[ze.charCodeAt(Ge)] = Ge; var Ge, He = new Map; var Je = (e, t, r) => { if (!e || !Xe(e, t) && "object" != typeof e) return; let n = function (e, t) { let r = He.get(e); return r || (r = new Map, He.set(e, r)), r.has(t) || r.set(t, []), r.get(t); }(r, e.constructor.name), i = n.indexOf(e); return -1 === i && (i = n.length, n.push(e)), i; }; function Ke(e, t, r) { if (e instanceof Array) return e.map((e => Ke(e, t, r))); if (null === e) return e; if (e instanceof Float32Array || e instanceof Float64Array || e instanceof Int32Array || e instanceof Uint32Array || e instanceof Uint8Array || e instanceof Uint16Array || e instanceof Int16Array || e instanceof Int8Array || e instanceof Uint8ClampedArray) return { rr_type: e.constructor.name, args: [Object.values(e)] }; if (e instanceof ArrayBuffer) { let t = e.constructor.name, r = function (e) { var t, r = new Uint8Array(e), n = r.length, i = ""; for (t = 0; t < n; t += 3)i += ze[r[t] >> 2], i += ze[(3 & r[t]) << 4 | r[t + 1] >> 4], i += ze[(15 & r[t + 1]) << 2 | r[t + 2] >> 6], i += ze[63 & r[t + 2]]; return n % 3 == 2 ? i = i.substring(0, i.length - 1) + "=" : n % 3 == 1 && (i = i.substring(0, i.length - 2) + "=="), i; }(e); return { rr_type: t, base64: r }; } if (e instanceof DataView) return { rr_type: e.constructor.name, args: [Ke(e.buffer, t, r), e.byteOffset, e.byteLength] }; if (e instanceof HTMLImageElement) { let t = e.constructor.name, { src: r } = e; return { rr_type: t, src: r }; } if (e instanceof HTMLCanvasElement) { return { rr_type: "HTMLImageElement", src: e.toDataURL() }; } if (e instanceof ImageData) return { rr_type: e.constructor.name, args: [Ke(e.data, t, r), e.width, e.height] }; if (Xe(e, t) || "object" == typeof e) { return { rr_type: e.constructor.name, index: Je(e, t, r) }; } return e; } var Qe = (e, t, r) => e.map((e => Ke(e, t, r))), Xe = (e, t) => { let r = ["WebGLActiveInfo", "WebGLBuffer", "WebGLFramebuffer", "WebGLProgram", "WebGLRenderbuffer", "WebGLShader", "WebGLShaderPrecisionFormat", "WebGLTexture", "WebGLUniformLocation", "WebGLVertexArrayObject", "WebGLVertexArrayObjectOES"].filter((e => "function" == typeof t[e])); return Boolean(r.find((r => e instanceof t[r]))); }; function Ye(e, t, r, n) { let i = []; try { let o = J(e.HTMLCanvasElement.prototype, "getContext", (function (e) { return function (i, ...o) { if (!ee(this, t, r, !0)) { let e = function (e) { return "experimental-webgl" === e ? "webgl" : e; }(i); if ("__context" in this || (this.__context = e), n && ["webgl", "webgl2"].includes(e)) if (o[0] && "object" == typeof o[0]) { let e = o[0]; e.preserveDrawingBuffer || (e.preserveDrawingBuffer = !0); } else o.splice(0, 1, { preserveDrawingBuffer: !0 }); } return e.apply(this, [i, ...o]); }; })); i.push(o); } catch (e) { console.error("failed to patch HTMLCanvasElement.prototype.getContext"); } return () => { i.forEach((e => e())); }; } function Ze(e, t, r, n, i, o, s) { let a = [], c = Object.getOwnPropertyNames(e); for (let o of c) if (!["isContextLost", "canvas", "drawingBufferWidth", "drawingBufferHeight"].includes(o)) try { if ("function" != typeof e[o]) continue; let c = J(e, o, (function (e) { return function (...a) { let c = e.apply(this, a); if (Je(c, s, this), "tagName" in this.canvas && !ee(this.canvas, n, i, !0)) { let e = Qe(a, s, this), n = { type: t, property: o, args: e }; r(this.canvas, n); } return c; }; })); a.push(c); } catch (n) { let i = H(e, o, { set(e) { r(this.canvas, { type: t, property: o, args: [e], setter: !0 }); } }); a.push(i); } return a; } var et = function (e, t) { var r; return function (n) { return r = r || function (e, t) { var r = function (e, t) { var r = void 0 === t ? null : t, n = e.toString().split("\n"); n.pop(), n.shift(); for (var i = n[0].search(/\S/), o = /(['"])__worker_loader_strict__(['"])/g, s = 0, a = n.length; s < a; ++s)n[s] = n[s].substring(i).replace(o, "$1use strict$2") + "\n"; return r && n.push("//# sourceMappingURL=" + r + "\n"), n; }(e, t), n = new Blob(r, { type: "application/javascript" }); return URL.createObjectURL(n); }(e, t), new Worker(r, n); }; }((function () { !function () { function e(e, t, r, n) { return new (r || (r = Promise))((function (i, o) { function s(e) { try { c(n.next(e)); } catch (e) { o(e); } } function a(e) { try { c(n.throw(e)); } catch (e) { o(e); } } function c(e) { e.done ? i(e.value) : function (e) { return e instanceof r ? e : new r((function (t) { t(e); })); }(e.value).then(s, a); } c((n = n.apply(e, t || [])).next()); })); } for (var t = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", r = "undefined" == typeof Uint8Array ? [] : new Uint8Array(256), n = 0; n < 64; n++)r[t.charCodeAt(n)] = n; var i = function (e) { var r, n = new Uint8Array(e), i = n.length, o = ""; for (r = 0; r < i; r += 3)o += t[n[r] >> 2], o += t[(3 & n[r]) << 4 | n[r + 1] >> 4], o += t[(15 & n[r + 1]) << 2 | n[r + 2] >> 6], o += t[63 & n[r + 2]]; return i % 3 == 2 ? o = o.substring(0, o.length - 1) + "=" : i % 3 == 1 && (o = o.substring(0, o.length - 2) + "=="), o; }; let o = new Map, s = new Map; let a = self; a.onmessage = function (t) { return e(this, void 0, void 0, (function* () { if (!("OffscreenCanvas" in globalThis)) return a.postMessage({ id: t.data.id }); { let { id: r, bitmap: n, width: c, height: l, dataURLOptions: u } = t.data, p = function (t, r, n) { return e(this, void 0, void 0, (function* () { let e = `${t}-${r}`; if ("OffscreenCanvas" in globalThis) { if (s.has(e)) return s.get(e); let o = new OffscreenCanvas(t, r); o.getContext("2d"); let a = yield (yield o.convertToBlob(n)).arrayBuffer(), c = i(a); return s.set(e, c), c; } return ""; })); }(c, l, u), d = new OffscreenCanvas(c, l); d.getContext("2d").drawImage(n, 0, 0), n.close(); let h = yield d.convertToBlob(u), f = h.type, m = yield h.arrayBuffer(), g = i(m); if (!o.has(r) && (yield p) === g) return o.set(r, g), a.postMessage({ id: r }); if (o.get(r) === g) return a.postMessage({ id: r }); a.postMessage({ id: r, type: f, base64: g, width: c, height: l }), o.set(r, g); } })); }; }(); }), null), tt = class { reset() { this.pendingCanvasMutations.clear(), this.resetObservers && this.resetObservers(); } freeze() { this.frozen = !0; } unfreeze() { this.frozen = !1; } lock() { this.locked = !0; } unlock() { this.locked = !1; } constructor(e) { this.pendingCanvasMutations = new Map, this.rafStamps = { latestId: 0, invokeId: null }, this.frozen = !1, this.locked = !1, this.processMutation = (e, t) => { (this.rafStamps.invokeId && this.rafStamps.latestId !== this.rafStamps.invokeId || !this.rafStamps.invokeId) && (this.rafStamps.invokeId = this.rafStamps.latestId), this.pendingCanvasMutations.has(e) || this.pendingCanvasMutations.set(e, []), this.pendingCanvasMutations.get(e).push(t); }; let { sampling: t = "all", win: r, blockClass: n, blockSelector: i, recordCanvas: o, dataURLOptions: s } = e; this.mutationCb = e.mutationCb, this.mirror = e.mirror, o && "all" === t && this.initCanvasMutationObserver(r, n, i), o && "number" == typeof t && this.initCanvasFPSObserver(t, r, n, i, { dataURLOptions: s }); } initCanvasFPSObserver(e, t, r, n, i) { let o = Ye(t, r, n, !0), s = new Map, a = new et; a.onmessage = e => { let { id: t } = e.data; if (s.set(t, !1), !("base64" in e.data)) return; let { base64: r, type: n, width: i, height: o } = e.data; this.mutationCb({ id: t, type: me["2D"], commands: [{ property: "clearRect", args: [0, 0, i, o] }, { property: "drawImage", args: [{ rr_type: "ImageBitmap", args: [{ rr_type: "Blob", data: [{ rr_type: "ArrayBuffer", base64: r }], type: n }] }, 0, 0] }] }); }; let c, l = 1e3 / e, u = 0, p = e => { u && e - u < l || (u = e, (() => { let e = []; return t.document.querySelectorAll("canvas").forEach((t => { ee(t, r, n, !0) || e.push(t); })), e; })().forEach((e => Ve(this, void 0, void 0, (function* () { var t; let r = this.mirror.getId(e); if (s.get(r) || 0 === e.width || 0 === e.height) return; if (s.set(r, !0), ["webgl", "webgl2"].includes(e.__context)) { let r = e.getContext(e.__context); !1 === (null === (t = null == r ? void 0 : r.getContextAttributes()) || void 0 === t ? void 0 : t.preserveDrawingBuffer) && r.clear(r.COLOR_BUFFER_BIT); } let n = yield createImageBitmap(e); a.postMessage({ id: r, bitmap: n, width: e.width, height: e.height, dataURLOptions: i.dataURLOptions }, [n]); }))))), c = requestAnimationFrame(p); }; c = requestAnimationFrame(p), this.resetObservers = () => { o(), cancelAnimationFrame(c); }; } initCanvasMutationObserver(e, t, r) { this.startRAFTimestamping(), this.startPendingCanvasMutationFlusher(); let n = Ye(e, t, r, !1), i = function (e, t, r, n) { let i = [], o = Object.getOwnPropertyNames(t.CanvasRenderingContext2D.prototype); for (let s of o) try { if ("function" != typeof t.CanvasRenderingContext2D.prototype[s]) continue; let o = J(t.CanvasRenderingContext2D.prototype, s, (function (i) { return function (...o) { return ee(this.canvas, r, n, !0) || setTimeout((() => { let r = Qe(o, t, this); e(this.canvas, { type: me["2D"], property: s, args: r }); }), 0), i.apply(this, o); }; })); i.push(o); } catch (r) { let n = H(t.CanvasRenderingContext2D.prototype, s, { set(t) { e(this.canvas, { type: me["2D"], property: s, args: [t], setter: !0 }); } }); i.push(n); } return () => { i.forEach((e => e())); }; }(this.processMutation.bind(this), e, t, r), o = function (e, t, r, n, i) { let o = []; return o.push(...Ze(t.WebGLRenderingContext.prototype, me.WebGL, e, r, n, 0, t)), void 0 !== t.WebGL2RenderingContext && o.push(...Ze(t.WebGL2RenderingContext.prototype, me.WebGL2, e, r, n, 0, t)), () => { o.forEach((e => e())); }; }(this.processMutation.bind(this), e, t, r, this.mirror); this.resetObservers = () => { n(), i(), o(); }; } startPendingCanvasMutationFlusher() { requestAnimationFrame((() => this.flushPendingCanvasMutations())); } startRAFTimestamping() { let e = t => { this.rafStamps.latestId = t, requestAnimationFrame(e); }; requestAnimationFrame(e); } flushPendingCanvasMutations() { this.pendingCanvasMutations.forEach(((e, t) => { let r = this.mirror.getId(t); this.flushPendingCanvasMutationFor(t, r); })), requestAnimationFrame((() => this.flushPendingCanvasMutations())); } flushPendingCanvasMutationFor(e, t) { if (this.frozen || this.locked) return; let r = this.pendingCanvasMutations.get(e); if (!r || -1 === t) return; let n = r.map((e => function (e, t) { var r = {}; for (var n in e) Object.prototype.hasOwnProperty.call(e, n) && t.indexOf(n) < 0 && (r[n] = e[n]); if (null != e && "function" == typeof Object.getOwnPropertySymbols) { var i = 0; for (n = Object.getOwnPropertySymbols(e); i < n.length; i++)t.indexOf(n[i]) < 0 && Object.prototype.propertyIsEnumerable.call(e, n[i]) && (r[n[i]] = e[n[i]]); } return r; }(e, ["type"]))), { type: i } = r[0]; this.mutationCb({ id: t, type: i, commands: n }), this.pendingCanvasMutations.delete(e); } }, rt = class { constructor(e) { this.trackedLinkElements = new WeakSet, this.styleMirror = new ae, this.mutationCb = e.mutationCb, this.adoptedStyleSheetCb = e.adoptedStyleSheetCb; } attachLinkElement(e, t) { "_cssText" in t.attributes && this.mutationCb({ adds: [], removes: [], texts: [], attributes: [{ id: t.id, attributes: t.attributes }] }), this.trackLinkElement(e); } trackLinkElement(e) { this.trackedLinkElements.has(e) || (this.trackedLinkElements.add(e), this.trackStylesheetInLinkElement(e)); } adoptStyleSheets(e, t) { if (0 === e.length) return; let r = { id: t, styleIds: [] }, n = []; for (let t of e) { let e; this.styleMirror.has(t) ? e = this.styleMirror.getId(t) : (e = this.styleMirror.add(t), n.push({ styleId: e, rules: Array.from(t.rules || CSSRule, ((e, t) => ({ rule: h(e), index: t }))) })), r.styleIds.push(e); } n.length > 0 && (r.styles = n), this.adoptedStyleSheetCb(r); } reset() { this.styleMirror.reset(), this.trackedLinkElements = new WeakSet; } trackStylesheetInLinkElement(e) { } }, nt = class { constructor() { this.nodeMap = new WeakMap, this.loop = !0, this.periodicallyClear(); } periodicallyClear() { requestAnimationFrame((() => { this.clear(), this.loop && this.periodicallyClear(); })); } inOtherBuffer(e, t) { let r = this.nodeMap.get(e); return r && Array.from(r).some((e => e !== t)); } add(e, t) { this.nodeMap.set(e, (this.nodeMap.get(e) || new Set).add(t)); } clear() { this.nodeMap = new WeakMap; } destroy() { this.loop = !1; } }; function it(e) { return Object.assign(Object.assign({}, e), { timestamp: K() }); } var ot, st, at, ct = !1, lt = new f; function ut(e = {}) { let { emit: t, checkoutEveryNms: r, checkoutEveryNth: n, blockClass: i = "rr-block", blockSelector: o = null, ignoreClass: s = "rr-ignore", ignoreSelector: a = null, maskTextClass: c = "rr-mask", maskTextSelector: l = null, inlineStylesheet: u = !0, maskAllInputs: p, maskInputOptions: d, slimDOMOptions: h, maskInputFn: m, maskTextFn: g, hooks: _, packFn: y, sampling: v = {}, dataURLOptions: b = {}, mousemoveWait: k, recordDOM: S = !0, recordCanvas: w = !1, recordCrossOriginIframes: E = !1, recordAfter: I = ("DOMContentLoaded" === e.recordAfter ? e.recordAfter : "load"), userTriggeredOnInput: C = !1, collectFonts: M = !1, inlineImages: O = !1, plugins: x, keepIframeSrcFn: T = (() => !1), ignoreCSSAttributes: N = new Set([]), errorHandler: D } = e; !function (e) { _e = e; }(D); let R = !E || window.parent === window, L = !1; if (!R) try { window.parent.document && (L = !1); } catch (e) { L = !0; } if (R && !t) throw new Error("emit function is required"); void 0 !== k && void 0 === v.mousemove && (v.mousemove = k), lt.reset(); let A = !0 === p ? { color: !0, date: !0, "datetime-local": !0, email: !0, month: !0, number: !0, range: !0, search: !0, tel: !0, text: !0, time: !0, url: !0, week: !0, textarea: !0, select: !0, password: !0 } : void 0 !== d ? d : { password: !0 }, P = !0 === h || "all" === h ? { script: !0, comment: !0, headFavicon: !0, headWhitespace: !0, headMetaSocial: !0, headMetaRobots: !0, headMetaHttpEquiv: !0, headMetaVerification: !0, headMetaAuthorship: "all" === h, headMetaDescKeywords: "all" === h } : h || {}; !function (e = window) { "NodeList" in e && !e.NodeList.prototype.forEach && (e.NodeList.prototype.forEach = Array.prototype.forEach), "DOMTokenList" in e && !e.DOMTokenList.prototype.forEach && (e.DOMTokenList.prototype.forEach = Array.prototype.forEach), Node.prototype.contains || (Node.prototype.contains = (...e) => { let t = e[0]; if (!(0 in e)) throw new TypeError("1 argument is required"); do { if (this === t) return !0; } while (t = t && t.parentNode); return !1; }); }(); let q, F = 0, $ = e => { for (let t of x || []) t.eventProcessor && (e = t.eventProcessor(e)); return y && !L && (e = y(e)), e; }; ot = (e, i) => { var o; if ((null === (o = Me[0]) || void 0 === o ? void 0 : o.isFrozen()) && e.type !== pe.FullSnapshot && !(e.type === pe.IncrementalSnapshot && e.data.source === de.Mutation) && Me.forEach((e => e.unfreeze())), R) null == t || t($(e), i); else if (L) { let t = { type: "rrweb", event: $(e), origin: window.location.origin, isCheckout: i }; window.parent.postMessage(t, "*"); } if (e.type === pe.FullSnapshot) q = e, F = 0; else if (e.type === pe.IncrementalSnapshot) { if (e.data.source === de.Mutation && e.data.isAttachIframe) return; F++; let t = n && F >= n, i = r && e.timestamp - q.timestamp > r; (t || i) && st(!0); } }; let U = e => { ot(it({ type: pe.IncrementalSnapshot, data: Object.assign({ source: de.Mutation }, e) })); }, j = e => ot(it({ type: pe.IncrementalSnapshot, data: Object.assign({ source: de.Scroll }, e) })), z = e => ot(it({ type: pe.IncrementalSnapshot, data: Object.assign({ source: de.CanvasMutation }, e) })), W = new rt({ mutationCb: U, adoptedStyleSheetCb: e => ot(it({ type: pe.IncrementalSnapshot, data: Object.assign({ source: de.AdoptedStyleSheet }, e) })) }), G = new je({ mirror: lt, mutationCb: U, stylesheetManager: W, recordCrossOriginIframes: E, wrappedEmit: ot }); for (let e of x || []) e.getMirror && e.getMirror({ nodeMirror: lt, crossOriginIframeMirror: G.crossOriginIframeMirror, crossOriginIframeStyleMirror: G.crossOriginIframeStyleMirror }); let H = new nt; at = new tt({ recordCanvas: w, mutationCb: z, win: window, blockClass: i, blockSelector: o, mirror: lt, sampling: v.canvas, dataURLOptions: b }); let J = new Be({ mutationCb: U, scrollCb: j, bypassOptions: { blockClass: i, blockSelector: o, maskTextClass: c, maskTextSelector: l, inlineStylesheet: u, maskInputOptions: A, dataURLOptions: b, maskTextFn: g, maskInputFn: m, recordCanvas: w, inlineImages: O, sampling: v, slimDOMOptions: P, iframeManager: G, stylesheetManager: W, canvasManager: at, keepIframeSrcFn: T, processedNodeManager: H }, mirror: lt }); st = (e = !1) => { if (!S) return; ot(it({ type: pe.Meta, data: { href: window.location.href, width: Y(), height: X() } }), e), W.reset(), J.init(), Me.forEach((e => e.lock())); let t = function (e, t) { let { mirror: r = new f, blockClass: n = "rr-block", blockSelector: i = null, maskTextClass: o = "rr-mask", maskTextSelector: s = null, inlineStylesheet: a = !0, inlineImages: c = !1, recordCanvas: l = !1, maskAllInputs: u = !1, maskTextFn: p, maskInputFn: d, slimDOM: h = !1, dataURLOptions: m, preserveWhiteSpace: g, onSerialize: _, onIframeLoad: y, iframeLoadTimeout: v, onStylesheetLoad: b, stylesheetLoadTimeout: k, keepIframeSrcFn: S = (() => !1) } = t || {}; return B(e, { doc: e, mirror: r, blockClass: n, blockSelector: i, maskTextClass: o, maskTextSelector: s, skipChild: !1, inlineStylesheet: a, maskInputOptions: !0 === u ? { color: !0, date: !0, "datetime-local": !0, email: !0, month: !0, number: !0, range: !0, search: !0, tel: !0, text: !0, time: !0, url: !0, week: !0, textarea: !0, select: !0, password: !0 } : !1 === u ? { password: !0 } : u, maskTextFn: p, maskInputFn: d, slimDOMOptions: !0 === h || "all" === h ? { script: !0, comment: !0, headFavicon: !0, headWhitespace: !0, headMetaDescKeywords: "all" === h, headMetaSocial: !0, headMetaRobots: !0, headMetaHttpEquiv: !0, headMetaAuthorship: !0, headMetaVerification: !0 } : !1 === h ? {} : h, dataURLOptions: m, inlineImages: c, recordCanvas: l, preserveWhiteSpace: g, onSerialize: _, onIframeLoad: y, iframeLoadTimeout: v, onStylesheetLoad: b, stylesheetLoadTimeout: k, keepIframeSrcFn: S, newlyAddedElement: !1 }); }(document, { mirror: lt, blockClass: i, blockSelector: o, maskTextClass: c, maskTextSelector: l, inlineStylesheet: u, maskAllInputs: A, maskTextFn: g, slimDOM: P, dataURLOptions: b, recordCanvas: w, inlineImages: O, onSerialize: e => { ie(e, lt) && G.addIframe(e), oe(e, lt) && W.trackLinkElement(e), se(e) && J.addShadowRoot(e.shadowRoot, document); }, onIframeLoad: (e, t) => { G.attachIframe(e, t), J.observeAttachShadow(e); }, onStylesheetLoad: (e, t) => { W.attachLinkElement(e, t); }, keepIframeSrcFn: T }); if (!t) return console.warn("Failed to snapshot the document"); ot(it({ type: pe.FullSnapshot, data: { node: t, initialOffset: Q(window) } }), e), Me.forEach((e => e.unlock())), document.adoptedStyleSheets && document.adoptedStyleSheets.length > 0 && W.adoptStyleSheets(document.adoptedStyleSheets, lt.getId(document)); }; try { let e = [], t = e => { var t; return Ce(qe)({ mutationCb: U, mousemoveCb: (e, t) => ot(it({ type: pe.IncrementalSnapshot, data: { source: t, positions: e } })), mouseInteractionCb: e => ot(it({ type: pe.IncrementalSnapshot, data: Object.assign({ source: de.MouseInteraction }, e) })), scrollCb: j, viewportResizeCb: e => ot(it({ type: pe.IncrementalSnapshot, data: Object.assign({ source: de.ViewportResize }, e) })), inputCb: e => ot(it({ type: pe.IncrementalSnapshot, data: Object.assign({ source: de.Input }, e) })), mediaInteractionCb: e => ot(it({ type: pe.IncrementalSnapshot, data: Object.assign({ source: de.MediaInteraction }, e) })), styleSheetRuleCb: e => ot(it({ type: pe.IncrementalSnapshot, data: Object.assign({ source: de.StyleSheetRule }, e) })), styleDeclarationCb: e => ot(it({ type: pe.IncrementalSnapshot, data: Object.assign({ source: de.StyleDeclaration }, e) })), canvasMutationCb: z, fontCb: e => ot(it({ type: pe.IncrementalSnapshot, data: Object.assign({ source: de.Font }, e) })), selectionCb: e => { ot(it({ type: pe.IncrementalSnapshot, data: Object.assign({ source: de.Selection }, e) })); }, customElementCb: e => { ot(it({ type: pe.IncrementalSnapshot, data: Object.assign({ source: de.CustomElement }, e) })); }, blockClass: i, ignoreClass: s, ignoreSelector: a, maskTextClass: c, maskTextSelector: l, maskInputOptions: A, inlineStylesheet: u, sampling: v, recordDOM: S, recordCanvas: w, inlineImages: O, userTriggeredOnInput: C, collectFonts: M, doc: e, maskInputFn: m, maskTextFn: g, keepIframeSrcFn: T, blockSelector: o, slimDOMOptions: P, dataURLOptions: b, mirror: lt, iframeManager: G, stylesheetManager: W, shadowDomManager: J, processedNodeManager: H, canvasManager: at, ignoreCSSAttributes: N, plugins: (null === (t = null == x ? void 0 : x.filter((e => e.observer))) || void 0 === t ? void 0 : t.map((e => ({ observer: e.observer, options: e.options, callback: t => ot(it({ type: pe.Plugin, data: { plugin: e.name, payload: t } })) })))) || [] }, _); }; G.addLoadListener((r => { try { e.push(t(r.contentDocument)); } catch (e) { console.warn(e); } })); let r = () => { st(), e.push(t(document)), ct = !0; }; return "interactive" === document.readyState || "complete" === document.readyState ? r() : (e.push(V("DOMContentLoaded", (() => { ot(it({ type: pe.DomContentLoaded, data: {} })), "DOMContentLoaded" === I && r(); }))), e.push(V("load", (() => { ot(it({ type: pe.Load, data: {} })), "load" === I && r(); }), window))), () => { e.forEach((e => e())), H.destroy(), ct = !1, _e = void 0; }; } catch (e) { console.warn(e); } } ut.addCustomEvent = (e, t) => { if (!ct) throw new Error("please add custom event after start recording"); ot(it({ type: pe.Custom, data: { tag: e, payload: t } })); }, ut.freezePage = () => { Me.forEach((e => e.freeze())); }, ut.takeFullSnapshot = e => { if (!ct) throw new Error("please take full snapshot after start recording"); st(e); }, ut.mirror = lt; var pt, dt = (e => (e[e.DomContentLoaded = 0] = "DomContentLoaded", e[e.Load = 1] = "Load", e[e.FullSnapshot = 2] = "FullSnapshot", e[e.IncrementalSnapshot = 3] = "IncrementalSnapshot", e[e.Meta = 4] = "Meta", e[e.Custom = 5] = "Custom", e[e.Plugin = 6] = "Plugin", e))(dt || {}), ht = (e => (e[e.Mutation = 0] = "Mutation", e[e.MouseMove = 1] = "MouseMove", e[e.MouseInteraction = 2] = "MouseInteraction", e[e.Scroll = 3] = "Scroll", e[e.ViewportResize = 4] = "ViewportResize", e[e.Input = 5] = "Input", e[e.TouchMove = 6] = "TouchMove", e[e.MediaInteraction = 7] = "MediaInteraction", e[e.StyleSheetRule = 8] = "StyleSheetRule", e[e.CanvasMutation = 9] = "CanvasMutation", e[e.Font = 10] = "Font", e[e.Log = 11] = "Log", e[e.Drag = 12] = "Drag", e[e.StyleDeclaration = 13] = "StyleDeclaration", e[e.Selection = 14] = "Selection", e[e.AdoptedStyleSheet = 15] = "AdoptedStyleSheet", e[e.CustomElement = 16] = "CustomElement", e))(ht || {}), ft = { DEBUG: !1, LIB_VERSION: "2.55.0" }; "undefined" == typeof window ? pt = { navigator: { userAgent: "" }, document: { location: mt = { hostname: "" }, referrer: "" }, screen: { width: 0, height: 0 }, location: mt } : pt = window; var mt, gt = 864e5, _t = Array.prototype, yt = Function.prototype, vt = Object.prototype, bt = _t.slice, kt = vt.toString, St = vt.hasOwnProperty, wt = pt.console, Et = pt.navigator, It = pt.document, Ct = pt.opera, Mt = pt.screen, Ot = Et.userAgent, xt = yt.bind, Tt = _t.forEach, Nt = _t.indexOf, Dt = _t.map, Rt = Array.isArray, Lt = {}, At = { trim: function (e) { return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, ""); } }, Pt = { log: function () { if (ft.DEBUG && !At.isUndefined(wt) && wt) try { wt.log.apply(wt, arguments); } catch (e) { At.each(arguments, (function (e) { wt.log(e); })); } }, warn: function () { if (ft.DEBUG && !At.isUndefined(wt) && wt) { var e = ["Mixpanel warning:"].concat(At.toArray(arguments)); try { wt.warn.apply(wt, e); } catch (t) { At.each(e, (function (e) { wt.warn(e); })); } } }, error: function () { if (ft.DEBUG && !At.isUndefined(wt) && wt) { var e = ["Mixpanel error:"].concat(At.toArray(arguments)); try { wt.error.apply(wt, e); } catch (t) { At.each(e, (function (e) { wt.error(e); })); } } }, critical: function () { if (!At.isUndefined(wt) && wt) { var e = ["Mixpanel error:"].concat(At.toArray(arguments)); try { wt.error.apply(wt, e); } catch (t) { At.each(e, (function (e) { wt.error(e); })); } } } }, qt = function (e, t) { return function () { return arguments[0] = "[" + t + "] " + arguments[0], e.apply(Pt, arguments); }; }, Ft = function (e) { return { log: qt(Pt.log, e), error: qt(Pt.error, e), critical: qt(Pt.critical, e) }; }; At.bind = function (e, t) { var r, n; if (xt && e.bind === xt) return xt.apply(e, bt.call(arguments, 1)); if (!At.isFunction(e)) throw new TypeError; return r = bt.call(arguments, 2), n = function () { if (!(this instanceof n)) return e.apply(t, r.concat(bt.call(arguments))); var i = {}; i.prototype = e.prototype; var o = new i; i.prototype = null; var s = e.apply(o, r.concat(bt.call(arguments))); return Object(s) === s ? s : o; }, n; }, At.each = function (e, t, r) { if (null != e) if (Tt && e.forEach === Tt) e.forEach(t, r); else if (e.length === +e.length) { for (var n = 0, i = e.length; n < i; n++)if (n in e && t.call(r, e[n], n, e) === Lt) return; } else for (var o in e) if (St.call(e, o) && t.call(r, e[o], o, e) === Lt) return; }, At.extend = function (e) { return At.each(bt.call(arguments, 1), (function (t) { for (var r in t) void 0 !== t[r] && (e[r] = t[r]); })), e; }, At.isArray = Rt || function (e) { return "[object Array]" === kt.call(e); }, At.isFunction = function (e) { try { return /^\s*\bfunction\b/.test(e); } catch (e) { return !1; } }, At.isArguments = function (e) { return !(!e || !St.call(e, "callee")); }, At.toArray = function (e) { return e ? e.toArray ? e.toArray() : At.isArray(e) || At.isArguments(e) ? bt.call(e) : At.values(e) : []; }, At.map = function (e, t, r) { if (Dt && e.map === Dt) return e.map(t, r); var n = []; return At.each(e, (function (e) { n.push(t.call(r, e)); })), n; }, At.keys = function (e) { var t = []; return null === e || At.each(e, (function (e, r) { t[t.length] = r; })), t; }, At.values = function (e) { var t = []; return null === e || At.each(e, (function (e) { t[t.length] = e; })), t; }, At.include = function (e, t) { var r = !1; return null === e ? r : Nt && e.indexOf === Nt ? -1 != e.indexOf(t) : (At.each(e, (function (e) { if (r || (r = e === t)) return Lt; })), r); }, At.includes = function (e, t) { return -1 !== e.indexOf(t); }, At.inherit = function (e, t) { return e.prototype = new t, e.prototype.constructor = e, e.superclass = t.prototype, e; }, At.isObject = function (e) { return e === Object(e) && !At.isArray(e); }, At.isEmptyObject = function (e) { if (At.isObject(e)) { for (var t in e) if (St.call(e, t)) return !1; return !0; } return !1; }, At.isUndefined = function (e) { return void 0 === e; }, At.isString = function (e) { return "[object String]" == kt.call(e); }, At.isDate = function (e) { return "[object Date]" == kt.call(e); }, At.isNumber = function (e) { return "[object Number]" == kt.call(e); }, At.isElement = function (e) { return !(!e || 1 !== e.nodeType); }, At.encodeDates = function (e) { return At.each(e, (function (t, r) { At.isDate(t) ? e[r] = At.formatDate(t) : At.isObject(t) && (e[r] = At.encodeDates(t)); })), e; }, At.timestamp = function () { return Date.now = Date.now || function () { return +new Date; }, Date.now(); }, At.formatDate = function (e) { function t(e) { return e < 10 ? "0" + e : e; } return e.getUTCFullYear() + "-" + t(e.getUTCMonth() + 1) + "-" + t(e.getUTCDate()) + "T" + t(e.getUTCHours()) + ":" + t(e.getUTCMinutes()) + ":" + t(e.getUTCSeconds()); }, At.strip_empty_properties = function (e) { var t = {}; return At.each(e, (function (e, r) { At.isString(e) && e.length > 0 && (t[r] = e); })), t; }, At.truncate = function (e, t) { var r; return "string" == typeof e ? r = e.slice(0, t) : At.isArray(e) ? (r = [], At.each(e, (function (e) { r.push(At.truncate(e, t)); }))) : At.isObject(e) ? (r = {}, At.each(e, (function (e, n) { r[n] = At.truncate(e, t); }))) : r = e, r; }, At.JSONEncode = function (e) { var t = function (e) { var t = /[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, r = { "\b": "\\b", "\t": "\\t", "\n": "\\n", "\f": "\\f", "\r": "\\r", '"': '\\"', "\\": "\\\\" }; return t.lastIndex = 0, t.test(e) ? '"' + e.replace(t, (function (e) { var t = r[e]; return "string" == typeof t ? t : "\\u" + ("0000" + e.charCodeAt(0).toString(16)).slice(-4); })) + '"' : '"' + e + '"'; }, r = function (e, n) { var i = "", o = 0, s = "", a = "", c = 0, l = i, u = [], p = n[e]; switch (p && "object" == typeof p && "function" == typeof p.toJSON && (p = p.toJSON(e)), typeof p) { case "string": return t(p); case "number": return isFinite(p) ? String(p) : "null"; case "boolean": case "null": return String(p); case "object": if (!p) return "null"; if (i += "    ", u = [], "[object Array]" === kt.apply(p)) { for (c = p.length, o = 0; o < c; o += 1)u[o] = r(o, p) || "null"; return a = 0 === u.length ? "[]" : i ? "[\n" + i + u.join(",\n" + i) + "\n" + l + "]" : "[" + u.join(",") + "]", i = l, a; } for (s in p) St.call(p, s) && (a = r(s, p)) && u.push(t(s) + (i ? ": " : ":") + a); return a = 0 === u.length ? "{}" : i ? "{" + u.join(",") + l + "}" : "{" + u.join(",") + "}", i = l, a; } }; return r("", { "": e }); }, At.JSONDecode = function () { var e, t, r, n, i = { '"': '"', "\\": "\\", "/": "/", b: "\b", f: "\f", n: "\n", r: "\r", t: "\t" }, o = function (t) { var n = new SyntaxError(t); throw n.at = e, n.text = r, n; }, s = function (n) { return n && n !== t && o("Expected '" + n + "' instead of '" + t + "'"), t = r.charAt(e), e += 1, t; }, a = function () { var e, r = ""; for ("-" === t && (r = "-", s("-")); t >= "0" && t <= "9";)r += t, s(); if ("." === t) for (r += "."; s() && t >= "0" && t <= "9";)r += t; if ("e" === t || "E" === t) for (r += t, s(), ("-" === t || "+" === t) && (r += t, s()); t >= "0" && t <= "9";)r += t, s(); if (e = +r, isFinite(e)) return e; o("Bad number"); }, c = function () { var e, r, n, a = ""; if ('"' === t) for (; s();) { if ('"' === t) return s(), a; if ("\\" === t) if (s(), "u" === t) { for (n = 0, r = 0; r < 4 && (e = parseInt(s(), 16), isFinite(e)); r += 1)n = 16 * n + e; a += String.fromCharCode(n); } else { if ("string" != typeof i[t]) break; a += i[t]; } else a += t; } o("Bad string"); }, l = function () { for (; t && t <= " ";)s(); }; return n = function () { switch (l(), t) { case "{": return function () { var e, r = {}; if ("{" === t) { if (s("{"), l(), "}" === t) return s("}"), r; for (; t;) { if (e = c(), l(), s(":"), Object.hasOwnProperty.call(r, e) && o('Duplicate key "' + e + '"'), r[e] = n(), l(), "}" === t) return s("}"), r; s(","), l(); } } o("Bad object"); }(); case "[": return function () { var e = []; if ("[" === t) { if (s("["), l(), "]" === t) return s("]"), e; for (; t;) { if (e.push(n()), l(), "]" === t) return s("]"), e; s(","), l(); } } o("Bad array"); }(); case '"': return c(); case "-": return a(); default: return t >= "0" && t <= "9" ? a() : function () { switch (t) { case "t": return s("t"), s("r"), s("u"), s("e"), !0; case "f": return s("f"), s("a"), s("l"), s("s"), s("e"), !1; case "n": return s("n"), s("u"), s("l"), s("l"), null; }o('Unexpected "' + t + '"'); }(); } }, function (i) { var s; return r = i, e = 0, t = " ", s = n(), l(), t && o("Syntax error"), s; }; }(), At.base64Encode = function (e) { var t, r, n, i, o, s = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", a = 0, c = 0, l = "", u = []; if (!e) return e; e = At.utf8Encode(e); do { t = (o = e.charCodeAt(a++) << 16 | e.charCodeAt(a++) << 8 | e.charCodeAt(a++)) >> 18 & 63, r = o >> 12 & 63, n = o >> 6 & 63, i = 63 & o, u[c++] = s.charAt(t) + s.charAt(r) + s.charAt(n) + s.charAt(i); } while (a < e.length); switch (l = u.join(""), e.length % 3) { case 1: l = l.slice(0, -2) + "=="; break; case 2: l = l.slice(0, -1) + "="; }return l; }, At.utf8Encode = function (e) { var t, r, n, i, o = ""; for (t = r = 0, n = (e = (e + "").replace(/\r\n/g, "\n").replace(/\r/g, "\n")).length, i = 0; i < n; i++) { var s = e.charCodeAt(i), a = null; s < 128 ? r++ : a = s > 127 && s < 2048 ? String.fromCharCode(s >> 6 | 192, 63 & s | 128) : String.fromCharCode(s >> 12 | 224, s >> 6 & 63 | 128, 63 & s | 128), null !== a && (r > t && (o += e.substring(t, r)), o += a, t = r = i + 1); } return r > t && (o += e.substring(t, e.length)), o; }, At.UUID = function () { var e = function () { var e, t = 1 * new Date; if (pt.performance && pt.performance.now) e = pt.performance.now(); else for (e = 0; t == 1 * new Date;)e++; return t.toString(16) + Math.floor(e).toString(16); }; return function () { var t = (Mt.height * Mt.width).toString(16); return e() + "-" + Math.random().toString(16).replace(".", "") + "-" + function () { var e, t, r = Ot, n = [], i = 0; function o(e, t) { var r, i = 0; for (r = 0; r < t.length; r++)i |= n[r] << 8 * r; return e ^ i; } for (e = 0; e < r.length; e++)t = r.charCodeAt(e), n.unshift(255 & t), n.length >= 4 && (i = o(i, n), n = []); return n.length > 0 && (i = o(i, n)), i.toString(16); }() + "-" + t + "-" + e(); }; }(); var $t = ["ahrefsbot", "ahrefssiteaudit", "baiduspider", "bingbot", "bingpreview", "chrome-lighthouse", "facebookexternal", "petalbot", "pinterest", "screaming frog", "yahoo! slurp", "yandexbot", "adsbot-google", "apis-google", "duplexweb-google", "feedfetcher-google", "google favicon", "google web preview", "google-read-aloud", "googlebot", "googleweblight", "mediapartners-google", "storebot-google"]; At.isBlockedUA = function (e) { var t; for (e = e.toLowerCase(), t = 0; t < $t.length; t++)if (-1 !== e.indexOf($t[t])) return !0; return !1; }, At.HTTPBuildQuery = function (e, t) { var r, n, i = []; return At.isUndefined(t) && (t = "&"), At.each(e, (function (e, t) { r = encodeURIComponent(e.toString()), n = encodeURIComponent(t), i[i.length] = n + "=" + r; })), i.join(t); }, At.getQueryParam = function (e, t) { t = t.replace(/[[]/, "\\[").replace(/[\]]/, "\\]"); var r = new RegExp("[\\?&]" + t + "=([^&#]*)").exec(e); if (null === r || r && "string" != typeof r[1] && r[1].length) return ""; var n = r[1]; try { n = decodeURIComponent(n); } catch (e) { Pt.error("Skipping decoding for malformed query param: " + n); } return n.replace(/\+/g, " "); }, At.cookie = { get: function (e) { for (var t = e + "=", r = It.cookie.split(";"), n = 0; n < r.length; n++) { for (var i = r[n]; " " == i.charAt(0);)i = i.substring(1, i.length); if (0 === i.indexOf(t)) return decodeURIComponent(i.substring(t.length, i.length)); } return null; }, parse: function (e) { var t; try { t = At.JSONDecode(At.cookie.get(e)) || {}; } catch (e) { } return t; }, set_seconds: function (e, t, r, n, i, o, s) { var a = "", c = "", l = ""; if (s) a = "; domain=" + s; else if (n) { var u = Jt(It.location.hostname); a = u ? "; domain=." + u : ""; } if (r) { var p = new Date; p.setTime(p.getTime() + 1e3 * r), c = "; expires=" + p.toGMTString(); } o && (i = !0, l = "; SameSite=None"), i && (l += "; secure"), It.cookie = e + "=" + encodeURIComponent(t) + c + "; path=/" + a + l; }, set: function (e, t, r, n, i, o, s) { var a = "", c = "", l = ""; if (s) a = "; domain=" + s; else if (n) { var u = Jt(It.location.hostname); a = u ? "; domain=." + u : ""; } if (r) { var p = new Date; p.setTime(p.getTime() + 24 * r * 60 * 60 * 1e3), c = "; expires=" + p.toGMTString(); } o && (i = !0, l = "; SameSite=None"), i && (l += "; secure"); var d = e + "=" + encodeURIComponent(t) + c + "; path=/" + a + l; return It.cookie = d, d; }, remove: function (e, t, r) { At.cookie.set(e, "", -1, t, !1, !1, r); } }; var Ut = null, jt = function (e, t) { if (null !== Ut && !t) return Ut; var r = !0; try { e = e || window.localStorage; var n = "__mplss_" + Wt(8); e.setItem(n, "xyz"), "xyz" !== e.getItem(n) && (r = !1), e.removeItem(n); } catch (e) { r = !1; } return Ut = r, r; }; At.localStorage = { is_supported: function (e) { var t = jt(null, e); return t || Pt.error("localStorage unsupported; falling back to cookie store"), t; }, error: function (e) { Pt.error("localStorage error: " + e); }, get: function (e) { try { return window.localStorage.getItem(e); } catch (e) { At.localStorage.error(e); } return null; }, parse: function (e) { try { return At.JSONDecode(At.localStorage.get(e)) || {}; } catch (e) { } return null; }, set: function (e, t) { try { window.localStorage.setItem(e, t); } catch (e) { At.localStorage.error(e); } }, remove: function (e) { try { window.localStorage.removeItem(e); } catch (e) { At.localStorage.error(e); } } }, At.register_event = function () { function e(t) { return t && (t.preventDefault = e.preventDefault, t.stopPropagation = e.stopPropagation), t; } return e.preventDefault = function () { this.returnValue = !1; }, e.stopPropagation = function () { this.cancelBubble = !0; }, function (t, r, n, i, o) { if (t) if (t.addEventListener && !i) t.addEventListener(r, n, !!o); else { var s = "on" + r, a = t[s]; t[s] = function (t, r, n) { var i = function (i) { if (i = i || e(window.event)) { var o, s, a = !0; return At.isFunction(n) && (o = n(i)), s = r.call(t, i), (!1 === o || !1 === s) && (a = !1), a; } }; return i; }(t, n, a); } else Pt.error("No valid element provided to register_event"); }; }(); var Bt = new RegExp('^(\\w*)\\[(\\w+)([=~\\|\\^\\$\\*]?)=?"?([^\\]"]*)"?\\]$'); At.dom_query = function () { function e(e) { return e.all ? e.all : e.getElementsByTagName("*"); } var t = /[\t\r\n]/g; function r(e, r) { var n = " " + r + " "; return (" " + e.className + " ").replace(t, " ").indexOf(n) >= 0; } function n(t) { if (!It.getElementsByTagName) return []; var n, i, o, s, a, c, l, u, p, d, h = t.split(" "), f = [It]; for (c = 0; c < h.length; c++)if ((n = h[c].replace(/^\s+/, "").replace(/\s+$/, "")).indexOf("#") > -1) { o = (i = n.split("#"))[0]; var m = i[1], g = It.getElementById(m); if (!g || o && g.nodeName.toLowerCase() != o) return []; f = [g]; } else if (n.indexOf(".") > -1) { o = (i = n.split("."))[0]; var _ = i[1]; for (o || (o = "*"), s = [], a = 0, l = 0; l < f.length; l++)for (p = "*" == o ? e(f[l]) : f[l].getElementsByTagName(o), u = 0; u < p.length; u++)s[a++] = p[u]; for (f = [], d = 0, l = 0; l < s.length; l++)s[l].className && At.isString(s[l].className) && r(s[l], _) && (f[d++] = s[l]); } else { var y = n.match(Bt); if (y) { o = y[1]; var v, b = y[2], k = y[3], S = y[4]; for (o || (o = "*"), s = [], a = 0, l = 0; l < f.length; l++)for (p = "*" == o ? e(f[l]) : f[l].getElementsByTagName(o), u = 0; u < p.length; u++)s[a++] = p[u]; switch (f = [], d = 0, k) { case "=": v = function (e) { return e.getAttribute(b) == S; }; break; case "~": v = function (e) { return e.getAttribute(b).match(new RegExp("\\b" + S + "\\b")); }; break; case "|": v = function (e) { return e.getAttribute(b).match(new RegExp("^" + S + "-?")); }; break; case "^": v = function (e) { return 0 === e.getAttribute(b).indexOf(S); }; break; case "$": v = function (e) { return e.getAttribute(b).lastIndexOf(S) == e.getAttribute(b).length - S.length; }; break; case "*": v = function (e) { return e.getAttribute(b).indexOf(S) > -1; }; break; default: v = function (e) { return e.getAttribute(b); }; }for (f = [], d = 0, l = 0; l < s.length; l++)v(s[l]) && (f[d++] = s[l]); } else { for (o = n, s = [], a = 0, l = 0; l < f.length; l++)for (p = f[l].getElementsByTagName(o), u = 0; u < p.length; u++)s[a++] = p[u]; f = s; } } return f; } return function (e) { return At.isElement(e) ? [e] : At.isObject(e) && !At.isUndefined(e.length) ? e : n.call(this, e); }; }(); var Vt = ["utm_source", "utm_medium", "utm_campaign", "utm_content", "utm_term"], zt = ["dclid", "fbclid", "gclid", "ko_click_id", "li_fat_id", "msclkid", "ttclid", "twclid", "wbraid"]; At.info = { campaignParams: function (e) { var t = "", r = {}; return At.each(Vt, (function (n) { (t = At.getQueryParam(It.URL, n)).length ? r[n] = t : void 0 !== e && (r[n] = e); })), r; }, clickParams: function () { var e = "", t = {}; return At.each(zt, (function (r) { (e = At.getQueryParam(It.URL, r)).length && (t[r] = e); })), t; }, marketingParams: function () { return At.extend(At.info.campaignParams(), At.info.clickParams()); }, searchEngine: function (e) { return 0 === e.search("https?://(.*)google.([^/?]*)") ? "google" : 0 === e.search("https?://(.*)bing.com") ? "bing" : 0 === e.search("https?://(.*)yahoo.com") ? "yahoo" : 0 === e.search("https?://(.*)duckduckgo.com") ? "duckduckgo" : null; }, searchInfo: function (e) { var t = At.info.searchEngine(e), r = "yahoo" != t ? "q" : "p", n = {}; if (null !== t) { n.$search_engine = t; var i = At.getQueryParam(e, r); i.length && (n.mp_keyword = i); } return n; }, browser: function (e, t, r) { return t = t || "", r || At.includes(e, " OPR/") ? At.includes(e, "Mini") ? "Opera Mini" : "Opera" : /(BlackBerry|PlayBook|BB10)/i.test(e) ? "BlackBerry" : At.includes(e, "IEMobile") || At.includes(e, "WPDesktop") ? "Internet Explorer Mobile" : At.includes(e, "SamsungBrowser/") ? "Samsung Internet" : At.includes(e, "Edge") || At.includes(e, "Edg/") ? "Microsoft Edge" : At.includes(e, "FBIOS") ? "Facebook Mobile" : At.includes(e, "Chrome") ? "Chrome" : At.includes(e, "CriOS") ? "Chrome iOS" : At.includes(e, "UCWEB") || At.includes(e, "UCBrowser") ? "UC Browser" : At.includes(e, "FxiOS") ? "Firefox iOS" : At.includes(t, "Apple") ? At.includes(e, "Mobile") ? "Mobile Safari" : "Safari" : At.includes(e, "Android") ? "Android Mobile" : At.includes(e, "Konqueror") ? "Konqueror" : At.includes(e, "Firefox") ? "Firefox" : At.includes(e, "MSIE") || At.includes(e, "Trident/") ? "Internet Explorer" : At.includes(e, "Gecko") ? "Mozilla" : ""; }, browserVersion: function (e, t, r) { var n = { "Internet Explorer Mobile": /rv:(\d+(\.\d+)?)/, "Microsoft Edge": /Edge?\/(\d+(\.\d+)?)/, Chrome: /Chrome\/(\d+(\.\d+)?)/, "Chrome iOS": /CriOS\/(\d+(\.\d+)?)/, "UC Browser": /(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/, Safari: /Version\/(\d+(\.\d+)?)/, "Mobile Safari": /Version\/(\d+(\.\d+)?)/, Opera: /(Opera|OPR)\/(\d+(\.\d+)?)/, Firefox: /Firefox\/(\d+(\.\d+)?)/, "Firefox iOS": /FxiOS\/(\d+(\.\d+)?)/, Konqueror: /Konqueror:(\d+(\.\d+)?)/, BlackBerry: /BlackBerry (\d+(\.\d+)?)/, "Android Mobile": /android\s(\d+(\.\d+)?)/, "Samsung Internet": /SamsungBrowser\/(\d+(\.\d+)?)/, "Internet Explorer": /(rv:|MSIE )(\d+(\.\d+)?)/, Mozilla: /rv:(\d+(\.\d+)?)/ }[At.info.browser(e, t, r)]; if (void 0 === n) return null; var i = e.match(n); return i ? parseFloat(i[i.length - 2]) : null; }, os: function () { var e = Ot; return /Windows/i.test(e) ? /Phone/.test(e) || /WPDesktop/.test(e) ? "Windows Phone" : "Windows" : /(iPhone|iPad|iPod)/.test(e) ? "iOS" : /Android/.test(e) ? "Android" : /(BlackBerry|PlayBook|BB10)/i.test(e) ? "BlackBerry" : /Mac/i.test(e) ? "Mac OS X" : /Linux/.test(e) ? "Linux" : /CrOS/.test(e) ? "Chrome OS" : ""; }, device: function (e) { return /Windows Phone/i.test(e) || /WPDesktop/.test(e) ? "Windows Phone" : /iPad/.test(e) ? "iPad" : /iPod/.test(e) ? "iPod Touch" : /iPhone/.test(e) ? "iPhone" : /(BlackBerry|PlayBook|BB10)/i.test(e) ? "BlackBerry" : /Android/.test(e) ? "Android" : ""; }, referringDomain: function (e) { var t = e.split("/"); return t.length >= 3 ? t[2] : ""; }, currentUrl: function () { return pt.location.href; }, properties: function (e) { return "object" != typeof e && (e = {}), At.extend(At.strip_empty_properties({ $os: At.info.os(), $browser: At.info.browser(Ot, Et.vendor, Ct), $referrer: It.referrer, $referring_domain: At.info.referringDomain(It.referrer), $device: At.info.device(Ot) }), { $current_url: At.info.currentUrl(), $browser_version: At.info.browserVersion(Ot, Et.vendor, Ct), $screen_height: Mt.height, $screen_width: Mt.width, mp_lib: "web", $lib_version: ft.LIB_VERSION, $insert_id: Wt(), time: At.timestamp() / 1e3 }, At.strip_empty_properties(e)); }, people_properties: function () { return At.extend(At.strip_empty_properties({ $os: At.info.os(), $browser: At.info.browser(Ot, Et.vendor, Ct) }), { $browser_version: At.info.browserVersion(Ot, Et.vendor, Ct) }); }, mpPageViewProperties: function () { return At.strip_empty_properties({ current_page_title: It.title, current_domain: pt.location.hostname, current_url_path: pt.location.pathname, current_url_protocol: pt.location.protocol, current_url_search: pt.location.search }); } }; var Wt = function (e) { var t = Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 10); return e ? t.substring(0, e) : t; }, Gt = /[a-z0-9][a-z0-9-]*\.[a-z]+$/i, Ht = /[a-z0-9][a-z0-9-]+\.[a-z.]{2,6}$/i, Jt = function (e) { var t = Ht, r = e.split("."), n = r[r.length - 1]; (n.length > 4 || "com" === n || "org" === n) && (t = Gt); var i = e.match(t); return i ? i[0] : ""; }, Kt = null, Qt = null; "undefined" != typeof JSON && (Kt = JSON.stringify, Qt = JSON.parse), Kt = Kt || At.JSONEncode, Qt = Qt || At.JSONDecode, At.toArray = At.toArray, At.isObject = At.isObject, At.JSONEncode = At.JSONEncode, At.JSONDecode = At.JSONDecode, At.isBlockedUA = At.isBlockedUA, At.isEmptyObject = At.isEmptyObject, At.info = At.info, At.info.device = At.info.device, At.info.browser = At.info.browser, At.info.browserVersion = At.info.browserVersion, At.info.properties = At.info.properties; var Xt = "__mp_opt_in_out_"; function Yt(e, t) { lr(!0, e, t); } function Zt(e, t) { lr(!1, e, t); } function er(e, t) { return "1" === cr(e, t); } function tr(e, t) { if (function (e) { if (e && e.ignoreDnt) return !1; var t = e && e.window || pt, r = t.navigator || {}, n = !1; return At.each([r.doNotTrack, r.msDoNotTrack, t.doNotTrack], (function (e) { At.includes([!0, 1, "1", "yes"], e) && (n = !0); })), n; }(t)) return Pt.warn('This browser has "Do Not Track" enabled. This will prevent the Mixpanel SDK from sending any data. To ignore the "Do Not Track" browser setting, initialize the Mixpanel instance with the config "ignore_dnt: true"'), !0; var r = "0" === cr(e, t); return r && Pt.warn("You are opted out of Mixpanel tracking. This will prevent the Mixpanel SDK from sending any data."), r; } function rr(e) { return ur(e, (function (e) { return this.get_config(e); })); } function nr(e) { return ur(e, (function (e) { return this._get_config(e); })); } function ir(e) { return ur(e, (function (e) { return this._get_config(e); })); } function or(e, t) { sr(t = t || {}).remove(ar(e, t), !!t.crossSubdomainCookie, t.cookieDomain); } function sr(e) { return "localStorage" === (e = e || {}).persistenceType ? At.localStorage : At.cookie; } function ar(e, t) { return ((t = t || {}).persistencePrefix || Xt) + e; } function cr(e, t) { return sr(t).get(ar(e, t)); } function lr(e, t, r) { At.isString(t) && t.length ? (sr(r = r || {}).set(ar(t, r), e ? 1 : 0, At.isNumber(r.cookieExpiration) ? r.cookieExpiration : null, !!r.crossSubdomainCookie, !!r.secureCookie, !!r.crossSiteCookie, r.cookieDomain), r.track && e && r.track(r.trackEventName || "$opt_in", r.trackProperties, { send_immediately: !0 })) : Pt.error("gdpr." + (e ? "optIn" : "optOut") + " called with an invalid token"); } function ur(e, t) { return function () { var r = !1; try { var n = t.call(this, "token"), i = t.call(this, "ignore_dnt"), o = t.call(this, "opt_out_tracking_persistence_type"), s = t.call(this, "opt_out_tracking_cookie_prefix"), a = t.call(this, "window"); n && (r = tr(n, { ignoreDnt: i, persistenceType: o, persistencePrefix: s, window: a })); } catch (e) { Pt.error("Unexpected error when checking tracking opt-out status: " + e); } if (!r) return e.apply(this, arguments); var c = arguments[arguments.length - 1]; "function" == typeof c && c(0); }; } var pr = Ft("lock"), dr = function (e, t) { t = t || {}, this.storageKey = e, this.storage = t.storage || window.localStorage, this.pollIntervalMS = t.pollIntervalMS || 100, this.timeoutMS = t.timeoutMS || 2e3; }; dr.prototype.withLock = function (e, t, r) { !r && "function" != typeof t && (r = t, t = null); var n = r || (new Date).getTime() + "|" + Math.random(), i = (new Date).getTime(), o = this.storageKey, s = this.pollIntervalMS, a = this.timeoutMS, c = this.storage, l = o + ":X", u = o + ":Y", p = o + ":Z", d = function (e) { t && t(e); }, h = function (e) { if ((new Date).getTime() - i > a) return pr.error("Timeout waiting for mutex on " + o + "; clearing lock. [" + n + "]"), c.removeItem(p), c.removeItem(u), void g(); setTimeout((function () { try { e(); } catch (e) { d(e); } }), s * (Math.random() + .1)); }, f = function (e, t) { e() ? t() : h((function () { f(e, t); })); }, m = function () { var e = c.getItem(u); if (e && e !== n) return !1; if (c.setItem(u, n), c.getItem(u) === n) return !0; if (!jt(c, !0)) throw new Error("localStorage support dropped while acquiring lock"); return !1; }, g = function () { c.setItem(l, n), f(m, (function () { c.getItem(l) !== n ? h((function () { c.getItem(u) === n ? f((function () { return !c.getItem(p); }), _) : g(); })) : _(); })); }, _ = function () { c.setItem(p, "1"); try { e(); } finally { c.removeItem(p), c.getItem(u) === n && c.removeItem(u), c.getItem(l) === n && c.removeItem(l); } }; try { if (!jt(c, !0)) throw new Error("localStorage support check failed"); g(); } catch (e) { d(e); } }; var hr = Ft("batch"), fr = function (e, t) { t = t || {}, this.storageKey = e, this.storage = t.storage || window.localStorage, this.reportError = t.errorReporter || At.bind(hr.error, hr), this.lock = new dr(e, { storage: this.storage }), this.usePersistence = t.usePersistence, this.pid = t.pid || null, this.memQueue = []; }; fr.prototype.enqueue = function (e, t, r) { var n = { id: Wt(), flushAfter: (new Date).getTime() + 2 * t, payload: e }; this.usePersistence ? this.lock.withLock(At.bind((function () { var t; try { var i = this.readFromStorage(); i.push(n), (t = this.saveToStorage(i)) && this.memQueue.push(n); } catch (r) { this.reportError("Error enqueueing item", e), t = !1; } r && r(t); }), this), At.bind((function (e) { this.reportError("Error acquiring storage lock", e), r && r(!1); }), this), this.pid) : (this.memQueue.push(n), r && r(!0)); }, fr.prototype.fillBatch = function (e) { var t = this.memQueue.slice(0, e); if (this.usePersistence && t.length < e) { var r = this.readFromStorage(); if (r.length) { var n = {}; At.each(t, (function (e) { n[e.id] = !0; })); for (var i = 0; i < r.length; i++) { var o = r[i]; if ((new Date).getTime() > o.flushAfter && !n[o.id] && (o.orphaned = !0, t.push(o), t.length >= e)) break; } } } return t; }; var mr = function (e, t) { var r = []; return At.each(e, (function (e) { e.id && !t[e.id] && r.push(e); })), r; }; fr.prototype.removeItemsByID = function (e, t) { var r = {}; if (At.each(e, (function (e) { r[e] = !0; })), this.memQueue = mr(this.memQueue, r), this.usePersistence) { var n = At.bind((function () { var t; try { var n = this.readFromStorage(); if (n = mr(n, r), t = this.saveToStorage(n)) { n = this.readFromStorage(); for (var i = 0; i < n.length; i++) { var o = n[i]; if (o.id && r[o.id]) return this.reportError("Item not removed from storage"), !1; } } } catch (r) { this.reportError("Error removing items", e), t = !1; } return t; }), this); this.lock.withLock((function () { var e = n(); t && t(e); }), At.bind((function (e) { var r = !1; if (this.reportError("Error acquiring storage lock", e), !jt(this.storage, !0) && !(r = n())) try { this.storage.removeItem(this.storageKey); } catch (e) { this.reportError("Error clearing queue", e); } t && t(r); }), this), this.pid); } else t && t(!0); }; var gr = function (e, t) { var r = []; return At.each(e, (function (e) { var n = e.id; if (n in t) { var i = t[n]; null !== i && (e.payload = i, r.push(e)); } else r.push(e); })), r; }; fr.prototype.updatePayloads = function (e, t) { this.memQueue = gr(this.memQueue, e), this.usePersistence ? this.lock.withLock(At.bind((function () { var r; try { var n = this.readFromStorage(); n = gr(n, e), r = this.saveToStorage(n); } catch (t) { this.reportError("Error updating items", e), r = !1; } t && t(r); }), this), At.bind((function (e) { this.reportError("Error acquiring storage lock", e), t && t(!1); }), this), this.pid) : t && t(!0); }, fr.prototype.readFromStorage = function () { var e; try { (e = this.storage.getItem(this.storageKey)) && (e = Qt(e), At.isArray(e) || (this.reportError("Invalid storage entry:", e), e = null)); } catch (t) { this.reportError("Error retrieving queue", t), e = null; } return e || []; }, fr.prototype.saveToStorage = function (e) { try { return this.storage.setItem(this.storageKey, Kt(e)), !0; } catch (e) { return this.reportError("Error saving queue", e), !1; } }, fr.prototype.clear = function () { this.memQueue = [], this.usePersistence && this.storage.removeItem(this.storageKey); }; var _r = Ft("batch"), yr = function (e, t) { this.errorReporter = t.errorReporter, this.queue = new fr(e, { errorReporter: At.bind(this.reportError, this), storage: t.storage, usePersistence: t.usePersistence }), this.libConfig = t.libConfig, this.sendRequest = t.sendRequestFunc, this.beforeSendHook = t.beforeSendHook, this.stopAllBatching = t.stopAllBatchingFunc, this.batchSize = this.libConfig.batch_size, this.flushInterval = this.libConfig.batch_flush_interval_ms, this.stopped = !this.libConfig.batch_autostart, this.consecutiveRemovalFailures = 0, this.itemIdsSentSuccessfully = {}, this.flushOnlyOnInterval = t.flushOnlyOnInterval || !1; }; yr.prototype.enqueue = function (e, t) { this.queue.enqueue(e, this.flushInterval, t); }, yr.prototype.start = function () { this.stopped = !1, this.consecutiveRemovalFailures = 0, this.flush(); }, yr.prototype.stop = function () { this.stopped = !0, this.timeoutID && (clearTimeout(this.timeoutID), this.timeoutID = null); }, yr.prototype.clear = function () { this.queue.clear(); }, yr.prototype.resetBatchSize = function () { this.batchSize = this.libConfig.batch_size; }, yr.prototype.resetFlush = function () { this.scheduleFlush(this.libConfig.batch_flush_interval_ms); }, yr.prototype.scheduleFlush = function (e) { this.flushInterval = e, this.stopped || (this.timeoutID = setTimeout(At.bind((function () { this.stopped || this.flush(); }), this), this.flushInterval)); }, yr.prototype.flush = function (e) { try { if (this.requestInProgress) return void _r.log("Flush: Request already in progress"); e = e || {}; var t = this.libConfig.batch_request_timeout_ms, r = (new Date).getTime(), n = this.batchSize, i = this.queue.fillBatch(n), o = i.length === n, s = [], a = {}; if (At.each(i, (function (e) { var t = e.payload; if (this.beforeSendHook && !e.orphaned && (t = this.beforeSendHook(t)), t) { t.event && t.properties && (t.properties = At.extend({}, t.properties, { mp_sent_by_lib_version: ft.LIB_VERSION })); var r = !0, n = e.id; n ? (this.itemIdsSentSuccessfully[n] || 0) > 5 && (this.reportError("[dupe] item ID sent too many times, not sending", { item: e, batchSize: i.length, timesSent: this.itemIdsSentSuccessfully[n] }), r = !1) : this.reportError("[dupe] found item with no ID", { item: e }), r && s.push(t); } a[e.id] = t; }), this), s.length < 1) return void this.resetFlush(); this.requestInProgress = !0; var c = At.bind((function (s) { this.requestInProgress = !1; try { var c = !1; if (e.unloading) this.queue.updatePayloads(a); else if (At.isObject(s) && "timeout" === s.error && (new Date).getTime() - r >= t) this.reportError("Network timeout; retrying"), this.flush(); else if (At.isObject(s) && (s.httpStatusCode >= 500 || 429 === s.httpStatusCode || "timeout" === s.error)) { var l = 2 * this.flushInterval; s.retryAfter && (l = 1e3 * parseInt(s.retryAfter, 10) || l), l = Math.min(6e5, l), this.reportError("Error; retry in " + l + " ms"), this.scheduleFlush(l); } else if (At.isObject(s) && 413 === s.httpStatusCode) if (i.length > 1) { var u = Math.max(1, Math.floor(n / 2)); this.batchSize = Math.min(this.batchSize, u, i.length - 1), this.reportError("413 response; reducing batch size to " + this.batchSize), this.resetFlush(); } else this.reportError("Single-event request too large; dropping", i), this.resetBatchSize(), c = !0; else c = !0; c && (this.queue.removeItemsByID(At.map(i, (function (e) { return e.id; })), At.bind((function (e) { e ? (this.consecutiveRemovalFailures = 0, this.flushOnlyOnInterval && !o ? this.resetFlush() : this.flush()) : (this.reportError("Failed to remove items from queue"), ++this.consecutiveRemovalFailures > 5 ? (this.reportError("Too many queue failures; disabling batching system."), this.stopAllBatching()) : this.resetFlush()); }), this)), At.each(i, At.bind((function (e) { var t = e.id; t ? (this.itemIdsSentSuccessfully[t] = this.itemIdsSentSuccessfully[t] || 0, this.itemIdsSentSuccessfully[t]++, this.itemIdsSentSuccessfully[t] > 5 && this.reportError("[dupe] item ID sent too many times", { item: e, batchSize: i.length, timesSent: this.itemIdsSentSuccessfully[t] })) : this.reportError("[dupe] found item with no ID while removing", { item: e }); }), this))); } catch (e) { this.reportError("Error handling API response", e), this.resetFlush(); } }), this), l = { method: "POST", verbose: !0, ignore_json_errors: !0, timeout_ms: t }; e.unloading && (l.transport = "sendBeacon"), _r.log("MIXPANEL REQUEST:", s), this.sendRequest(s, l, c); } catch (e) { this.reportError("Error flushing request queue", e), this.resetFlush(); } }, yr.prototype.reportError = function (e, t) { if (_r.error.apply(_r.error, arguments), this.errorReporter) try { t instanceof Error || (t = new Error(e)), this.errorReporter(e, t); } catch (e) { _r.error(e); } }; var vr = Ft("recorder"), br = pt.CompressionStream, kr = { batch_size: 1e3, batch_flush_interval_ms: 1e4, batch_request_timeout_ms: 9e4, batch_autostart: !0 }, Sr = new Set([ht.MouseMove, ht.MouseInteraction, ht.Scroll, ht.ViewportResize, ht.Input, ht.TouchMove, ht.MediaInteraction, ht.Drag, ht.Selection]); var wr = function (e) { this._mixpanel = e, this._stopRecording = null, this.recEvents = [], this.seqNo = 0, this.replayId = null, this.replayStartTime = null, this.sendBatchId = null, this.idleTimeoutId = null, this.maxTimeoutId = null, this.recordMaxMs = gt, this._initBatcher(); }; wr.prototype._initBatcher = function () { this.batcher = new yr("__mprec", { libConfig: kr, sendRequestFunc: At.bind(this.flushEventsWithOptOut, this), errorReporter: At.bind(this.reportError, this), flushOnlyOnInterval: !0, usePersistence: !1 }); }, wr.prototype.get_config = function (e) { return this._mixpanel.get_config(e); }, wr.prototype.startRecording = function (e) { if (null === this._stopRecording) { this.recordMaxMs = this.get_config("record_max_ms"), this.recordMaxMs > gt && (this.recordMaxMs = gt, vr.critical("record_max_ms cannot be greater than " + gt + "ms. Capping value.")), this.recEvents = [], this.seqNo = 0, this.replayStartTime = null, this.replayId = At.UUID(), e ? this.batcher.stop() : this.batcher.start(); var t = At.bind((function () { clearTimeout(this.idleTimeoutId), this.idleTimeoutId = setTimeout(At.bind((function () { vr.log("Idle timeout reached, restarting recording."), this.resetRecording(); }), this), this.get_config("record_idle_timeout_ms")); }), this); this._stopRecording = ut({ emit: At.bind((function (e) { this.batcher.enqueue(e), function (e) { return e.type === dt.IncrementalSnapshot && Sr.has(e.data.source); }(e) && (this.batcher.stopped && this.batcher.start(), t()); }), this), blockClass: this.get_config("record_block_class"), blockSelector: this.get_config("record_block_selector"), collectFonts: this.get_config("record_collect_fonts"), inlineImages: this.get_config("record_inline_images"), maskAllInputs: !0, maskTextClass: this.get_config("record_mask_text_class"), maskTextSelector: this.get_config("record_mask_text_selector") }), t(), this.maxTimeoutId = setTimeout(At.bind(this.resetRecording, this), this.recordMaxMs); } else vr.log("Recording already in progress, skipping startRecording."); }, wr.prototype.resetRecording = function () { this.stopRecording(), this.startRecording(!0); }, wr.prototype.stopRecording = function () { null !== this._stopRecording && (this._stopRecording(), this._stopRecording = null), this.batcher.stopped ? this.batcher.clear() : (this.batcher.flush(), this.batcher.stop()), this.replayId = null, clearTimeout(this.idleTimeoutId), clearTimeout(this.maxTimeoutId); }, wr.prototype.flushEventsWithOptOut = function (e, t, r) { this._flushEvents(e, t, r, At.bind(this._onOptOut, this)); }, wr.prototype._onOptOut = function (e) { 0 === e && (this.recEvents = [], this.stopRecording()); }, wr.prototype._sendRequest = function (e, t, r) { var n = At.bind((function (e, t) { 200 === e.status && this.seqNo++, r({ status: 0, httpStatusCode: e.status, responseBody: t, retryAfter: e.headers.get("Retry-After") }); }), this); pt.fetch(this.get_config("api_host") + "/" + this.get_config("api_routes").record + "?" + new URLSearchParams(e), { method: "POST", headers: { Authorization: "Basic " + btoa(this.get_config("token") + ":"), "Content-Type": "application/octet-stream" }, body: t }).then((function (e) { e.json().then((function (t) { n(e, t); })).catch((function (e) { r({ error: e }); })); })).catch((function (e) { r({ error: e }); })); }, wr.prototype._flushEvents = rr((function (e, t, r) { let n = e.length; if (n > 0) { var i = e[0].timestamp; 0 === this.seqNo && (this.replayStartTime = i); var o = e[n - 1].timestamp - this.replayStartTime, s = { distinct_id: String(this._mixpanel.get_distinct_id()), seq: this.seqNo, batch_start_time: i / 1e3, replay_id: this.replayId, replay_length_ms: o, replay_start_time: this.replayStartTime / 1e3 }, a = At.JSONEncode(e), c = this._mixpanel.get_property("$device_id"); c && (s.$device_id = c); var l = this._mixpanel.get_property("$user_id"); if (l && (s.$user_id = l), br) { var u = new Blob([a], { type: "application/json" }).stream().pipeThrough(new br("gzip")); new Response(u).blob().then(At.bind((function (e) { s.format = "gzip", this._sendRequest(s, e, r); }), this)); } else s.format = "body", this._sendRequest(s, a, r); } })), wr.prototype.reportError = function (e, t) { vr.error.apply(vr.error, arguments); try { !t && !(e instanceof Error) && (e = new Error(e)), this.get_config("error_reporter")(e, t); } catch (e) { vr.error(e); } }, pt.__mp_recorder = wr; var Er = function () { }; Er.prototype.create_properties = function () { }, Er.prototype.event_handler = function () { }, Er.prototype.after_track_handler = function () { }, Er.prototype.init = function (e) { return this.mp = e, this; }, Er.prototype.track = function (e, t, r, n) { var i = this, o = At.dom_query(e); if (0 !== o.length) return At.each(o, (function (e) { At.register_event(e, this.override_event, (function (e) { var o = {}, s = i.create_properties(r, this), a = i.mp.get_config("track_links_timeout"); i.event_handler(e, this, o), window.setTimeout(i.track_callback(n, s, o, !0), a), i.mp.track(t, s, i.track_callback(n, s, o)); })); }), this), !0; Pt.error("The DOM query (" + e + ") returned 0 elements"); }, Er.prototype.track_callback = function (e, t, r, n) { n = n || !1; var i = this; return function () { r.callback_fired || (r.callback_fired = !0, (!e || !1 !== e(n, t)) && i.after_track_handler(t, r, n)); }; }, Er.prototype.create_properties = function (e, t) { return "function" == typeof e ? e(t) : At.extend({}, e); }; var Ir = function () { this.override_event = "click"; }; At.inherit(Ir, Er), Ir.prototype.create_properties = function (e, t) { var r = Ir.superclass.create_properties.apply(this, arguments); return t.href && (r.url = t.href), r; }, Ir.prototype.event_handler = function (e, t, r) { r.new_tab = 2 === e.which || e.metaKey || e.ctrlKey || "_blank" === t.target, r.href = t.href, r.new_tab || e.preventDefault(); }, Ir.prototype.after_track_handler = function (e, t) { t.new_tab || setTimeout((function () { window.location = t.href; }), 0); }; var Cr = function () { this.override_event = "submit"; }; At.inherit(Cr, Er), Cr.prototype.event_handler = function (e, t, r) { r.element = t, e.preventDefault(); }, Cr.prototype.after_track_handler = function (e, t) { setTimeout((function () { t.element.submit(); }), 0); }; var Mr = "$set", Or = "$set_once", xr = "$unset", Tr = "$add", Nr = "$append", Dr = "$union", Rr = "$remove", Lr = { set_action: function (e, t) { var r = {}, n = {}; return At.isObject(e) ? At.each(e, (function (e, t) { this._is_reserved_property(t) || (n[t] = e); }), this) : n[e] = t, r[Mr] = n, r; }, unset_action: function (e) { var t = {}, r = []; return At.isArray(e) || (e = [e]), At.each(e, (function (e) { this._is_reserved_property(e) || r.push(e); }), this), t[xr] = r, t; }, set_once_action: function (e, t) { var r = {}, n = {}; return At.isObject(e) ? At.each(e, (function (e, t) { this._is_reserved_property(t) || (n[t] = e); }), this) : n[e] = t, r[Or] = n, r; }, union_action: function (e, t) { var r = {}, n = {}; return At.isObject(e) ? At.each(e, (function (e, t) { this._is_reserved_property(t) || (n[t] = At.isArray(e) ? e : [e]); }), this) : n[e] = At.isArray(t) ? t : [t], r[Dr] = n, r; }, append_action: function (e, t) { var r = {}, n = {}; return At.isObject(e) ? At.each(e, (function (e, t) { this._is_reserved_property(t) || (n[t] = e); }), this) : n[e] = t, r[Nr] = n, r; }, remove_action: function (e, t) { var r = {}, n = {}; return At.isObject(e) ? At.each(e, (function (e, t) { this._is_reserved_property(t) || (n[t] = e); }), this) : n[e] = t, r[Rr] = n, r; }, delete_action: function () { var e = { $delete: "" }; return e; } }, Ar = function () { }; At.extend(Ar.prototype, Lr), Ar.prototype._init = function (e, t, r) { this._mixpanel = e, this._group_key = t, this._group_id = r; }, Ar.prototype.set = ir((function (e, t, r) { var n = this.set_action(e, t); return At.isObject(e) && (r = t), this._send_request(n, r); })), Ar.prototype.set_once = ir((function (e, t, r) { var n = this.set_once_action(e, t); return At.isObject(e) && (r = t), this._send_request(n, r); })), Ar.prototype.unset = ir((function (e, t) { var r = this.unset_action(e); return this._send_request(r, t); })), Ar.prototype.union = ir((function (e, t, r) { At.isObject(e) && (r = t); var n = this.union_action(e, t); return this._send_request(n, r); })), Ar.prototype.delete = ir((function (e) { var t = this.delete_action(); return this._send_request(t, e); })), Ar.prototype.remove = ir((function (e, t, r) { var n = this.remove_action(e, t); return this._send_request(n, r); })), Ar.prototype._send_request = function (e, t) { e.$group_key = this._group_key, e.$group_id = this._group_id, e.$token = this._get_config("token"); var r = At.encodeDates(e); return this._mixpanel._track_or_batch({ type: "groups", data: r, endpoint: this._get_config("api_host") + "/" + this._get_config("api_routes").groups, batcher: this._mixpanel.request_batchers.groups }, t); }, Ar.prototype._is_reserved_property = function (e) { return "$group_key" === e || "$group_id" === e; }, Ar.prototype._get_config = function (e) { return this._mixpanel.get_config(e); }, Ar.prototype.toString = function () { return this._mixpanel.toString() + ".group." + this._group_key + "." + this._group_id; }, Ar.prototype.remove = Ar.prototype.remove, Ar.prototype.set = Ar.prototype.set, Ar.prototype.set_once = Ar.prototype.set_once, Ar.prototype.union = Ar.prototype.union, Ar.prototype.unset = Ar.prototype.unset, Ar.prototype.toString = Ar.prototype.toString; var Pr = function () { }; At.extend(Pr.prototype, Lr), Pr.prototype._init = function (e) { this._mixpanel = e; }, Pr.prototype.set = nr((function (e, t, r) { var n = this.set_action(e, t); return At.isObject(e) && (r = t), this._get_config("save_referrer") && this._mixpanel.persistence.update_referrer_info(document.referrer), n[Mr] = At.extend({}, At.info.people_properties(), n[Mr]), this._send_request(n, r); })), Pr.prototype.set_once = nr((function (e, t, r) { var n = this.set_once_action(e, t); return At.isObject(e) && (r = t), this._send_request(n, r); })), Pr.prototype.unset = nr((function (e, t) { var r = this.unset_action(e); return this._send_request(r, t); })), Pr.prototype.increment = nr((function (e, t, r) { var n = {}, i = {}; return At.isObject(e) ? (At.each(e, (function (e, t) { if (!this._is_reserved_property(t)) { if (isNaN(parseFloat(e))) return void Pt.error("Invalid increment value passed to mixpanel.people.increment - must be a number"); i[t] = e; } }), this), r = t) : (At.isUndefined(t) && (t = 1), i[e] = t), n[Tr] = i, this._send_request(n, r); })), Pr.prototype.append = nr((function (e, t, r) { At.isObject(e) && (r = t); var n = this.append_action(e, t); return this._send_request(n, r); })), Pr.prototype.remove = nr((function (e, t, r) { At.isObject(e) && (r = t); var n = this.remove_action(e, t); return this._send_request(n, r); })), Pr.prototype.union = nr((function (e, t, r) { At.isObject(e) && (r = t); var n = this.union_action(e, t); return this._send_request(n, r); })), Pr.prototype.track_charge = nr((function (e, t, r) { if (At.isNumber(e) || (e = parseFloat(e), !isNaN(e))) return this.append("$transactions", At.extend({ $amount: e }, t), r); Pt.error("Invalid value passed to mixpanel.people.track_charge - must be a number"); })), Pr.prototype.clear_charges = function (e) { return this.set("$transactions", [], e); }, Pr.prototype.delete_user = function () { if (this._identify_called()) { var e = { $delete: this._mixpanel.get_distinct_id() }; return this._send_request(e); } Pt.error("mixpanel.people.delete_user() requires you to call identify() first"); }, Pr.prototype.toString = function () { return this._mixpanel.toString() + ".people"; }, Pr.prototype._send_request = function (e, t) { e.$token = this._get_config("token"), e.$distinct_id = this._mixpanel.get_distinct_id(); var r = this._mixpanel.get_property("$device_id"), n = this._mixpanel.get_property("$user_id"), i = this._mixpanel.get_property("$had_persisted_distinct_id"); r && (e.$device_id = r), n && (e.$user_id = n), i && (e.$had_persisted_distinct_id = i); var o = At.encodeDates(e); return this._identify_called() ? this._mixpanel._track_or_batch({ type: "people", data: o, endpoint: this._get_config("api_host") + "/" + this._get_config("api_routes").engage, batcher: this._mixpanel.request_batchers.people }, t) : (this._enqueue(e), At.isUndefined(t) || (this._get_config("verbose") ? t({ status: -1, error: null }) : t(-1)), At.truncate(o, 255)); }, Pr.prototype._get_config = function (e) { return this._mixpanel.get_config(e); }, Pr.prototype._identify_called = function () { return !0 === this._mixpanel._flags.identify_called; }, Pr.prototype._enqueue = function (e) { Mr in e ? this._mixpanel.persistence._add_to_people_queue(Mr, e) : Or in e ? this._mixpanel.persistence._add_to_people_queue(Or, e) : xr in e ? this._mixpanel.persistence._add_to_people_queue(xr, e) : Tr in e ? this._mixpanel.persistence._add_to_people_queue(Tr, e) : Nr in e ? this._mixpanel.persistence._add_to_people_queue(Nr, e) : Rr in e ? this._mixpanel.persistence._add_to_people_queue(Rr, e) : Dr in e ? this._mixpanel.persistence._add_to_people_queue(Dr, e) : Pt.error("Invalid call to _enqueue():", e); }, Pr.prototype._flush_one_queue = function (e, t, r, n) { var i = this, o = At.extend({}, this._mixpanel.persistence.load_queue(e)), s = o; !At.isUndefined(o) && At.isObject(o) && !At.isEmptyObject(o) && (i._mixpanel.persistence._pop_from_people_queue(e, o), i._mixpanel.persistence.save(), n && (s = n(o)), t.call(i, s, (function (t, n) { 0 === t && i._mixpanel.persistence._add_to_people_queue(e, o), At.isUndefined(r) || r(t, n); }))); }, Pr.prototype._flush = function (e, t, r, n, i, o, s) { var a = this; this._flush_one_queue(Mr, this.set, e), this._flush_one_queue(Or, this.set_once, n), this._flush_one_queue(xr, this.unset, o, (function (e) { return At.keys(e); })), this._flush_one_queue(Tr, this.increment, t), this._flush_one_queue(Dr, this.union, i); var c = this._mixpanel.persistence.load_queue(Nr); if (!At.isUndefined(c) && At.isArray(c) && c.length) for (var l, u = function (e, t) { 0 === e && a._mixpanel.persistence._add_to_people_queue(Nr, l), At.isUndefined(r) || r(e, t); }, p = c.length - 1; p >= 0; p--)c = this._mixpanel.persistence.load_queue(Nr), l = c.pop(), a._mixpanel.persistence.save(), At.isEmptyObject(l) || a.append(l, u); var d = this._mixpanel.persistence.load_queue(Rr); if (!At.isUndefined(d) && At.isArray(d) && d.length) for (var h, f = function (e, t) { 0 === e && a._mixpanel.persistence._add_to_people_queue(Rr, h), At.isUndefined(s) || s(e, t); }, m = d.length - 1; m >= 0; m--)d = this._mixpanel.persistence.load_queue(Rr), h = d.pop(), a._mixpanel.persistence.save(), At.isEmptyObject(h) || a.remove(h, f); }, Pr.prototype._is_reserved_property = function (e) { return "$distinct_id" === e || "$token" === e || "$device_id" === e || "$user_id" === e || "$had_persisted_distinct_id" === e; }, Pr.prototype.set = Pr.prototype.set, Pr.prototype.set_once = Pr.prototype.set_once, Pr.prototype.unset = Pr.prototype.unset, Pr.prototype.increment = Pr.prototype.increment, Pr.prototype.append = Pr.prototype.append, Pr.prototype.remove = Pr.prototype.remove, Pr.prototype.union = Pr.prototype.union, Pr.prototype.track_charge = Pr.prototype.track_charge, Pr.prototype.clear_charges = Pr.prototype.clear_charges, Pr.prototype.delete_user = Pr.prototype.delete_user, Pr.prototype.toString = Pr.prototype.toString; var qr = "__mps", Fr = "__mpso", $r = "__mpus", Ur = "__mpa", jr = "__mpap", Br = "__mpr", Vr = "__mpu", zr = "$people_distinct_id", Wr = "__alias", Gr = "__timers", Hr = [qr, Fr, $r, Ur, jr, Br, Vr, zr, Wr, Gr], Jr = function (e) { this.props = {}, this.campaign_params_saved = !1, e.persistence_name ? this.name = "mp_" + e.persistence_name : this.name = "mp_" + e.token + "_mixpanel"; var t = e.persistence; "cookie" !== t && "localStorage" !== t && (Pt.critical("Unknown persistence type " + t + "; falling back to cookie"), t = e.persistence = "cookie"), "localStorage" === t && At.localStorage.is_supported() ? this.storage = At.localStorage : this.storage = At.cookie, this.load(), this.update_config(e), this.upgrade(), this.save(); }; Jr.prototype.properties = function () { var e = {}; return this.load(), At.each(this.props, (function (t, r) { At.include(Hr, r) || (e[r] = t); })), e; }, Jr.prototype.load = function () { if (!this.disabled) { var e = this.storage.parse(this.name); e && (this.props = At.extend({}, e)); } }, Jr.prototype.upgrade = function () { var e, t; this.storage === At.localStorage ? (e = At.cookie.parse(this.name), At.cookie.remove(this.name), At.cookie.remove(this.name, !0), e && this.register_once(e)) : this.storage === At.cookie && (t = At.localStorage.parse(this.name), At.localStorage.remove(this.name), t && this.register_once(t)); }, Jr.prototype.save = function () { this.disabled || this.storage.set(this.name, At.JSONEncode(this.props), this.expire_days, this.cross_subdomain, this.secure, this.cross_site, this.cookie_domain); }, Jr.prototype.load_prop = function (e) { return this.load(), this.props[e]; }, Jr.prototype.remove = function () { this.storage.remove(this.name, !1, this.cookie_domain), this.storage.remove(this.name, !0, this.cookie_domain); }, Jr.prototype.clear = function () { this.remove(), this.props = {}; }, Jr.prototype.register_once = function (e, t, r) { return !!At.isObject(e) && (void 0 === t && (t = "None"), this.expire_days = void 0 === r ? this.default_expiry : r, this.load(), At.each(e, (function (e, r) { (!this.props.hasOwnProperty(r) || this.props[r] === t) && (this.props[r] = e); }), this), this.save(), !0); }, Jr.prototype.register = function (e, t) { return !!At.isObject(e) && (this.expire_days = void 0 === t ? this.default_expiry : t, this.load(), At.extend(this.props, e), this.save(), !0); }, Jr.prototype.unregister = function (e) { this.load(), e in this.props && (delete this.props[e], this.save()); }, Jr.prototype.update_search_keyword = function (e) { this.register(At.info.searchInfo(e)); }, Jr.prototype.update_referrer_info = function (e) { this.register_once({ $initial_referrer: e || "$direct", $initial_referring_domain: At.info.referringDomain(e) || "$direct" }, ""); }, Jr.prototype.get_referrer_info = function () { return At.strip_empty_properties({ $initial_referrer: this.props.$initial_referrer, $initial_referring_domain: this.props.$initial_referring_domain }); }, Jr.prototype.update_config = function (e) { this.default_expiry = this.expire_days = e.cookie_expiration, this.set_disabled(e.disable_persistence), this.set_cookie_domain(e.cookie_domain), this.set_cross_site(e.cross_site_cookie), this.set_cross_subdomain(e.cross_subdomain_cookie), this.set_secure(e.secure_cookie); }, Jr.prototype.set_disabled = function (e) { this.disabled = e, this.disabled ? this.remove() : this.save(); }, Jr.prototype.set_cookie_domain = function (e) { e !== this.cookie_domain && (this.remove(), this.cookie_domain = e, this.save()); }, Jr.prototype.set_cross_site = function (e) { e !== this.cross_site && (this.cross_site = e, this.remove(), this.save()); }, Jr.prototype.set_cross_subdomain = function (e) { e !== this.cross_subdomain && (this.cross_subdomain = e, this.remove(), this.save()); }, Jr.prototype.get_cross_subdomain = function () { return this.cross_subdomain; }, Jr.prototype.set_secure = function (e) { e !== this.secure && (this.secure = !!e, this.remove(), this.save()); }, Jr.prototype._add_to_people_queue = function (e, t) { var r = this._get_queue_key(e), n = t[e], i = this._get_or_create_queue(Mr), o = this._get_or_create_queue(Or), s = this._get_or_create_queue(xr), a = this._get_or_create_queue(Tr), c = this._get_or_create_queue(Dr), l = this._get_or_create_queue(Rr, []), u = this._get_or_create_queue(Nr, []); r === qr ? (At.extend(i, n), this._pop_from_people_queue(Tr, n), this._pop_from_people_queue(Dr, n), this._pop_from_people_queue(xr, n)) : r === Fr ? (At.each(n, (function (e, t) { t in o || (o[t] = e); })), this._pop_from_people_queue(xr, n)) : r === $r ? At.each(n, (function (e) { At.each([i, o, a, c], (function (t) { e in t && delete t[e]; })), At.each(u, (function (t) { e in t && delete t[e]; })), s[e] = !0; })) : r === Ur ? (At.each(n, (function (e, t) { t in i ? i[t] += e : (t in a || (a[t] = 0), a[t] += e); }), this), this._pop_from_people_queue(xr, n)) : r === Vr ? (At.each(n, (function (e, t) { At.isArray(e) && (t in c || (c[t] = []), c[t] = c[t].concat(e)); })), this._pop_from_people_queue(xr, n)) : r === Br ? (l.push(n), this._pop_from_people_queue(Nr, n)) : r === jr && (u.push(n), this._pop_from_people_queue(xr, n)), Pt.log("MIXPANEL PEOPLE REQUEST (QUEUED, PENDING IDENTIFY):"), Pt.log(t), this.save(); }, Jr.prototype._pop_from_people_queue = function (e, t) { var r = this.props[this._get_queue_key(e)]; At.isUndefined(r) || At.each(t, (function (t, n) { e === Nr || e === Rr ? At.each(r, (function (e) { e[n] === t && delete e[n]; })) : delete r[n]; }), this); }, Jr.prototype.load_queue = function (e) { return this.load_prop(this._get_queue_key(e)); }, Jr.prototype._get_queue_key = function (e) { return e === Mr ? qr : e === Or ? Fr : e === xr ? $r : e === Tr ? Ur : e === Nr ? jr : e === Rr ? Br : e === Dr ? Vr : void Pt.error("Invalid queue:", e); }, Jr.prototype._get_or_create_queue = function (e, t) { var r = this._get_queue_key(e); return t = At.isUndefined(t) ? {} : t, this.props[r] || (this.props[r] = t); }, Jr.prototype.set_event_timer = function (e, t) { var r = this.load_prop(Gr) || {}; r[e] = t, this.props[Gr] = r, this.save(); }, Jr.prototype.remove_event_timer = function (e) { var t = (this.load_prop(Gr) || {})[e]; return At.isUndefined(t) || (delete this.props[Gr][e], this.save()), t; }; var Kr, Qr, Xr = function (e, t) { throw new Error(e + " not available in this build."); }, Yr = function (e) { return e; }, Zr = function () { }, en = "mixpanel", tn = "base64", rn = "$device:", nn = pt.XMLHttpRequest && "withCredentials" in new XMLHttpRequest, on = !nn && -1 === Ot.indexOf("MSIE") && -1 === Ot.indexOf("Mozilla"), sn = null; Et.sendBeacon && (sn = function () { return Et.sendBeacon.apply(Et, arguments); }); var an = { track: "track/", engage: "engage/", groups: "groups/", record: "record/" }, cn = { api_host: "https://api-js.mixpanel.com", api_routes: an, api_method: "POST", api_transport: "XHR", api_payload_format: tn, app_host: "https://mixpanel.com", cdn: "https://cdn.mxpnl.com", cross_site_cookie: !1, cross_subdomain_cookie: !0, error_reporter: Zr, persistence: "cookie", persistence_name: "", cookie_domain: "", cookie_name: "", loaded: Zr, mp_loader: null, track_marketing: !0, track_pageview: !1, skip_first_touch_marketing: !1, store_google: !0, stop_utm_persistence: !1, save_referrer: !0, test: !1, verbose: !1, img: !1, debug: !1, track_links_timeout: 300, cookie_expiration: 365, upgrade: !1, disable_persistence: !1, disable_cookie: !1, secure_cookie: !1, ip: !0, opt_out_tracking_by_default: !1, opt_out_persistence_by_default: !1, opt_out_tracking_persistence_type: "localStorage", opt_out_tracking_cookie_prefix: null, property_blacklist: [], xhr_headers: {}, ignore_dnt: !1, batch_requests: !0, batch_size: 50, batch_flush_interval_ms: 5e3, batch_request_timeout_ms: 9e4, batch_autostart: !0, hooks: {}, record_block_class: new RegExp("^(mp-block|fs-exclude|amp-block|rr-block|ph-no-capture)$"), record_block_selector: "img, video", record_collect_fonts: !1, record_idle_timeout_ms: 18e5, record_inline_images: !1, record_mask_text_class: new RegExp("^(mp-mask|fs-mask|amp-mask|rr-mask|ph-mask)$"), record_mask_text_selector: "*", record_max_ms: gt, record_sessions_percent: 0, recorder_src: "https://cdn.mxpnl.com/libs/mixpanel-recorder.min.js" }, ln = !1, un = function () { }, pn = function (e, t, r) { var n, i = r === en ? Qr : Qr[r]; if (i && 0 === Kr) n = i; else { if (i && !At.isArray(i)) return void Pt.error("You have already initialized " + r); n = new un; } if (n._cached_groups = {}, n._init(e, t, r), n.people = new Pr, n.people._init(n), !n.get_config("skip_first_touch_marketing")) { var o = At.info.campaignParams(null), s = {}, a = !1; At.each(o, (function (e, t) { s["initial_" + t] = e, e && (a = !0); })), a && n.people.set_once(s); } return ft.DEBUG = ft.DEBUG || n.get_config("debug"), !At.isUndefined(i) && At.isArray(i) && (n._execute_array.call(n.people, i.people), n._execute_array(i)), n; }; un.prototype.init = function (e, t, r) { if (At.isUndefined(r)) this.report_error("You must name your new library: init(token, config, name)"); else { if (r !== en) { var n = pn(e, t, r); return Qr[r] = n, n._loaded(), n; } this.report_error("You must initialize the main mixpanel object right after you include the Mixpanel js snippet"); } }, un.prototype._init = function (e, t, r) { t = t || {}, this.__loaded = !0, this.config = {}; var n = {}; "api_payload_format" in t || (t.api_host || cn.api_host).match(/\.mixpanel\.com/) && (n.api_payload_format = "json"); if (this.set_config(At.extend({}, cn, n, t, { name: r, token: e, callback_fn: (r === en ? r : en + "." + r) + "._jsc" })), this._jsc = Zr, this.__dom_loaded_queue = [], this.__request_queue = [], this.__disabled_events = [], this._flags = { disable_all_events: !1, identify_called: !1 }, this.request_batchers = {}, this._batch_requests = this.get_config("batch_requests"), this._batch_requests) if (At.localStorage.is_supported(!0) && nn) { if (this.init_batchers(), sn && pt.addEventListener) { var i = At.bind((function () { this.request_batchers.events.stopped || this.request_batchers.events.flush({ unloading: !0 }); }), this); pt.addEventListener("pagehide", (function (e) { e.persisted && i(); })), pt.addEventListener("visibilitychange", (function () { "hidden" === It.visibilityState && i(); })); } } else this._batch_requests = !1, Pt.log("Turning off Mixpanel request-queueing; needs XHR and localStorage support"), At.each(this.get_batcher_configs(), (function (e) { Pt.log("Clearing batch queue " + e.queue_key), At.localStorage.remove(e.queue_key); })); this.persistence = this.cookie = new Jr(this.config), this.unpersisted_superprops = {}, this._gdpr_init(); var o = At.UUID(); this.get_distinct_id() || this.register_once({ distinct_id: rn + o, $device_id: o }, ""); var s = this.get_config("track_pageview"); s && this._init_url_change_tracking(s), this.get_config("record_sessions_percent") > 0 && 100 * Math.random() <= this.get_config("record_sessions_percent") && this.start_session_recording(); }, un.prototype.start_session_recording = rr((function () { if (pt.MutationObserver) { var e = At.bind((function () { this._recorder = this._recorder || new pt.__mp_recorder(this), this._recorder.startRecording(); }), this); At.isUndefined(pt.__mp_recorder) ? Xr(this.get_config("recorder_src"), e) : e(); } else Pt.critical("Browser does not support MutationObserver; skipping session recording"); })), un.prototype.stop_session_recording = function () { this._recorder ? this._recorder.stopRecording() : Pt.critical("Session recorder module not loaded"); }, un.prototype.get_session_recording_properties = function () { var e = {}; if (this._recorder) { var t = this._recorder.replayId; t && (e.$mp_replay_id = t); } return e; }, un.prototype._loaded = function () { if (this.get_config("loaded")(this), this._set_default_superprops(), this.people.set_once(this.persistence.get_referrer_info()), this.get_config("store_google") && this.get_config("stop_utm_persistence")) { var e = At.info.campaignParams(null); At.each(e, function (e, t) { this.unregister(t); }.bind(this)); } }, un.prototype._set_default_superprops = function () { this.persistence.update_search_keyword(It.referrer), this.get_config("store_google") && !this.get_config("stop_utm_persistence") && this.register(At.info.campaignParams()), this.get_config("save_referrer") && this.persistence.update_referrer_info(It.referrer); }, un.prototype._dom_loaded = function () { At.each(this.__dom_loaded_queue, (function (e) { this._track_dom.apply(this, e); }), this), this.has_opted_out_tracking() || At.each(this.__request_queue, (function (e) { this._send_request.apply(this, e); }), this), delete this.__dom_loaded_queue, delete this.__request_queue; }, un.prototype._track_dom = function (e, t) { if (this.get_config("img")) return this.report_error("You can't use DOM tracking functions with img = true."), !1; if (!ln) return this.__dom_loaded_queue.push([e, t]), !1; var r = (new e).init(this); return r.track.apply(r, t); }, un.prototype._init_url_change_tracking = function (e) { var t = ""; if (this.track_pageview() && (t = At.info.currentUrl()), At.include(["full-url", "url-with-path-and-query-string", "url-with-path"], e)) { pt.addEventListener("popstate", (function () { pt.dispatchEvent(new Event("mp_locationchange")); })), pt.addEventListener("hashchange", (function () { pt.dispatchEvent(new Event("mp_locationchange")); })); var r = pt.history.pushState; "function" == typeof r && (pt.history.pushState = function (e, t, n) { r.call(pt.history, e, t, n), pt.dispatchEvent(new Event("mp_locationchange")); }); var n = pt.history.replaceState; "function" == typeof n && (pt.history.replaceState = function (e, t, r) { n.call(pt.history, e, t, r), pt.dispatchEvent(new Event("mp_locationchange")); }), pt.addEventListener("mp_locationchange", function () { var r = At.info.currentUrl(), n = !1; ("full-url" === e ? n = r !== t : "url-with-path-and-query-string" === e ? n = r.split("#")[0] !== t.split("#")[0] : "url-with-path" === e && (n = r.split("#")[0].split("?")[0] !== t.split("#")[0].split("?")[0]), n) && (this.track_pageview() && (t = r)); }.bind(this)); } }, un.prototype._prepare_callback = function (e, t) { if (At.isUndefined(e)) return null; if (nn) { return function (r) { e(r, t); }; } var r = this._jsc, n = "" + Math.floor(1e8 * Math.random()), i = this.get_config("callback_fn") + "[" + n + "]"; return r[n] = function (i) { delete r[n], e(i, t); }, i; }, un.prototype._send_request = function (e, t, r, n) { var i = !0; if (on) return this.__request_queue.push(arguments), i; var o = { method: this.get_config("api_method"), transport: this.get_config("api_transport"), verbose: this.get_config("verbose") }, s = null; !n && (At.isFunction(r) || "string" == typeof r) && (n = r, r = null), r = At.extend(o, r || {}), nn || (r.method = "GET"); var a = "POST" === r.method, c = sn && a && "sendbeacon" === r.transport.toLowerCase(), l = r.verbose; t.verbose && (l = !0), this.get_config("test") && (t.test = 1), l && (t.verbose = 1), this.get_config("img") && (t.img = 1), nn || (n ? t.callback = n : (l || this.get_config("test")) && (t.callback = "(function(){})")), t.ip = this.get_config("ip") ? 1 : 0, t._ = (new Date).getTime().toString(), a && (s = "data=" + encodeURIComponent(t.data), delete t.data), e += "?" + At.HTTPBuildQuery(t); var u = this; if ("img" in t) { var p = It.createElement("img"); p.src = e, It.body.appendChild(p); } else if (c) { try { i = sn(e, s); } catch (e) { u.report_error(e), i = !1; } try { n && n(i ? 1 : 0); } catch (e) { u.report_error(e); } } else if (nn) try { var d = new XMLHttpRequest; d.open(r.method, e, !0); var h = this.get_config("xhr_headers"); if (a && (h["Content-Type"] = "application/x-www-form-urlencoded"), At.each(h, (function (e, t) { d.setRequestHeader(t, e); })), r.timeout_ms && void 0 !== d.timeout) { d.timeout = r.timeout_ms; var f = (new Date).getTime(); } d.withCredentials = !0, d.onreadystatechange = function () { if (4 === d.readyState) if (200 === d.status) { if (n) if (l) { var e; try { e = At.JSONDecode(d.responseText); } catch (t) { if (u.report_error(t), !r.ignore_json_errors) return; e = d.responseText; } n(e); } else n(Number(d.responseText)); } else { var t; if (t = d.timeout && !d.status && (new Date).getTime() - f >= d.timeout ? "timeout" : "Bad HTTP status: " + d.status + " " + d.statusText, u.report_error(t), n) if (l) { var i = d.responseHeaders || {}; n({ status: 0, httpStatusCode: d.status, error: t, retryAfter: i["Retry-After"] }); } else n(0); } }, d.send(s); } catch (e) { u.report_error(e), i = !1; } else { var m = It.createElement("script"); m.type = "text/javascript", m.async = !0, m.defer = !0, m.src = e; var g = It.getElementsByTagName("script")[0]; g.parentNode.insertBefore(m, g); } return i; }, un.prototype._execute_array = function (e) { var t, r = [], n = [], i = []; At.each(e, (function (e) { e && (t = e[0], At.isArray(t) ? i.push(e) : "function" == typeof e ? e.call(this) : At.isArray(e) && "alias" === t ? r.push(e) : At.isArray(e) && -1 !== t.indexOf("track") && "function" == typeof this[t] ? i.push(e) : n.push(e)); }), this); var o = function (e, t) { At.each(e, (function (e) { if (At.isArray(e[0])) { var r = t; At.each(e, (function (e) { r = r[e[0]].apply(r, e.slice(1)); })); } else this[e[0]].apply(this, e.slice(1)); }), t); }; o(r, this), o(n, this), o(i, this); }, un.prototype.are_batchers_initialized = function () { return !!this.request_batchers.events; }, un.prototype.get_batcher_configs = function () { var e = "__mpq_" + this.get_config("token"), t = this.get_config("api_routes"); return this._batcher_configs = this._batcher_configs || { events: { type: "events", endpoint: "/" + t.track, queue_key: e + "_ev" }, people: { type: "people", endpoint: "/" + t.engage, queue_key: e + "_pp" }, groups: { type: "groups", endpoint: "/" + t.groups, queue_key: e + "_gr" } }, this._batcher_configs; }, un.prototype.init_batchers = function () { if (!this.are_batchers_initialized()) { var e = At.bind((function (e) { return new yr(e.queue_key, { libConfig: this.config, errorReporter: this.get_config("error_reporter"), sendRequestFunc: At.bind((function (t, r, n) { this._send_request(this.get_config("api_host") + e.endpoint, this._encode_data_for_request(t), r, this._prepare_callback(n, t)); }), this), beforeSendHook: At.bind((function (t) { return this._run_hook("before_send_" + e.type, t); }), this), stopAllBatchingFunc: At.bind(this.stop_batch_senders, this), usePersistence: !0 }); }), this), t = this.get_batcher_configs(); this.request_batchers = { events: e(t.events), people: e(t.people), groups: e(t.groups) }; } this.get_config("batch_autostart") && this.start_batch_senders(); }, un.prototype.start_batch_senders = function () { this._batchers_were_started = !0, this.are_batchers_initialized() && (this._batch_requests = !0, At.each(this.request_batchers, (function (e) { e.start(); }))); }, un.prototype.stop_batch_senders = function () { this._batch_requests = !1, At.each(this.request_batchers, (function (e) { e.stop(), e.clear(); })); }, un.prototype.push = function (e) { this._execute_array([e]); }, un.prototype.disable = function (e) { void 0 === e ? this._flags.disable_all_events = !0 : this.__disabled_events = this.__disabled_events.concat(e); }, un.prototype._encode_data_for_request = function (e) { var t = At.JSONEncode(e); return this.get_config("api_payload_format") === tn && (t = At.base64Encode(t)), { data: t }; }, un.prototype._track_or_batch = function (e, t) { var r = At.truncate(e.data, 255), n = e.endpoint, i = e.batcher, o = e.should_send_immediately, s = e.send_request_options || {}; t = t || Zr; var a = !0, c = At.bind((function () { return s.skip_hooks || (r = this._run_hook("before_send_" + e.type, r)), r ? (Pt.log("MIXPANEL REQUEST:"), Pt.log(r), this._send_request(n, this._encode_data_for_request(r), s, this._prepare_callback(t, r))) : null; }), this); return this._batch_requests && !o ? i.enqueue(r, (function (e) { e ? t(1, r) : c(); })) : a = c(), a && r; }, un.prototype.track = rr((function (e, t, r, n) { !n && "function" == typeof r && (n = r, r = null); var i = (r = r || {}).transport; i && (r.transport = i); var o = r.send_immediately; if ("function" != typeof n && (n = Zr), At.isUndefined(e)) this.report_error("No event name provided to mixpanel.track"); else { if (!this._event_is_disabled(e)) { (t = At.extend({}, t)).token = this.get_config("token"); var s = this.persistence.remove_event_timer(e); if (!At.isUndefined(s)) { var a = (new Date).getTime() - s; t.$duration = parseFloat((a / 1e3).toFixed(3)); } this._set_default_superprops(); var c = this.get_config("track_marketing") ? At.info.marketingParams() : {}; t = At.extend({}, At.info.properties({ mp_loader: this.get_config("mp_loader") }), c, this.persistence.properties(), this.unpersisted_superprops, this.get_session_recording_properties(), t); var l = this.get_config("property_blacklist"); At.isArray(l) ? At.each(l, (function (e) { delete t[e]; })) : this.report_error("Invalid value for property_blacklist config: " + l); var u = { event: e, properties: t }; return this._track_or_batch({ type: "events", data: u, endpoint: this.get_config("api_host") + "/" + this.get_config("api_routes").track, batcher: this.request_batchers.events, should_send_immediately: o, send_request_options: r }, n); } n(0); } })), un.prototype.set_group = rr((function (e, t, r) { At.isArray(t) || (t = [t]); var n = {}; return n[e] = t, this.register(n), this.people.set(e, t, r); })), un.prototype.add_group = rr((function (e, t, r) { var n = this.get_property(e), i = {}; return void 0 === n ? (i[e] = [t], this.register(i)) : -1 === n.indexOf(t) && (n.push(t), i[e] = n, this.register(i)), this.people.union(e, t, r); })), un.prototype.remove_group = rr((function (e, t, r) { var n = this.get_property(e); if (void 0 !== n) { var i = n.indexOf(t); i > -1 && (n.splice(i, 1), this.register({ group_key: n })), 0 === n.length && this.unregister(e); } return this.people.remove(e, t, r); })), un.prototype.track_with_groups = rr((function (e, t, r, n) { var i = At.extend({}, t || {}); return At.each(r, (function (e, t) { null != e && (i[t] = e); })), this.track(e, i, n); })), un.prototype._create_map_key = function (e, t) { return e + "_" + JSON.stringify(t); }, un.prototype._remove_group_from_cache = function (e, t) { delete this._cached_groups[this._create_map_key(e, t)]; }, un.prototype.get_group = function (e, t) { var r = this._create_map_key(e, t), n = this._cached_groups[r]; return (void 0 === n || n._group_key !== e || n._group_id !== t) && ((n = new Ar)._init(this, e, t), this._cached_groups[r] = n), n; }, un.prototype.track_pageview = rr((function (e, t) { "object" != typeof e && (e = {}); var r = (t = t || {}).event_name || "$mp_web_page_view", n = At.extend(At.info.mpPageViewProperties(), At.info.campaignParams(), At.info.clickParams()), i = At.extend({}, n, e); return this.track(r, i); })), un.prototype.track_links = function () { return this._track_dom.call(this, Ir, arguments); }, un.prototype.track_forms = function () { return this._track_dom.call(this, Cr, arguments); }, un.prototype.time_event = function (e) { At.isUndefined(e) ? this.report_error("No event name provided to mixpanel.time_event") : this._event_is_disabled(e) || this.persistence.set_event_timer(e, (new Date).getTime()); }; var dn = { persistent: !0 }, hn = function (e) { var t; return t = At.isObject(e) ? e : At.isUndefined(e) ? {} : { days: e }, At.extend({}, dn, t); }; un.prototype.register = function (e, t) { var r = hn(t); r.persistent ? this.persistence.register(e, r.days) : At.extend(this.unpersisted_superprops, e); }, un.prototype.register_once = function (e, t, r) { var n = hn(r); n.persistent ? this.persistence.register_once(e, t, n.days) : (void 0 === t && (t = "None"), At.each(e, (function (e, r) { (!this.unpersisted_superprops.hasOwnProperty(r) || this.unpersisted_superprops[r] === t) && (this.unpersisted_superprops[r] = e); }), this)); }, un.prototype.unregister = function (e, t) { (t = hn(t)).persistent ? this.persistence.unregister(e) : delete this.unpersisted_superprops[e]; }, un.prototype._register_single = function (e, t) { var r = {}; r[e] = t, this.register(r); }, un.prototype.identify = function (e, t, r, n, i, o, s, a) { var c = this.get_distinct_id(); if (e && c !== e) { if ("string" == typeof e && 0 === e.indexOf(rn)) return this.report_error("distinct_id cannot have $device: prefix"), -1; this.register({ $user_id: e }); } if (!this.get_property("$device_id")) { var l = c; this.register_once({ $had_persisted_distinct_id: !0, $device_id: l }, ""); } e !== c && e !== this.get_property(Wr) && (this.unregister(Wr), this.register({ distinct_id: e })), this._flags.identify_called = !0, this.people._flush(t, r, n, i, o, s, a), e !== c && this.track("$identify", { distinct_id: e, $anon_distinct_id: c }, { skip_hooks: !0 }); }, un.prototype.reset = function () { this.persistence.clear(), this._flags.identify_called = !1; var e = At.UUID(); this.register_once({ distinct_id: rn + e, $device_id: e }, ""); }, un.prototype.get_distinct_id = function () { return this.get_property("distinct_id"); }, un.prototype.alias = function (e, t) { if (e === this.get_property(zr)) return this.report_error("Attempting to create alias for existing People user - aborting."), -2; var r = this; return At.isUndefined(t) && (t = this.get_distinct_id()), e !== t ? (this._register_single(Wr, e), this.track("$create_alias", { alias: e, distinct_id: t }, { skip_hooks: !0 }, (function () { r.identify(e); }))) : (this.report_error("alias matches current distinct_id - skipping api call."), this.identify(e), -1); }, un.prototype.name_tag = function (e) { this._register_single("mp_name_tag", e); }, un.prototype.set_config = function (e) { At.isObject(e) && (At.extend(this.config, e), e.batch_size && At.each(this.request_batchers, (function (e) { e.resetBatchSize(); })), this.get_config("persistence_name") || (this.config.persistence_name = this.config.cookie_name), this.get_config("disable_persistence") || (this.config.disable_persistence = this.config.disable_cookie), this.persistence && this.persistence.update_config(this.config), ft.DEBUG = ft.DEBUG || this.get_config("debug")); }, un.prototype.get_config = function (e) { return this.config[e]; }, un.prototype._run_hook = function (e) { var t = (this.config.hooks[e] || Yr).apply(this, bt.call(arguments, 1)); return void 0 === t && (this.report_error(e + " hook did not return a value"), t = null), t; }, un.prototype.get_property = function (e) { return this.persistence.load_prop([e]); }, un.prototype.toString = function () { var e = this.get_config("name"); return e !== en && (e = en + "." + e), e; }, un.prototype._event_is_disabled = function (e) { return At.isBlockedUA(Ot) || this._flags.disable_all_events || At.include(this.__disabled_events, e); }, un.prototype._gdpr_init = function () { "localStorage" === this.get_config("opt_out_tracking_persistence_type") && At.localStorage.is_supported() && (!this.has_opted_in_tracking() && this.has_opted_in_tracking({ persistence_type: "cookie" }) && this.opt_in_tracking({ enable_persistence: !1 }), !this.has_opted_out_tracking() && this.has_opted_out_tracking({ persistence_type: "cookie" }) && this.opt_out_tracking({ clear_persistence: !1 }), this.clear_opt_in_out_tracking({ persistence_type: "cookie", enable_persistence: !1 })), this.has_opted_out_tracking() ? this._gdpr_update_persistence({ clear_persistence: !0 }) : !this.has_opted_in_tracking() && (this.get_config("opt_out_tracking_by_default") || At.cookie.get("mp_optout")) && (At.cookie.remove("mp_optout"), this.opt_out_tracking({ clear_persistence: this.get_config("opt_out_persistence_by_default") })); }, un.prototype._gdpr_update_persistence = function (e) { var t; if (e && e.clear_persistence) t = !0; else { if (!e || !e.enable_persistence) return; t = !1; } !this.get_config("disable_persistence") && this.persistence.disabled !== t && this.persistence.set_disabled(t), t ? this.stop_batch_senders() : this._batchers_were_started && this.start_batch_senders(); }, un.prototype._gdpr_call_func = function (e, t) { return t = At.extend({ track: At.bind(this.track, this), persistence_type: this.get_config("opt_out_tracking_persistence_type"), cookie_prefix: this.get_config("opt_out_tracking_cookie_prefix"), cookie_expiration: this.get_config("cookie_expiration"), cross_site_cookie: this.get_config("cross_site_cookie"), cross_subdomain_cookie: this.get_config("cross_subdomain_cookie"), cookie_domain: this.get_config("cookie_domain"), secure_cookie: this.get_config("secure_cookie"), ignore_dnt: this.get_config("ignore_dnt") }, t), At.localStorage.is_supported() || (t.persistence_type = "cookie"), e(this.get_config("token"), { track: t.track, trackEventName: t.track_event_name, trackProperties: t.track_properties, persistenceType: t.persistence_type, persistencePrefix: t.cookie_prefix, cookieDomain: t.cookie_domain, cookieExpiration: t.cookie_expiration, crossSiteCookie: t.cross_site_cookie, crossSubdomainCookie: t.cross_subdomain_cookie, secureCookie: t.secure_cookie, ignoreDnt: t.ignore_dnt }); }, un.prototype.opt_in_tracking = function (e) { e = At.extend({ enable_persistence: !0 }, e), this._gdpr_call_func(Yt, e), this._gdpr_update_persistence(e); }, un.prototype.opt_out_tracking = function (e) { (e = At.extend({ clear_persistence: !0, delete_user: !0 }, e)).delete_user && this.people && this.people._identify_called() && (this.people.delete_user(), this.people.clear_charges()), this._gdpr_call_func(Zt, e), this._gdpr_update_persistence(e); }, un.prototype.has_opted_in_tracking = function (e) { return this._gdpr_call_func(er, e); }, un.prototype.has_opted_out_tracking = function (e) { return this._gdpr_call_func(tr, e); }, un.prototype.clear_opt_in_out_tracking = function (e) { e = At.extend({ enable_persistence: !0 }, e), this._gdpr_call_func(or, e), this._gdpr_update_persistence(e); }, un.prototype.report_error = function (e, t) { Pt.error.apply(Pt.error, arguments); try { !t && !(e instanceof Error) && (e = new Error(e)), this.get_config("error_reporter")(e, t); } catch (e) { Pt.error(e); } }, un.prototype.init = un.prototype.init, un.prototype.reset = un.prototype.reset, un.prototype.disable = un.prototype.disable, un.prototype.time_event = un.prototype.time_event, un.prototype.track = un.prototype.track, un.prototype.track_links = un.prototype.track_links, un.prototype.track_forms = un.prototype.track_forms, un.prototype.track_pageview = un.prototype.track_pageview, un.prototype.register = un.prototype.register, un.prototype.register_once = un.prototype.register_once, un.prototype.unregister = un.prototype.unregister, un.prototype.identify = un.prototype.identify, un.prototype.alias = un.prototype.alias, un.prototype.name_tag = un.prototype.name_tag, un.prototype.set_config = un.prototype.set_config, un.prototype.get_config = un.prototype.get_config, un.prototype.get_property = un.prototype.get_property, un.prototype.get_distinct_id = un.prototype.get_distinct_id, un.prototype.toString = un.prototype.toString, un.prototype.opt_out_tracking = un.prototype.opt_out_tracking, un.prototype.opt_in_tracking = un.prototype.opt_in_tracking, un.prototype.has_opted_out_tracking = un.prototype.has_opted_out_tracking, un.prototype.has_opted_in_tracking = un.prototype.has_opted_in_tracking, un.prototype.clear_opt_in_out_tracking = un.prototype.clear_opt_in_out_tracking, un.prototype.get_group = un.prototype.get_group, un.prototype.set_group = un.prototype.set_group, un.prototype.add_group = un.prototype.add_group, un.prototype.remove_group = un.prototype.remove_group, un.prototype.track_with_groups = un.prototype.track_with_groups, un.prototype.start_batch_senders = un.prototype.start_batch_senders, un.prototype.stop_batch_senders = un.prototype.stop_batch_senders, un.prototype.start_session_recording = un.prototype.start_session_recording, un.prototype.stop_session_recording = un.prototype.stop_session_recording, un.prototype.get_session_recording_properties = un.prototype.get_session_recording_properties, un.prototype.DEFAULT_API_ROUTES = an, Jr.prototype.properties = Jr.prototype.properties, Jr.prototype.update_search_keyword = Jr.prototype.update_search_keyword, Jr.prototype.update_referrer_info = Jr.prototype.update_referrer_info, Jr.prototype.get_cross_subdomain = Jr.prototype.get_cross_subdomain, Jr.prototype.clear = Jr.prototype.clear; var fn = {}, mn = function () { Qr.init = function (e, t, r) { if (r) return Qr[r] || (Qr[r] = fn[r] = pn(e, t, r), Qr[r]._loaded()), Qr[r]; var n = Qr; fn[en] ? n = fn[en] : e && ((n = pn(e, t, en))._loaded(), fn[en] = n), Qr = n, 1 === Kr && (pt[en] = Qr), At.each(fn, (function (e, t) { t !== en && (Qr[t] = e); })), Qr._ = At; }; }; var gn = function (e) { return Xr = e, Kr = 0, Qr = new un, mn(), Qr.init(), function () { function e() { e.done || (e.done = !0, ln = !0, on = !1, At.each(fn, (function (e) { e._dom_loaded(); }))); } if (It.addEventListener) "complete" === It.readyState ? e() : It.addEventListener("DOMContentLoaded", e, !1); else if (It.attachEvent) { It.attachEvent("onreadystatechange", e); var t = !1; try { t = null === pt.frameElement; } catch (e) { } It.documentElement.doScroll && t && function t() { try { It.documentElement.doScroll("left"); } catch (e) { return void setTimeout(t, 1); } e(); }(); } At.register_event(pt, "load", e, !0); }(), Qr; }((function (e, t) { t(); })); function _n(e, t) { return e.match(/\\?.|^$/g).reduce(((e, r) => ('"' !== r || e.sQuote ? "'" !== r || e.quote ? e.quote || e.sQuote || r !== t ? e.a[e.a.length - 1] += r : e.a.push("") : (e.sQuote ^= 1, e.a[e.a.length - 1] += r) : (e.quote ^= 1, e.a[e.a.length - 1] += r), e)), { a: [""] }).a; } function yn(e) { return e.nodeType === Node.DOCUMENT_FRAGMENT_NODE || e.nodeType === Node.DOCUMENT_NODE; } function vn(e, t) { let r = e.parentNode; return r && r.host && 11 === r.nodeType ? r.host : r === t ? null : r; } var bn = { "PAGE → full url (/)": decodeURIComponent(document.location.href), "PAGE → short url (/)": decodeURIComponent(window.location.pathname), "PAGE → url params (?)": function (e) { try { let t = new URLSearchParams(e); return Object.fromEntries(t); } catch (e) { return {}; } }(window.location.search), "PAGE → height": window.innerHeight, "PAGE → width": window.innerWidth, "PAGE → title": document.title, "SESSION → # pages": window.history.length, $source: "mpEZTrack" }, kn = '*[type="password"], *[type="hidden"], *.sensitive, *.pendo-ignore, *[data-heap-redact-text], *[data-heap-redact-attributes], label', Sn = { passive: !0 }, wn = (e, t = "ELEM") => l(l({ [`${t} → classes`]: e.classList ? [...e.classList] : [], [`${t} → height`]: e.offsetHeight, [`${t} → width`]: e.offsetWidth, [`${t} → tag (<>)`]: "".concat("<", e.tagName, ">") }, function (e, t = "ELEM") { var r, n, i, o, s, a, c, l; let u = {}, p = `${t} → label`; if (0 === Array.from((null == e ? void 0 : e.labels) || "").length && ("LABEL" === (null == (r = e.previousElementSibling) ? void 0 : r.nodeName) && (u[p] = e.previousElementSibling.textContent.trim()), "LABEL" === (null == (n = e.nextElementSibling) ? void 0 : n.nodeName) && (u[p] = e.nextElementSibling.textContent.trim()), "LABEL" === (null == (i = e.parentElement) ? void 0 : i.nodeName) && (u[p] = e.parentElement.textContent.trim()), "LABEL" === (null == (s = null == (o = e.childNodes) ? void 0 : o[0]) ? void 0 : s.nodeName) && (u[p] = e.childNodes[0].textContent.trim()), null != (a = e.parentElement) && a.title && (u[p] = e.parentElement.title.trim()), null != (c = e.parentElement) && c.name && (u[p] = e.parentElement.name.trim()), null != (l = e.parentElement) && l.id && (u[p] = e.parentElement.id.trim()), !u[p])) { let t = function (e) { try { if (!e) return !1; if (e.textContent) { if ("" !== e.textContent.trim()) return u[p] = function (e, t = 50, r = !0) { if (!e) return ""; if (e.length <= t) return e; var n = e.substr(0, t - 1); return (r ? n.substr(0, n.lastIndexOf(" ")) : n) + "..."; }(qn(e.textContent)), !0; } else t(null == e ? void 0 : e.parentElement); } catch (e) { return !1; } }; t(e); } return "boolean" == typeof e.checked && (u[`${t} → checked`] = e.checked), "boolean" == typeof e.required && (u[`${t} → required?`] = e.checked), u; }(e, t)), function (e, t = "ELEM") { var r, n; let i = {}, o = ["allowfullscreen", "async", "autofocus", "autoplay", "checked", "controls", "default", "defer", "disabled", "formnovalidate", "ismap", "itemscope", "loop", "multiple", "muted", "nomodule", "novalidate", "open", "playsinline", "readonly", "required", "reversed", "selected", "truespeed"], s = { "aria-": "DATA → ", "data-": "DATA → ", src: "source", alt: "desc", class: "class (delete)" }, a = !1; for (var c, l = 0, u = e.attributes, p = (null == u ? void 0 : u.length) || 0; l < p; l++) { let e = !1, p = Pn((c = u[l]).name, s), d = `${t} → ${p}`, h = null == (r = c.value) ? void 0 : r.trim(); (null != (n = null == p ? void 0 : p.toLowerCase()) && n.includes("pass") && (e = !0, a = !0), null != p && p.startsWith("on") || "nonce" === p || "d" === p) || (o.some((e => e === c.name)) && (h = !0, d += "?"), e && (h = "******"), Ln(h) && (h = "******"), h && (i[d] = h)); } return delete i[`${t} → class (delete)`], delete i[`${t} → style`], a && (i[`${t} → user content`] = "******", i[`${t} → text`] = "******", i[`${t} → value`] = "******"), i; }(e, t)), En = "a", In = 'button, .button, .btn, input[type="button"], input[type="file"], input[type="image"], input[type="submit"], input[type="reset"]', Cn = "form", Mn = 'select, input[list], input[type="radio"], input[type="checkbox"], input[type="range"], input[type="color"], input[type="range"]', On = 'input[type="text"], input[type="email"], input[type="url"], input[type="search"], textarea', xn = '*:not(script):not(title):not(meta):not(link):not([type="password"])', Tn = (e, t = !1) => { var r, n; let i = { "ELEM → text": t ? "******" : (null == (r = e.textContent) ? void 0 : r.trim()) || (null == (n = e.value) ? void 0 : n.trim()), "ELEM → is editable?": e.isContentEditable }; return Ln(i["ELEM → text"]) && (i["ELEM → text"] = "******"), i; }, Nn = "video", Dn = "iframe"; function Rn(e) { let t = (null == e ? void 0 : e.getAttribute("href")) || "", r = { eventName: "", label: "" }; return null != t && t.startsWith("#") || null != t && t.startsWith("/") || null != t && t.startsWith(".") || null != t && t.includes(this.host) || null != t && t.startsWith("javascript") ? (r.eventName = "navigation", r.label = "NAV") : t ? (r.eventName = "link", r.label = "LINK") : (r.eventName = "navigation", r.label = "NAV"), r; } function Ln(e = "") { return !!e && [Fn, $n].map((t => t(e))).some((e => e)); } function An(e) { return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&"); } function Pn(e, t) { var r = []; for (var n in t) r.push(An(n)); return r = new RegExp(r.join("|"), "g"), e.replace(r, (function (e) { return t[e]; })); } function qn(e = "") { return e.trim().replace(/\s+/g, " "); } function Fn(e = "") { if (!e || ("string" != typeof e && (e = null == e ? void 0 : e.toString()), "0" === e)) return !1; for (var t = 0, r = !1, n = e.length - 1; n >= 0; n--) { var i = +e[n]; r && ((i *= 2) > 9 && (i -= 9)), t += i, r = !r; } return t % 10 == 0; } function $n(e = "") { if (!e) return !1; return !!/^(?!000|666)[0-8][0-9]{2}-(?!00)[0-9]{2}-(?!0000)[0-9]{4}$/.test(e); } var Un = { init: function (e = "", t = {}, r = !1) { if (!e || 32 !== e.length) throw console.error(`EZTrack: Bad Token!\n\ngot: "${e}"\nexpected 32 char string\n\ndouble check your mixpanel project token and try again!\nhttps://developer.mixpanel.com/reference/project-token`), new Error("BAD TOKEN! TRY AGAIN"); this.token = e; let o = this.defaultOpts(), s = l(l({}, o), t); if (r) { for (let e in s) "record_sessions_percent" !== e && ("boolean" == typeof s[e] && (s[e] = !0), "number" == typeof s[e] && (s[e] = 0)); "nodebug" === r && (s.debug = !1); } this.opts = Object.freeze(s), s.window && this.clearQueue(e, s); try { if (gn.init(e, ((e, t) => n(e, i(t)))(l({}, this.opts), { debug: s.debug, cross_subdomain_cookie: !0, persistence: s.persistence, cookie_domain: s.cookie_domain, ip: s.location, ignore_dnt: !0, batch_flush_interval_ms: s.refresh, property_blacklist: this.mpDefaults, loaded: t => { try { let r = this.getProps(e, s, gn); s.debug && (this.superProps = r), t.register(r, { persistent: !1 }); } catch (e) { s.debug && (console.error("mpEZTrack failed to setup super properties!"), console.log(e)); } try { this.blackListedElements = [...this.query(kn)]; } catch (e) { s.debug && (console.error("mpEZTrack failed bind to query for sensitive fields!"), console.log(e)); } try { this.bind(t, s); } catch (e) { s.debug && (console.error("mpEZTrack failed bind to the DOM!"), console.log(e)); } } }), "ez"), s.extend) { window.mixpanel = gn; try { let e = new Event("mpEZTrackLoaded"); window.dispatchEvent(e); } catch (e) { s.debug && (console.error("mpEZTrack failed to dispatch loaded event!"), console.log(e)); } } } catch (e) { s.debug && console.log(e); } }, token: "", tabId: null, tabTrack: function (e, t = 32) { try { let n = window.sessionStorage.getItem(`MPEZTrack_Tab_${e}`); if (n) return this.tabId = n, { "SESSION → tab id": n }; let i = [], o = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", s = o.length; for (var r = 0; r < t; r++)i.push(o.charAt(Math.floor(Math.random() * s))); let a = i.join(""); return this.tabId = a, window.sessionStorage.setItem(`MPEZTrack_Tab_${e}`, a), { "SESSION → tab id": a }; } catch (e) { return {}; } }, loadTimeUTC: Date.now(), numActions: 0, isFirstVisit: !0, priorVisit: function (e = this.token, t = this.opts, r = 30) { if (!t.firstPage) return {}; try { let t = localStorage.getItem(`MPEZTrack_First_Visit_${e}`), n = 6e4 * r; return null === t ? (localStorage.setItem(`MPEZTrack_First_Page_${e}`, this.loadTimeUTC), { "SESSION → first visit?": !0 }) : this.loadTimeUTC - t <= n ? { "SESSION → first visit?": !0 } : (this.isFirstVisit = !1, { "SESSION → first visit?": !1 }); } catch (e) { return t.debug && console.log(e), { "DEVICE → first visit?": "unknown" }; } }, hasVisibilityChanged: !1, superProps: {}, getProps: function (e = this.token, t = this.opts, r) { let n = bn; try { t.deviceProps && (n = l(l({}, (e => { var t, r; let { $os: n, $browser: i, $referrer: o, $referring_domain: s, $browser_version: a, $screen_height: c, $screen_width: l } = e._.info.properties(); return e.ez.register_once({ "DEVICE → first referrer": o, "DEVICE → first referring domain": s }), { "DEVICE → operating system": n, "DEVICE → browser": i, "DEVICE → browser version": a, "DEVICE → last referrer": o, "DEVICE → last referring domain": s, "DEVICE → screen height (px)": c, "DEVICE → screen width (px)": l, "DEVICE → screen dim": `${null == (t = window.screen) ? void 0 : t.width} x ${null == (r = window.screen) ? void 0 : r.height}`, "DEVICE → language": window.navigator.language, "DEVICE → pixel ratio": window.devicePixelRatio, "DEVICE → bandwidth": window.navigator.connection ? window.navigator.connection.effectiveType : "unknown", "DEVICE → memory (GB)": window.navigator.deviceMemory ? window.navigator.deviceMemory : "unknown", "DEVICE → platform": window.navigator.userAgentData ? window.navigator.userAgentData.platform : "unknown", "DEVICE → is mobile?": window.navigator.userAgentData ? window.navigator.userAgentData.mobile : "unknown" }; })(r)), n)); } catch (e) { } try { t.firstPage && (n = l(l({}, this.priorVisit(e, t)), n)); } catch (e) { } try { t.tabs && (n = l(l({}, this.tabTrack(e)), n)); } catch (e) { } return n; }, clearQueue: function (e, t) { try { let r = `__mpq_${e}_ev`, n = localStorage.getItem(r); if (n) { let e = JSON.parse(n).filter((e => "page lost focus" !== e.payload.event)); return localStorage.setItem(r, JSON.stringify(e)), t.debug && t.logProps && console.log("cleared events queue"), !0; } return !1; } catch (e) { return t.debug && t.logProps && (console.log("failed to clear queue"), console.log(e)), !1; } }, getEZConfig: function () { return this.opts; }, debug: () => { gn.ez.set_config({ debug: !0 }); }, mpDefaults: ["$os", "$browser", "$referrer", "$referring_domain", "$current_url", "$browser_version", "$screen_height", "$screen_width", "$initial_referrer", "$initial_referring_domain"], trackedElements: [], blackListedElements: [], host: document.location.host, bind: function (e, t) { try { t.pageView && this.pageView(e, t), t.pageExit && this.pageExit(e, t), t.window && this.window(e, t), t.error && this.error(e, t), t.clipboard && this.clipboard(e, t), t.profiles && this.profiles(e, t), t.buttons && this.buttons(e, t), t.forms && this.forms(e, t), t.selectors && this.selectors(e, t), t.inputs && this.inputs(e, t), t.links && this.links(e, t), t.videos && this.videos(e, t), t.youtube && this.youtube(e, t), t.spa && this.spa(e, t); } catch (e) { t.debug && console.log(e); } }, query: function (e, t = document, r = null) { return function (e, t, r, n = null) { e = function (e) { function t() { n && (s.length > 0 && /^[~+>]$/.test(s[s.length - 1]) && s.push(" "), s.push(n)); } var r, n, i, o, s = [], a = [0], c = 0, l = /(?:[^\\]|(?:^|[^\\])(?:\\\\)+)$/, u = /^\s+$/, p = [/\s+|\/\*|["'>~+[(]/g, /\s+|\/\*|["'[\]()]/g, /\s+|\/\*|["'[\]()]/g, null, /\*\//g]; for (e = e.trim(); ;) { if (n = "", (i = p[a[a.length - 1]]).lastIndex = c, !(r = i.exec(e))) { n = e.substr(c), t(); break; } if ((o = c) < (c = i.lastIndex) - r[0].length && (n = e.substring(o, c - r[0].length)), a[a.length - 1] < 3) { if (t(), "[" === r[0]) a.push(1); else if ("(" === r[0]) a.push(2); else if (/^["']$/.test(r[0])) a.push(3), p[3] = new RegExp(r[0], "g"); else if ("/*" === r[0]) a.push(4); else if (/^[\])]$/.test(r[0]) && a.length > 0) a.pop(); else if (/^(?:\s+|[~+>])$/.test(r[0]) && (s.length > 0 && !u.test(s[s.length - 1]) && 0 === a[a.length - 1] && s.push(" "), 1 === a[a.length - 1] && 5 === s.length && "=" === s[2].charAt(s[2].length - 1) && (s[4] = " " + s[4]), u.test(r[0]))) continue; s.push(r[0]); } else s[s.length - 1] += n, l.test(s[s.length - 1]) && (4 === a[a.length - 1] && (s.length < 2 || u.test(s[s.length - 2]) ? s.pop() : s[s.length - 1] = " ", r[0] = ""), a.pop()), s[s.length - 1] += r[0]; } return s.join("").trim(); }(e); let i = r.querySelector(e); return document.head.createShadowRoot || document.head.attachShadow ? !t && i ? i : _n(e, ",").reduce(((e, i) => { if (!t && e) return e; let o = _n(i.replace(/^\s+/g, "").replace(/\s*([>+~]+)\s*/g, "$1"), " ").filter((e => !!e)).map((e => _n(e, ">"))), s = o.length - 1, a = function (e = null, t, r = null) { let n = []; if (r) n = r; else { let e = function (t) { for (let r = 0; r < t.length; r++) { let i = t[r]; n.push(i), i.shadowRoot && e(i.shadowRoot.querySelectorAll("*")); } }; t.shadowRoot && e(t.shadowRoot.querySelectorAll("*")), e(t.querySelectorAll("*")); } return e ? n.filter((t => t.matches(e))) : n; }(o[s][o[s].length - 1], r, n), c = function (e, t, r) { return n => { let i = t, o = n, s = !1; for (; o && !yn(o);) { let t = !0; if (1 === e[i].length) t = o.matches(e[i]); else { let n = [].concat(e[i]).reverse(), s = o; for (let e of n) { if (!s || !s.matches(e)) { t = !1; break; } s = vn(s, r); } } if (t && 0 === i) { s = !0; break; } t && i--, o = vn(o, r); } return s; }; }(o, s, r); return t ? e = e.concat(a.filter(c)) : (e = a.find(c)) || null; }), t ? [] : null) : t ? r.querySelectorAll(e) : i; }(e, !0, t, r); }, spa: function (e, t) { window.addEventListener("click", (r => { try { if (this.trackedElements.includes(r.target) || this.blackListedElements.includes(r.target)) return !1; Bn.call(Un, r.target, r, e, t); } catch (e) { t.debug && console.log(e); } }), Sn); }, spaPipe: function (e = "none", t, r, n) { let i; if (t instanceof Event) i = t.target; else { if (!(t instanceof HTMLElement)) return n.debug && console.log("spaPipeline: invalid element or event"), !1; i = t; } this.trackedElements.includes(t.target) || (n.buttons && "button" === e ? (this.trackedElements.push(t.target), this.buttonTrack(t, r, n), i.addEventListener("click", (e => { this.buttonTrack(e, r, n); }), Sn)) : n.links && "link" === e ? (this.trackedElements.push(i), this.linkTrack(t, r, n), i.addEventListener("click", (e => { this.linkTrack(e, r, n); }))) : n.forms && "form" === e ? (this.trackedElements.push(i), i.addEventListener("submit", (e => { this.formTrack(e, r, n); }), Sn)) : n.selectors && "select" === e ? (this.trackedElements.push(i), i.addEventListener("change", (e => { this.selectTrack(e, r, n); }), Sn)) : n.inputs && "input" === e ? (this.trackedElements.push(i), i.addEventListener("change", (e => { this.inputTrack(e, r, n); }), Sn)) : n.videos && "video" === e ? (this.trackedElements.push(i), i.addEventListener("play", (e => { this.videoTrack(e, r, n); }), Sn), i.addEventListener("pause", (e => { this.videoTrack(e, r, n); }), Sn), i.addEventListener("ended", (e => { this.videoTrack(e, r, n); }), Sn)) : n.clicks && "all" === e && (this.trackedElements.push(i), this.clickTrack(t, r, n), i.addEventListener("click", (e => { this.clickTrack(e, r, n); }), Sn))); }, buttons: function (e, t) { let r = zn(this.query(In)).filter((e => !e.matches(kn))).filter((e => !this.trackedElements.some((t => t === e)))).filter((e => !this.blackListedElements.some((t => t === e)))); for (let n of r) this.trackedElements.push(n), n.addEventListener("click", (r => { try { this.buttonTrack(r, e, t); } catch (e) { t.debug && console.log(e); } }), Sn); }, links: function (e, t) { let r = zn(this.query(En)).filter((e => !e.matches(kn))).filter((e => !this.trackedElements.some((t => t === e)))).filter((e => !this.blackListedElements.some((t => t === e)))); for (let n of r) this.trackedElements.push(n), n.addEventListener("click", (r => { try { this.linkTrack(r, e, t); } catch (e) { t.debug && console.log(e); } }), Sn); }, forms: function (e, t) { let r = zn(this.query(Cn)); for (let n of r) this.trackedElements.push(n), n.addEventListener("submit", (r => { try { this.formTrack(r, e, t); } catch (e) { t.debug && console.log(e); } }), Sn); }, selectors: function (e, t) { let r = zn(this.query(Mn)).filter((e => !e.matches(kn))).filter((e => !this.trackedElements.some((t => t === e)))).filter((e => !this.blackListedElements.some((t => t === e)))); for (let n of r) this.trackedElements.push(n), n.addEventListener("change", (r => { try { this.selectTrack(r, e, t); } catch (e) { t.debug && console.log(e); } }), Sn); }, inputs: function (e, t) { let r = zn(this.query(On)).filter((e => !e.matches(kn))).filter((e => !this.trackedElements.some((t => t === e)))).filter((e => !this.blackListedElements.some((t => t === e)))); for (let n of r) this.trackedElements.push(n), n.addEventListener("change", (r => { try { this.inputTrack(r, e, t); } catch (e) { t.debug && console.log(e); } }), Sn); }, clicks: function (e, t) { let r = zn(this.query(xn).filter((e => 0 === e.childElementCount)).filter((e => !this.trackedElements.some((t => t === e)))).filter((e => !this.trackedElements.some((t => t.contains(e))))).filter((e => !this.trackedElements.some((t => e.parentNode === t)))).filter((e => !e.matches(kn))).filter((e => !this.blackListedElements.some((t => t === e))))); for (let n of r) this.trackedElements.push(n), n.addEventListener("click", (r => { try { this.clickTrack(r, e, t); } catch (e) { t.debug && console.log(e); } }), Sn); }, videos: function (e, t) { let r = zn(this.query(Nn)).filter((e => !e.matches(kn))).filter((e => !this.trackedElements.some((t => t === e)))).filter((e => !this.blackListedElements.some((t => t === e)))); for (let n of r) this.trackedElements.push(n), n.addEventListener("play", (r => { try { this.videoTrack(r, e, t); } catch (e) { t.debug && console.log(e); } }), Sn), n.addEventListener("pause", (r => { try { this.videoTrack(r, e, t); } catch (e) { t.debug && console.log(e); } }), Sn), n.addEventListener("ended", (r => { try { this.videoTrack(r, e, t); } catch (e) { t.debug && console.log(e); } }), Sn); }, linkOrNav: Rn, buttonTrack: function (e, t, r) { let n = e.currentTarget || e, i = l(l(l({}, wn(n, "BUTTON")), (e => ({ "BUTTON → text": qn(e.textContent) }))(n)), jn()); t.track("button click", i), r.logProps && (console.log("BUTTON CLICK"), console.log(JSON.stringify(i, null, 2))); }, linkTrack: function (e, t, r) { let n = e.currentTarget || e, i = Rn.call(Un, n), o = l(l(l({}, wn(n, i.label)), ((e, t = "LINK") => ({ [`${t} → text`]: qn(e.textContent) }))(n, i.label)), jn()); t.track(`${i.eventName} click`, o), r.logProps && (console.log(`${i.eventName.toUpperCase()} CLICK`), console.log(JSON.stringify(o, null, 2))); }, formTrack: function (e, t, r) { let n = e.currentTarget || e, i = l(l(l({}, wn(n, "FORM")), (e => ({ "FORM → # inputs": e.length, "FORM → method": e.method, "FORM → action": e.action, "FORM → encoding": e.encoding }))(n)), jn()); t.track("form submit", i), r.logProps && (console.log("FORM SUBMIT"), console.log(JSON.stringify(i, null, 2))); }, selectTrack: function (e, t, r) { let n = e.currentTarget || e, i = l(l(l({}, wn(n, "OPTION")), (e => { let t = { "OPTION → user selected": "on" === e.value ? e.checked : e.value, "OPTION → labels": [...e.labels].map((e => { var t; return null == (t = e.textContent) ? void 0 : t.trim(); })) }; try { let r = e.innerText.split("\n"); r.length > 1 ? t["OPTION → choices"] = r : null != e && e.list && (r = [...e.list.children].map((e => e.value)), t["OPTION → choices"] = r); } catch (e) { } return t; })(n)), jn()); t.track("user selection", i), r.logProps && (console.log("USER SELECTION"), console.log(JSON.stringify(i, null, 2))); }, inputTrack: function (e, t, r) { let n = e.currentTarget || e, i = l(l(l({}, (e => ({ "CONTENT → user content": Ln(e.value) ? "******" : e.value, "CONTENT → labels": [...e.labels].map((e => qn(e.textContent))) }))(n)), jn()), wn(n, "CONTENT")); t.track("user entered text", i), r.logProps && (console.log("USER ENTERED CONTENT"), console.log(JSON.stringify(i, null, 2))); }, videoTrack: function (e, t, r) { let n = e.target, i = l(l(l({}, wn(n, "VIDEO")), (e => ({ "VIDEO → watch time": e.currentTime, "VIDEO → total time": e.duration, "VIDEO → watch %": Number(Number(e.currentTime / e.duration * 100).toFixed(2)), "VIDEO → autoplay?": e.autoplay, "VIDEO → controls visible?": e.controls, "VIDEO → loops?": e.loop, "VIDEO → muted?": e.muted, "VIDEO → thumbnail": e.poster, "VIDEO → source(s)": e.src || [...e.querySelectorAll("source")].map((e => e.src)), "VIDEO → source type(s)": e.src.split(".").slice(-1)[0] || [...e.querySelectorAll("source")].map((e => e.type)) }))(n)), jn()), o = e.type; t.track(`video: ${o}`, i), r.logProps && (console.log(`VIDEO ${o}`), console.log(JSON.stringify(i, null, 2))); }, clickTrack: function (e, t, r) { let n = e.target || e, i = l(l(l({}, Tn(n)), jn()), wn(n)); t.track("page click", i), r.logProps && (console.log("PAGE CLICK"), console.log(JSON.stringify(i, null, 2))); }, youtube: function (e) { let t = document.createElement("script"); t.id = "mixpanel-iframe-tracker", t.src = "https://www.youtube.com/iframe_api"; let r = document.getElementsByTagName("script")[0] || document.getElementsByTagName("body")[0].children[0]; r.parentNode.insertBefore(t, r); let n = zn(this.query(Dn)).filter((e => e.src.includes("youtube.com/embed"))); for (let e of n) if (this.trackedElements.push(e), e.id || (e.id = new URL(e.src).pathname.replace("/embed/", "")), !e.src.includes("enablejsapi")) { let t = new URL(e.src); t.searchParams.delete("enablejsapi"), t.searchParams.append("enablejsapi", 1), e.src = t.toString(); } function i(e) { new YT.Player(e, { events: { onReady: s, onStateChange: a } }); } function o(e) { let t = e.getVideoData(); return { "VIDEO → quality": e.getPlaybackQuality(), "VIDEO → length (sec)": e.getDuration(), "VIDEO → elapsed (sec)": e.getCurrentTime(), "VIDEO → url": e.getVideoUrl(), "VIDEO → title": t.title, "VIDEO → id": t.video_id, "VIDEO → author": t.author, "VIDEO → fullscreen": null !== document.fullscreenElement }; } function s(t) { let r = o(t.target); e.track("youtube player load", r), e.time_event("youtube video started"); } function a(t) { !function (t, r) { let n = o(r), i = l(l({}, n), jn(!1)); switch (t) { case -1: break; case 0: e.track("youtube video finish", i); break; case 1: e.track("youtube video play", i), e.time_event("youtube video finish"); break; case 2: e.track("youtube video pause", i); } }(t.data, t.target); } window.onYouTubeIframeAPIReady = function () { let e = Un.query(Dn).filter((e => e.src.includes("youtube.com/embed"))); for (let t of e) i(t.id); }; }, pageView: function (e, t) { e.track("page enter", l({}, jn(!1, !1, !1))), t.logProps && (console.log("PAGE ENTER"), console.log(JSON.stringify(bn, null, 2))); }, pageExit: function (e, t) { window.addEventListener("beforeunload", (() => { this.hasVisibilityChanged = null, e.track("page exit", l({}, jn(!1)), { transport: "sendBeacon", send_immediately: !0 }), t.logProps && (console.log("PAGE EXIT"), console.log(JSON.stringify(l({}, jn(!1)), null, 2))); })); }, window: function (e, t) { window.addEventListener("resize", (() => { window.clearTimeout(Un.resizeTimer), Un.resizeTimer = window.setTimeout((() => { let t = l({ "PAGE → height": window.innerHeight, "PAGE → width": window.innerWidth }, jn(!1)); e.track("page resize", t); }), 3e3); }), Sn), window.addEventListener("beforeprint", (() => { try { let t = l({}, jn(!1)); e.track("print", t); } catch (e) { t.debug && console.log(e); } }), Sn), window.addEventListener("visibilitychange", (function () { let t = l({}, jn(!1)); !document.hidden && "hidden" !== document.visibilityState || null === this.hasVisibilityChanged ? this.hasVisibilityChanged && e.track("page regained focus", t) : (e.track("page lost focus", t), this.hasVisibilityChanged = !0); })), document.addEventListener("fullscreenchange", (function () { let t = l({}, jn(!1)); document.fullscreenElement ? e.track("page fullscreen: on", t) : e.track("page fullscreen: off", t); })); }, error: function (e, t) { window.addEventListener("error", (r => { try { let t = l({ "ERROR → type": r.type, "ERROR → message": r.message }, jn(!1)); e.track("page error", t); } catch (e) { t.debug && console.log(e); } }), Sn); }, clipboard: function (e, t) { window.addEventListener("cut", (r => { try { let n = l(l(l({}, jn(!1)), wn(r.target)), Tn(r.target, !0)); e.track("cut", n), t.logProps && (console.log("CUT"), console.log(JSON.stringify(n, null, 2))); } catch (e) { t.debug && console.log(e); } }), Sn), window.addEventListener("copy", (r => { try { let n = l(l(l({}, jn(!1)), wn(r.target)), Tn(r.target, !0)); e.track("copy", n), t.logProps && (console.log("COPY"), console.log(JSON.stringify(n, null, 2))); } catch (e) { t.debug && console.log(e); } }), Sn), window.addEventListener("paste", (r => { try { let n = l(l(l({}, jn(!1)), wn(r.target)), Tn(r.target, !0)); e.track("paste", n), t.logProps && (console.log("PASTE"), console.log(JSON.stringify(n, null, 2))); } catch (e) { t.debug && console.log(e); } }), Sn); }, profiles: function (e, t) { try { e.identify(e.get_distinct_id()), e.people.set({ "USER → last page viewed": window.location.href, "USER → language": window.navigator.language }), e.people.increment("total # pages"), e.people.set_once({ $name: "anonymous", $Created: (new Date).toISOString(), $email: "anonymous", $phone: "anonymous" }); } catch (e) { t.debug && console.log(e); } }, defaultOpts: function (e = {}) { var t, r; let n = { debug: !1, extend: !1, refresh: 5e3, location: !0, persistence: "localStorage", cookie_domain: "", deviceProps: !0, pageView: !0, pageExit: !0, links: !0, buttons: !0, forms: !0, profiles: !0, selectors: !0, videos: !0, window: !1, spa: !0, inputs: !1, clicks: !1, youtube: !1, clipboard: !1, firstPage: !1, error: !1, tabs: !1, logProps: !1 }; return "eu" === (null == (t = null == e ? void 0 : e.region) ? void 0 : t.toLowerCase()) && (n.api_host = "https://api-eu.mixpanel.com"), "us" === (null == (r = null == e ? void 0 : e.region) ? void 0 : r.toLowerCase()) && (n.api_host = "https://api-js.mixpanel.com"), n; } }; function jn(e = !0, t = !0, r = !0) { e && (Un.numActions += 1); let n = (document.documentElement.scrollTop + document.body.scrollTop) / (document.documentElement.scrollHeight - document.documentElement.clientHeight) * 100 || 0, i = { "PAGE → # actions": Un.numActions }; return t && (i["SESSION → time on page (sec)"] = (Date.now() - Un.loadTimeUTC) / 1e3), r && (i["PAGE → scroll (%)"] = Number(n.toFixed(2))), i; } function Bn(e, t, r, n) { if (this.trackedElements.includes(e) || this.blackListedElements.includes(e) || e.matches(kn)) return !1; if (e.matches(In)) return e ? this.spaPipe("button", e, r, n) : this.spaPipe("button", t, r, n), !0; if (e.matches(En)) return e ? this.spaPipe("link", e, r, n) : this.spaPipe("link", t, r, n), !0; if (e.matches(Cn)) return e ? this.spaPipe("form", e, r, n) : this.spaPipe("form", t, r, n), !0; if (e.matches(Mn)) return e ? this.spaPipe("select", e, r, n) : this.spaPipe("select", t, r, n), !0; if (e.matches(On)) return e ? this.spaPipe("input", e, r, n) : this.spaPipe("input", t, r, n), !0; if (e.matches(Nn)) return e ? this.spaPipe("video", e, r, n) : this.spaPipe("video", t, r, n), !0; let i = [In, En, Cn, Mn, On, Nn], o = function (e) { let t = []; for (; e && e !== document.body; e = e.parentNode)t.push(e); return t; }(e).filter((e => i.map((t => e.matches(t))).some((e => e)))); if (o.length > 0) return Bn.call(Un, o[0], t, r, n), !0; let s = Vn(e); return !(!e.matches(xn) || s !== e) && (this.spaPipe("all", t, r, n), !0); } function Vn(e) { if (0 !== e.childElementCount) { let t = e.firstElementChild; return t || (t = e.nextElementSibling), t || (t = e.priorElementSibling), t ? Vn(t) : e; } return e; } function zn(e) { return [...new Set(e)]; } window.mpEZTrack = Un; })();
	EMBED_EZ_TRACK();

}


if (import.meta.url === new URL(`file://${process.argv[1]}`).href) {
	const result = await main({ concurrency: 2, users: 4, headless: true, inject: true, url: "https://aktunes.com" });
	if (NODE_ENV === 'dev') debugger;
}
